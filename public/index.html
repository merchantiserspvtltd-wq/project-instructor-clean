<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safe Learners</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnR1zekmfJ04AnY4FeJUVRGildidvU0rg&libraries=places&callback=initMap"
        async defer></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
        /* --- WALLET PAGE STYLES --- */
        .breadcrumbs {
            font-size: 14px;
            color: var(--gray-color);
        }

        .breadcrumbs span:first-child {
            font-weight: 500;
        }

        .wallet-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .wallet-main h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .wallet-main .subtitle {
            color: var(--gray-color);
            margin-bottom: 20px;
        }

        .credit-options .credit-option {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .credit-options .credit-option:hover {
            border-color: #ccc;
        }

        .credit-options .credit-option.selected {
            border-color: var(--primary-color);
            background-color: #FFFDF5;
        }

        .credit-option input[type="radio"] {
            margin-top: 5px;
            margin-right: 15px;
            accent-color: var(--primary-color);
            /* Modern way to color radios/checkboxes */
        }

        .credit-option .option-details {
            width: 100%;
            cursor: pointer;
        }

        .option-details .option-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .option-details h4 {
            font-size: 16px;
            font-weight: 600;
        }

        .option-details p {
            font-size: 14px;
            color: var(--gray-color);
        }

        .tag {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .discount-tag {
            background-color: #E6F4EA;
            color: #4CAF50;
        }

        .discount-tag-alt {
            background-color: #FFF4E5;
            color: #FF9800;
        }

        .custom-hours i {
            color: var(--gray-color);
        }

        .order-summary,
        .bnp-card {
            padding: 20px;
        }

        .order-summary .summary-item,
        .order-summary .summary-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .order-summary .summary-total {
            font-weight: 600;
            font-size: 18px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .order-summary .btn {
            margin-top: 10px;
        }

        .bnp-card p {
            margin: 10px 0;
            color: var(--gray-color);
        }

        .bnp-card .payment-logos {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bnp-card .payment-logos img {
            height: 20px;
            width: auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            font-family: var(--font-family);
            color: var(--dark-color);
            background-color: var(--white-color);
        }

        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* CSS RESET & GLOBAL STYLES */
        :root {
            --primary-color: #DBC9B5;
            /* Tan for buttons and main actions */
            --secondary-color: #F5FAEF;
            /* Light beige for secondary backgrounds */
            --accent-color: #158AFF;
            /* Blue for specific highlights/icons */
            --dark-color: #1A1A1A;
            /* Black for text and dark elements */
            --gray-color: #757575;
            /* Kept for secondary text */
            --light-gray-color: #F5FAEF;
            /* Main page background */
            --white-color: #FFFFFF;
            /* White for cards */
            --border-color: #E0E0E0;
            /* Kept for neutral borders */
            --font-family: 'Poppins', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--white-color);
            color: var(--dark-color);
        }

        .page {
            display: none;
            /* Pages are hidden by default */
        }

        .page.active {
            display: block;
            /* The active page is shown */
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--dark-color);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: var(--white-color);
            color: var(--dark-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--light-gray-color);
        }

        .text-primary {
            color: var(--primary-color);
        }

        /* --- LANDING PAGE STYLES --- */
        .landing-container {
            background-color: var(--secondary-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .landing-container header {
            padding: 20px 80px;
        }

        .landing-container nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        .logo img {
            height: 40px;
            margin-right: 10px;
        }

        .nav-links a {
            margin-left: 20px;
            font-weight: 500;
        }

        .hero {
            display: flex;
            padding: 40px 80px;
            align-items: center;
            flex-grow: 1;
        }

        .hero-content {
            flex: 1;
        }

        .hero-content .tag {
            background-color: var(--white-color);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        .hero-content h1 {
            font-size: 48px;
            margin: 20px 0;
            line-height: 1.3;
        }

        .hero-content h1 span {
            background-color: var(--primary-color);
            padding: 0 10px;
        }

        .hero-content p {
            font-size: 16px;
            color: var(--gray-color);
            max-width: 450px;
        }

        .hero-buttons {
            margin-top: 30px;
        }

        .hero-buttons .btn {
            margin-right: 15px;
        }

        .hero-images {
            flex: 1;
            position: relative;
            height: 450px;
        }

        .hero-images img {
            position: absolute;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .hero-img-1 {
            width: 70%;
            top: 0;
            right: 0;
            z-index: 2;
        }

        .hero-img-2 {
            width: 50%;
            bottom: 0;
            left: 0;
            z-index: 1;
        }

        .happy-client-badge {
            position: absolute;
            background: white;
            border-radius: 50%;
            padding: 20px;
            z-index: 3;
            top: 50px;
            left: -30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 5px solid var(--secondary-color);
        }

        .happy-client-badge p {
            line-height: 1;
        }

        .happy-client-badge span {
            font-size: 12px;
            display: block;
        }

        .road-footer {
            height: 100px;
            background-image: url('data:image/svg+xml;utf8,<svg width="100%" height="100" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="50" x2="100%" y2="50" stroke-width="4" stroke="white" stroke-dasharray="20 20"/></svg>'), linear-gradient(#444, #333);
            background-repeat: repeat-x, no-repeat;
            background-position: center;
            position: relative;
        }

        .car-graphic {
            position: absolute;
            height: 120px;
            bottom: 25px;
            left: 20%;
        }


        /* --- LOGIN PAGE STYLES --- */
        .login-page {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;
        }

        .login-art {
            background-color: #FFFBF0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="50" height="50"><path d="M46.7,33.4c-2.9-2.9-7.5-2.9-10.4,0L29.1,40.6c-2.9,2.9-2.9,7.5,0,10.4c2.9,2.9,7.5,2.9,10.4,0l7.1-7.1C49.5,40.9,49.5,36.2,46.7,33.4z M58.4,45.1L58.4,45.1c2.9-2.9,2.9-7.5,0-10.4c-2.9-2.9-7.5-2.9-10.4,0l-2.8,2.8c-0.8-2.6-2.5-4.8-4.8-6.1l4.9-4.9c4.5-4.5,11.8-4.5,16.3,0l7.1,7.1c4.5,4.5,4.5,11.8,0,16.3l-4.9,4.9C61.3,50,59.6,47.8,58.4,45.1z M41.6,54.9L41.6,54.9c-2.9,2.9-2.9,7.5,0,10.4c2.9,2.9,7.5,2.9,10.4,0l2.8-2.8c0.8,2.6,2.5,4.8,4.8,6.1l-4.9,4.9c-4.5,4.5-11.8,4.5-16.3,0l-7.1-7.1c-4.5-4.5-4.5-11.8,0-16.3l4.9-4.9C38.7,50,40.4,52.2,41.6,54.9z" fill="%23000" fill-opacity="0.05"/></svg>');
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .logo-large {
            text-align: center;
            margin-top: 20vh;
        }

        .logo-large img {
            height: 80px;
        }

        .logo-large h2 {
            font-size: 24px;
            letter-spacing: 5px;
            margin-top: 15px;
        }

        .logo-large p {
            letter-spacing: 8px;
            font-size: 12px;
            color: var(--gray-color);
        }

        .login-art .road-footer {
            height: 120px;
        }

        .login-art .car-graphic {
            height: 140px;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }

        .login-form-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-form-container form {
            width: 100%;
            max-width: 380px;
        }

        .login-form-container h2 {
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--gray-color);
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-container input {
            display: none;
        }

        .checkbox-container .checkmark {
            width: 18px;
            height: 18px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-right: 8px;
            display: inline-block;
        }

        .checkbox-container input:checked~.checkmark {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .forgot-password {
            color: var(--gray-color);
        }

        .btn-full {
            width: 100%;
        }

        .signup-link {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
        }

        .signup-link a {
            color: var(--primary-color);
            font-weight: 500;
        }

        .error-text {
            color: red;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            height: 20px;
        }


        /* --- DASHBOARD STYLES --- */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
            background-color: var(--light-gray-color);
        }

        .sidebar {
            background-color: var(--white-color);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);

            /* START: ADD THESE 3 LINES */
            position: sticky;
            top: 0;
            height: 100vh;
            /* END: ADD THESE 3 LINES */
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 0 10px;
            margin-bottom: 40px;
        }

        .sidebar-header img {
            height: 30px;
            margin-right: 10px;
        }

        .sidebar-header h3 {
            font-size: 16px;
            font-weight: 700;
        }

        .sidebar-nav ul,
        .sidebar-footer ul {
            list-style: none;
        }

        .sidebar-nav li a {
            display: block;
            padding: 15px 20px;
            margin-bottom: 5px;
            border-radius: 8px;
            font-weight: 500;
        }

        .sidebar-nav li.active a,
        .sidebar-nav li a:hover {
            background-color: var(--primary-color);
        }

        .sidebar-footer {
            margin-top: auto;
        }

        .sidebar-footer li a {
            display: block;
            padding: 10px 20px;
            color: var(--gray-color);
            font-size: 14px;
        }

        #logout-button {
            width: 100%;
            margin-top: 20px;
        }

        .main-content {
            padding: 30px 40px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .dashboard-header h3 {
            font-size: 16px;
            font-weight: 500;
            color: var(--gray-color);
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info .fa-bell {
            font-size: 20px;
            margin-right: 25px;
            cursor: pointer;
        }

        .user-profile {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-profile img {
            height: 40px;
            width: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        .user-profile span {
            font-weight: 500;
        }

        .dashboard-body h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .card {
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header h4 {
            font-weight: 600;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .card-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            margin-top: 15px;
        }

        .card-footer a {
            font-weight: 500;
            font-size: 14px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .instructor-details {
            display: flex;
            gap: 20px;
        }

        .instructor-info,
        .vehicle-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .instructor-info img,
        .vehicle-info img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .instructor-info h5,
        .vehicle-info h5 {
            font-size: 16px;
            font-weight: 600;
        }

        .instructor-info p,
        .vehicle-info p {
            font-size: 14px;
            color: var(--gray-color);
        }

        .wallet-balance {
            font-size: 36px;
            font-weight: 700;
        }

        .wallet-note {
            font-size: 12px;
            color: var(--gray-color);
        }

        .test-package-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-package-details {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .package-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #E3F2FD;
            color: #2196F3;
            display: grid;
            place-items: center;
            font-size: 24px;
            font-weight: 700;
        }

        .package-info h4 {
            margin-bottom: 10px;
        }

        .package-info ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px 20px;
            font-size: 14px;
            color: var(--gray-color);
        }

        .package-info ul li::before {
            content: '✓';
            color: #4CAF50;
            margin-right: 8px;
        }

        .test-package-action {
            text-align: right;
        }

        .test-package-action .price {
            display: block;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .booking-section {
            margin-top: 30px;
        }

        .booking-section h3 {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .tabs {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-link {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            position: relative;
            color: var(--gray-color);
        }

        .tab-link.active {
            color: var(--dark-color);
        }

        .tab-link.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
        }

        .tab-content {
            background-color: var(--white-color);
            padding: 30px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            color: var(--gray-color);
        }


        /* --- BOOKING PAGE STYLES --- */
        .booking-content {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .booking-main h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .booking-type-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .booking-type-tabs .tab-link {
            padding-bottom: 10px;
        }

        .warning-box {
            background-color: #FFFBEB;
            border: 1px solid #FDE68A;
            border-radius: 8px;
            padding: 15px;
            font-size: 14px;
            color: #92400E;
            margin-bottom: 20px;
        }

        .booking-form {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--white-color);
        }

        .form-group-inline {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-note {
            font-size: 13px;
            color: var(--gray-color);
            margin: -10px 0 20px 0;
        }

        .location-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .edit-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 14px;
        }

        .edit-btn i {
            margin-right: 5px;
        }

        .form-actions {
            text-align: right;
            margin-top: 30px;
        }

        .btn-disabled {
            background-color: var(--light-gray-color) !important;
            color: var(--gray-color) !important;
            cursor: not-allowed;
            opacity: 0.8;
            border-color: var(--border-color) !important;
        }

        .booking-sidebar .order-summary .btn {
            margin-top: 15px;
        }

        /* --- SWITCH INSTRUCTOR PAGE STYLES --- */
        .instructor-filters {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-color);
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--white-color);
            cursor: pointer;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background-color: var(--dark-color);
            color: var(--white-color);
            border-color: var(--dark-color);
        }

        .filter-sort {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-left: auto;
            /* Pushes sort to the right */
        }

        .instructor-page-layout {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 30px;
        }

        .instructor-list-container h3 {
            font-size: 22px;
            font-weight: 600;
        }

        .instructor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* Creates a 2-column grid */
            gap: 25px;
            margin-top: 20px;
        }

        .instructor-card-new {
            display: grid;
            grid-template-columns: 100px 1fr;
            /* Column for photo and a column for details */
            grid-template-rows: auto auto;
            /* Two rows for content */
            gap: 0 20px;
            /* 0px row gap, 20px column gap */
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 12px;

        }

        .instructor-photo-new {
            grid-row: 1 / span 2;
            /* Make photo span both rows */
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f0f0;
            /* Placeholder color */
            border: 1px solid var(--border-color);
        }

        .instructor-details-new {
            grid-column: 2;
            /* Details are in the second column */
            grid-row: 1;
            /* Details are in the first row */
        }

        .instructor-details-new h4 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .instructor-details-new .instructor-meta {
            font-size: 13px;
            color: var(--gray-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .instructor-details-new .instructor-meta i {
            margin-right: 8px;
            /* Space between icon and text */
            width: 16px;
            /* Align icons */
            text-align: center;
        }

        .instructor-details-new .availability-link {
            font-size: 14px;
            font-weight: 500;
            color: var(--dark-color);
            text-decoration: none;
            margin-top: 10px;
            display: inline-block;
        }

        .instructor-actions-new {
            grid-column: 1 / -1;
            /* Make action buttons span all columns */
            grid-row: 2;
            padding-top: 15px;
            margin-top: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-self: end;
            /* Pushes to the bottom of the details section */
        }

        .instructor-actions-new .btn-secondary {
            background-color: #4A4A4A;
            /* Dark gray button */
            color: var(--white-color);
            border: none;
        }

        .instructor-info h4 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .instructor-meta {
            font-size: 13px;
            color: var(--gray-color);
            margin-bottom: 3px;
        }

        .instructor-meta .fa-star {
            color: var(--primary-color);
        }

        .instructor-meta .fa-check-circle {
            color: #4CAF50;
        }

        .instructor-meta.price {
            font-weight: 500;
            color: var(--dark-color);
        }

        .availability-link {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark-color);
            text-decoration: underline;
            margin-top: 5px;
            display: inline-block;
        }

        .instructor-actions {
            grid-column: 1 / -1;
            /* Span full width */
            display: flex;
            gap: 10px;
        }

        .instructor-search-sidebar .form-group {
            margin-bottom: 15px;
        }

        .instructor-search-sidebar select {
            width: 100%;
        }


        .content-view {
            display: none;
        }

        .content-view.active {
            display: block;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .back-link i {
            margin-right: 8px;
        }

        .profile-content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-car-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: -60px;
            /* Creates the overlap effect */
            border: 4px solid var(--white-color);
        }

        .profile-header-info h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .profile-rating {
            font-size: 14px;
            color: var(--gray-color);
        }

        .profile-rating i {
            color: var(--primary-color);
        }

        .profile-section {
            margin-top: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-section:last-child {
            border-bottom: none;
        }

        .profile-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .profile-section p {
            color: var(--gray-color);
            line-height: 1.6;
        }

        .checkmark-list {
            list-style: none;
            padding: 0;
        }

        .checkmark-list li {
            margin-bottom: 12px;
            font-weight: 500;
        }

        .checkmark-list i {
            color: #4CAF50;
            margin-right: 10px;
        }

        .language-tag {
            display: inline-block;
            padding: 6px 14px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .price-card .price-card-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .price-card .price-card-item:first-child {
            padding-top: 0;
        }

        .price-card .price-card-item:last-of-type {
            border-bottom: none;
        }

        .price-card-item h4 {
            font-weight: 600;
        }

        .price-card-item p {
            font-size: 13px;
            color: var(--gray-color);
        }

        .price-card-item span {
            font-size: 18px;
            font-weight: 700;
        }

        .price-card .btn {
            margin-top: 20px;
        }

        .price-card .btn-secondary {
            background-color: var(--white-color);
        }

        .save-tag {
            background-color: #E6F4EA;
            color: #4CAF50;
            font-size: 12px !important;
            padding: 5px 10px;
            border-radius: 12px;
        }

        /* ... existing CSS rules ... */

        /* --- START: AVAILABILITY MODAL STYLES --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
            /* Shown when active */
        }

        .modal-content {
            background-color: var(--white-color);
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 950px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--gray-color);
        }

        .modal-content h4 {
            font-weight: 500;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .availability-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .availability-controls label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .calendar-nav button {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 5px 12px;
            cursor: pointer;
        }

        .calendar-nav .today-btn {
            background-color: var(--light-gray-color);
        }

        .schedule-grid-container {
            max-height: 400px;
            /* Limits the height and makes it scrollable */
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 50px repeat(7, 1fr);
            /* 1 col for time, 7 for days */
        }

        .time-labels,
        .day-column {
            display: flex;
            flex-direction: column;
        }

        .time-labels div,
        .day-header {
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--gray-color);
            border-bottom: 1px solid var(--border-color);
        }

        .day-header {
            background-color: var(--light-gray-color);
            font-weight: 600;
        }

        .time-slot {
            height: 30px;
            border-bottom: 1px solid #eee;
            border-left: 1px solid #eee;
        }

        .time-slot.unavailable {
            background-color: #f0f0f0;
        }

        /* --- START: Added for Services Tab & Booking Tabs --- */
        .tab-pane {
            display: none;
            /* This is the key rule to hide inactive tabs */
        }

        .tab-pane.active {
            display: block;
            /* This rule shows the active tab */
        }

        /* This resets the style for the services grid so it doesn't have a white box */
        #services-content.active {
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: left;
            color: var(--dark-color);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card {
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            position: relative;
            transition: box-shadow 0.3s ease;
        }

        .service-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .popular-tag {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #E53935;
            color: var(--white-color);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .service-card h4 {
            font-size: 20px;
            font-weight: 600;
            margin-top: 10px;
            margin-bottom: 8px;
        }

        .service-card p {
            font-size: 14px;
            color: var(--gray-color);
            margin-bottom: 20px;
        }

        .service-card .illustration {
            height: 100px;
            width: 100%;
            margin-bottom: 20px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* --- START: Booking History & Details Styles --- */

        /* Removes the white box from the history tab container */
        #history-content.tab-content {
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: left;
        }

        .booking-history-table {
            width: 100%;
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
        }

        .history-header,
        .history-row {
            display: grid;
            grid-template-columns: 0.8fr 1.2fr 1.5fr 1.5fr 2fr 1fr 1fr;
            align-items: center;
            padding: 15px 20px;
        }

        .history-header {
            font-weight: 600;
            color: var(--gray-color);
            border-bottom: 1px solid var(--border-color);
            background-color: var(--light-gray-color);
        }

        .history-row {
            border-bottom: 1px solid var(--border-color);
        }

        .history-row:last-child {
            border-bottom: none;
        }

        .booking-id-link {
            font-weight: 600;
            color: var(--primary-color);
            text-decoration: underline;
        }

        .instructor-cell {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .instructor-cell img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background-color: #E6F4EA;
            color: #4CAF50;
        }

        .status-processed {
            background-color: #E3F2FD;
            color: #2196F3;
        }

        .status-confirmed {
            background-color: #E8EAF6;
            color: #3F51B5;
        }

        .status-pending {
            background-color: #FFF9C4;
            color: #F57F17;
        }


        /* Booking Details Page */
        .booking-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .booking-details-header h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .booking-details-actions {
            display: flex;
            gap: 10px;
        }

        .booking-details-actions .btn i {
            margin-right: 5px;
        }

        .booking-main-info {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            padding: 10px 0;
        }

        .booking-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray-color);
        }

        .booking-info-item i {
            width: 20px;
            text-align: center;
        }

        .booking-info-item span {
            font-weight: 500;
            color: var(--dark-color);
        }

        .booking-info-instructor {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: var(--light-gray-color);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .booking-info-instructor img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .booking-info-instructor p {
            font-size: 12px;
            color: var(--gray-color);
            margin: 0;
        }

        .booking-info-instructor h5 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .payment-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .payment-details p {
            color: var(--gray-color);
            font-size: 14px;
            margin: 0 0 5px 0;
        }

        .payment-amount {
            text-align: right;
        }

        .payment-amount h2 {
            font-size: 28px;
            font-weight: 700;
        }

        /* Update History */
        .update-history-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .update-history-item:last-child {
            border-bottom: none;
        }

        .update-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-gray-color);
            display: grid;
            place-items: center;
            font-size: 16px;
            color: var(--gray-color);
        }

        .update-details p {
            margin: 0;
            line-height: 1.4;
        }

        .update-time {
            font-size: 12px;
            color: var(--gray-color);
        }

        .update-history-item .status-badge {
            margin-left: auto;
        }

        /* --- END: Booking History & Details Styles --- */


        /* --- END: Added for Services Tab & Booking Tabs --- */

        /* --- END: AVAILABILITY MODAL STYLES --- */
        /* --- NOTIFICATION POPUP STYLES --- */
        .notification-container {
            position: relative;
            margin-right: 25px;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -8px;
            background-color: #E53935;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-size: 11px;
            font-weight: 600;
            border: 2px solid var(--light-gray-color);
        }

        .notification-popup {
            display: none;
            position: absolute;
            top: 140%;
            right: -20px;
            width: 320px;
            background-color: var(--white-color);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            padding: 15px;
            z-index: 100;
            align-items: center;
            gap: 15px;
        }

        .notification-container:hover .notification-popup {
            display: flex;
        }

        .notification-popup img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .notification-popup .popup-text p {
            font-size: 14px;
            margin: 0;
            line-height: 1.4;
            color: var(--dark-color);
        }

        .notification-popup .popup-text a {
            font-size: 14px;
            font-weight: 600;
            text-decoration: underline;
            color: var(--dark-color);
        }

        .notification-popup .fa-chevron-right {
            margin-left: auto;
            color: var(--gray-color);
        }

        /* --- RATING PAGE STYLES --- */
        .rating-page-main {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 40px;
        }

        .rating-card {
            width: 100%;
            max-width: 550px;
            text-align: center;
        }

        .rating-card h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .rating-question {
            font-size: 16px;
            color: var(--gray-color);
            margin-bottom: 25px;
        }

        .rating-input-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .rating-input-group input[type="radio"] {
            display: none;
        }

        .rating-input-group label {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            display: grid;
            place-items: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rating-input-group label:hover {
            background-color: var(--secondary-color);
            border-color: var(--primary-color);
        }

        .rating-input-group input[type="radio"]:checked+label {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--dark-color);
        }

        .rating-note {
            font-size: 13px;
            color: var(--gray-color);
            margin: 15px 0;
        }

        .rating-card textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            font-family: var(--font-family);
            margin-top: 10px;
            margin-bottom: 20px;
        }

        /* --- New CSS for the Feedback Success Page --- */
        #feedback-success-page .main-content {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #feedback-success-page .card {
            background-color: var(--white-color);
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 550px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        #feedback-success-page .feedback-success-content p {
            font-size: 16px;
            line-height: 1.6;
            color: var(--dark-color);
            margin-top: 15px;
            margin-bottom: 25px;
        }

        #feedback-success-page .btn {
            width: 200px;
            padding: 12px 28px;
        }

        /* --- Support Page Styles --- */
        .support-breadcrumbs {
            font-size: 14px;
            color: var(--gray-color);
        }

        .support-breadcrumbs a,
        .support-breadcrumbs span {
            font-weight: 500;
        }

        .support-breadcrumbs a {
            color: var(--dark-color);
        }

        .support-breadcrumbs>span {
            color: var(--gray-color);
        }

        .support-content-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .support-sidebar {
            background-color: var(--white-color);
            border-radius: 12px;
            padding: 20px;
        }

        .support-sidebar-link {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .support-topics {
            margin-top: 20px;
        }

        .support-topics h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .support-topics ul {
            list-style: none;
        }

        .support-topics li a {
            display: block;
            padding: 8px 0;
            font-size: 14px;
            color: var(--gray-color);
        }

        .see-all-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            font-weight: 500;
            color: var(--primary-color);
        }

        .support-article h1,
        .support-article h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .support-article ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .support-article p {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .help-link {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background-color: var(--dark-color);
            color: var(--white-color);
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .search-bar {
            position: relative;
            width: 250px;
        }

        .search-bar input {
            width: 100%;
            padding: 8px 15px 8px 35px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 14px;
        }

        .search-bar i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }


        /* --- INVITE FRIENDS PAGE STYLES --- */
        .invite-header-card {
            background-color: #1a202c;
            color: var(--white-color);
            text-align: center;
        }

        .invite-header-card h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .invite-header-card p {
            color: #a0aec0;
        }

        .benefits-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .benefit-item i {
            color: #4299e1;
        }

        .terms-text {
            font-size: 12px;
        }

        .terms-text a {
            color: var(--primary-color);
            text-decoration: underline;
        }

        .share-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
        }

        .share-tag {
            font-size: 12px;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
        }

        .share-card h3 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .share-link-wrapper {
            display: flex;
            width: 100%;
            max-width: 500px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .share-link-wrapper input {
            flex-grow: 1;
            border: none;
            padding: 0 15px;
            background: none;
            color: var(--gray-color);
            font-size: 14px;
        }

        .share-link-wrapper input:focus {
            outline: none;
        }

        .share-link-wrapper button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            background-color: #333;
            color: white;
        }

        .or-text {
            margin: 20px 0;
            font-size: 14px;
            color: var(--gray-color);
        }

        .referral-code {
            background-color: var(--light-gray-color);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .social-share-btns {
            display: flex;
            gap: 15px;
        }

        .social-share-btns button i {
            margin-right: 8px;
        }

        .rewards-card {
            margin-top: 30px;
        }

        .rewards-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .rewards-header h3 {
            font-size: 20px;
            font-weight: 600;
        }

        .rewards-header span {
            font-weight: 500;
        }

        .rewards-content {
            display: flex;
            align-items: center;
            gap: 40px;
            margin-top: 20px;
        }

        .reward-summary-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #1a202c;
            color: var(--white-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-shrink: 0;
        }

        .reward-summary-circle h2 {
            font-size: 28px;
            margin: 0;
        }

        .reward-summary-circle p {
            font-size: 14px;
            margin: 0;
            color: #a0aec0;
        }

        .reward-summary-circle hr {
            width: 30%;
            border-color: #4a5568;
            margin: 8px 0;
        }

        .rewards-table {
            width: 100%;
        }

        .rewards-table-header,
        .rewards-table-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            padding: 12px 0;
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
        }

        .rewards-table-header {
            font-weight: 600;
            color: var(--gray-color);
        }

        .rewards-table-row {
            color: var(--gray-color);
        }

        .rewards-table-row:last-child {
            border-bottom: none;
        }

        /* --- INSTRUCTOR DASHBOARD STYLES --- */
        .offer-banner {
            background-color: var(--secondary-color);
            border: 1px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            font-weight: 500;
        }

        .offer-banner .fa-star {
            color: var(--primary-color);
        }

        .instructor-dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .instructor-dashboard-header h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 0;
        }

        .instructor-actions {
            display: flex;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card p {
            color: var(--gray-color);
            font-size: 14px;
        }

        .stat-card h3 {
            font-size: 28px;
            font-weight: 600;
            margin: 5px 0 10px 0;
        }

        .stat-card a {
            font-size: 13px;
            font-weight: 500;
            text-decoration: underline;
        }

        .upcoming-booking-list .card {
            padding: 0;
        }

        .booking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
        }

        .booking-item-main {
            display: flex;
            align-items: center;
            gap: 40px;
            flex-grow: 1;
        }

        .booking-item-section p {
            font-size: 13px;
            color: var(--gray-color);
            margin-bottom: 4px;
        }

        .booking-item-section span {
            font-weight: 500;
        }

        .booking-item-section h5 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
        }

        .learner-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .learner-details img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .learner-details small {
            display: block;
            color: var(--gray-color);
            font-size: 12px;
        }

        .booking-item-actions a {
            font-weight: 600;
        }

        .ez-rewards-card {
            background-color: var(--secondary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        .ez-rewards-card h5 {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .ez-rewards-card h3 {
            font-size: 24px;
            font-weight: 700;
        }

        .ez-rewards-card p {
            font-size: 13px;
            color: var(--gray-color);
        }

        .instructor-logout-btn {
            width: 100%;
        }

        .instructor-photo-new img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* --- INSTRUCTOR DASHBOARD BOOKING LIST STYLES --- */
        .upcoming-booking-list .card {
            padding: 0;
            overflow: hidden;
            /* Ensures border-radius is respected by children */
        }

        .booking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            gap: 20px;
        }

        .booking-item-main {
            display: flex;
            align-items: center;
            gap: 40px;
            /* Space between columns */
            flex-grow: 1;
        }

        .booking-item-section p {
            font-size: 13px;
            color: var(--gray-color);
            margin-bottom: 8px;
        }

        .booking-item-section span {
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .learner-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .learner-details img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .learner-details h5 {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.2;
        }

        .learner-details small {
            display: block;
            font-size: 12px;
            font-weight: 400;
            color: var(--gray-color);
        }

        .booking-item-location {
            background-color: var(--light-gray-color);
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            font-size: 14px;
            font-weight: 500;
        }

        .booking-item-location span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* --- PENDING PROPOSALS TAB STYLE --- */
        #pending-proposals-content.tab-content {
            background: none;
            border: none;
            padding-top: 25px;
            text-align: left;
            font-size: 14px;
        }

        #pending-proposals-content.tab-content a {
            color: var(--primary-color);
            font-weight: 600;
            text-decoration: underline;
        }

        /* --- INSTRUCTOR BOOKING HISTORY STYLES --- */
        #booking-history-content.tab-content {
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }

        .booking-history-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .history-table.card {
            padding: 0;
        }

        .history-table-header,
        .history-table-row {
            display: grid;
            grid-template-columns: 0.8fr 1.5fr 1.2fr 1.2fr 2.5fr 1fr 1fr;
            gap: 15px;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table-header {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
        }

        .history-table-row {
            font-size: 14px;
        }

        .history-table-row:last-child {
            border-bottom: none;
        }

        .learner-cell {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .learner-cell img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* --- INSTRUCTOR BOOKING DETAILS STYLES --- */
        .booking-details-title {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .booking-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 30px;
            margin-top: 20px;
        }

        .booking-details-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }

        .booking-details-info i {
            font-size: 16px;
            color: var(--gray-color);
            width: 20px;
            text-align: center;
        }

        .booking-details-info.learner-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .booking-details-info strong {
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-color);
        }

        .booking-details-info p {
            font-weight: 500;
            line-height: 1.4;
        }

        .payment-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-details-header h4 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payment-details-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .payment-amount h2 {
            font-size: 36px;
        }

        .payment-amount p {
            font-size: 14px;
            color: var(--gray-color);
            text-align: right;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notes-header h4 {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notes-header i {
            font-weight: 400;
            color: var(--gray-color);
        }

        .notes-body {
            text-align: center;
            padding: 30px;
            color: var(--gray-color);
        }

        .history-table-header.wide-grid,
        .history-table-row.wide-grid {
            grid-template-columns: 40px 3fr 1fr 1fr;
        }

        .update-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-gray-color);
            display: grid;
            place-items: center;
            font-size: 16px;
            color: var(--gray-color);
        }

        .instructor-view {
            display: none;
        }

        .instructor-view.active {
            display: block;
        }

        .learners-list {
            padding: 0;
            overflow: hidden;
        }

        .learners-list-header,
        .learners-list-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 1.5fr 2fr;
            gap: 20px;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .learners-list-header {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
        }

        .learners-list-row:last-child {
            border-bottom: none;
        }

        .learner-cell-details h5 {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 4px 0;
        }

        .learner-cell-details span {
            font-size: 14px;
            color: var(--gray-color);
        }

        .learners-list-row>div {
            font-weight: 500;
        }

        .learner-actions {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 20px;
        }

        .learner-actions a {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark-color);
            text-decoration: underline;
        }

        /* --- START: Invite Learner Modal Styles --- */
        .invite-modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .invite-modal-header i {
            font-size: 20px;
            color: var(--dark-color);
        }

        .invite-modal-header h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .invite-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* --- END: Invite Learner Modal Styles --- */

        .page-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .page-view-header h2 {
            font-size: 28px;
            font-weight: 600;
            margin: 5px 0 0 0;
        }

        .page-view-actions {
            display: flex;
            gap: 10px;
        }

        .draft-tag {
            background-color: #e0e0e0;
            color: var(--gray-color);
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            vertical-align: middle;
            margin-left: 10px;
        }

        .booking-proposal-card .form-group {
            margin-bottom: 25px;
        }

        .booking-proposal-card label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .learner-select-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .learner-select-group select {
            flex-grow: 1;
        }

        .learner-select-group .btn {
            padding: 10px 20px;
            flex-shrink: 0;
        }

        .booking-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--light-gray-color);
        }

        .booking-type-selector input[type="radio"] {
            display: none;
        }

        .booking-type-selector label {
            text-align: center;
            padding: 15px;
            cursor: pointer;
            margin-bottom: 0;
            color: var(--dark-color);
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .booking-type-selector input[type="radio"]:checked+label {
            background-color: var(--white-color);
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .booking-proposal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .booking-proposal-footer .footer-actions {
            display: flex;
            gap: 10px;
        }

        .learner-details-grid {
            display: grid;
            grid-template-columns: 1.5fr 2.5fr;
            gap: 30px;
            margin-top: 15px;
            align-items: start;
        }

        .learner-details-left-col,
        .learner-details-right-col {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .learner-profile-card {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 20px;
            align-items: center;
        }

        .learner-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--dark-color);
            display: grid;
            place-items: center;
            font-size: 32px;
            font-weight: 700;
        }

        .learner-info h3 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .age-tag {
            font-size: 14px;
            font-weight: 400;
            color: var(--gray-color);
        }

        .learner-tag {
            display: inline-block;
            background-color: var(--light-gray-color);
            color: var(--gray-color);
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 4px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .learner-info p {
            font-size: 14px;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .learner-profile-card .btn {
            grid-column: 1 / -1;
            /* Span full width */
            margin-top: 15px;
        }

        .learner-notes-card-body {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
        }

        .learner-history-table {
            width: 100%;
            font-size: 14px;
        }

        .learner-history-header,
        .learner-history-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1.2fr 2fr 1.2fr 1.2fr;
            gap: 15px;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .learner-history-header {
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
        }

        .learner-history-row:last-child {
            border-bottom: none;
        }

        /* --- START: INSTRUCTOR FEEDBACK PAGE STYLES (EZLicence Look) --- */
        /* --- START: INSTRUCTOR FEEDBACK PAGE STYLES (Corrected Version) --- */
        .feedback-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--white-color);
            padding: 20px;
            text-align: center;
        }

        .feedback-content {
            width: 100%;
            max-width: 600px;
        }

        .feedback-content .logo {
            justify-content: center;
            margin-bottom: 30px;
        }

        .feedback-content .logo img {
            height: 35px;
        }

        .feedback-content .logo span {
            font-size: 24px;
            font-weight: 700;
        }

        .feedback-content h2 {
            font-size: 20px;
            font-weight: 400;
            /* Lighter font weight */
            color: #495057;
            /* Softer text color */
            margin-bottom: 40px;
            line-height: 1.5;
        }

        .feedback-content p {
            color: var(--dark-color);
            margin-bottom: 8px;
            text-align: left;
            /* Aligns "Answer required" to the left */
            font-size: 14px;
        }

        .feedback-content textarea {
            width: 100%;
            border: 1px solid #adb5bd;
            /* Specific grey border */
            font-size: 16px;
            font-family: var(--font-family);
            min-height: 50px;
            padding: 12px 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .feedback-content .btn-submit-dark {
            background-color: #adb5bd;
            /* Lighter grey button */
            color: var(--dark-color);
            border: none;
            font-weight: 600;
            padding: 10px 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }

        .feedback-content .btn-submit-dark:hover {
            background-color: #868e96;
        }

        /* --- END: INSTRUCTOR FEEDBACK PAGE STYLES --- */

        /* --- START: SUPPORT INDEX PAGE STYLES --- */
        #support-index-page {
            background-color: var(--white-color);
        }

        .support-index-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            font-family: var(--font-family);
        }

        .support-index-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .support-index-header .breadcrumbs {
            font-size: 14px;
            color: var(--dark-color);
        }

        .support-index-header .search-bar input {
            width: 250px;
            padding: 10px 15px 10px 40px;
            border-radius: 6px;
        }

        .support-index-header .search-bar i {
            left: 15px;
        }

        .support-index-title h1 {
            font-size: 36px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .support-index-title p {
            font-size: 16px;
            color: var(--gray-color);
            margin-bottom: 40px;
        }

        .support-category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 60px;
        }

        .support-category-column h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .support-category-column ul {
            list-style: none;
            padding: 0;
        }

        .support-category-column li a {
            display: block;
            padding: 12px 0;
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .support-category-column li a:hover {
            color: var(--primary-color);
        }

        /* --- END: SUPPORT INDEX PAGE STYLES --- */
        /* --- END: INSTRUCTOR FEEDBACK PAGE STYLES --- */
        /* --- START: SUPPORT ARTICLE PAGE STYLES --- */
        #support-page {
            background-color: var(--white-color);
        }

        .support-article-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            font-family: var(--font-family);
        }

        .support-article-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            /* Sidebar and main content */
            gap: 60px;
            margin-top: 20px;
        }

        .support-article-sidebar h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .support-article-sidebar ul {
            list-style: none;
            padding: 0;
        }

        .support-article-sidebar li a {
            display: block;
            padding: 8px 0;
            font-size: 14px;
            color: var(--dark-color);
            text-decoration: none;
        }

        .support-article-sidebar li a.active {
            font-weight: 700;
        }

        .support-article-content h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .support-article-content .meta {
            font-size: 13px;
            color: var(--gray-color);
            margin-bottom: 40px;
        }

        .support-article-content h3 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .support-article-content p,
        .support-article-content ul {
            font-size: 16px;
            line-height: 1.7;
            color: var(--dark-color);
        }

        .support-article-content ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .floating-help-btn {
            position: fixed;
            right: 30px;
            bottom: 30px;
            background-color: #1f2d3d;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 100;
        }

        /* --- END: SUPPORT ARTICLE PAGE STYLES --- */

        /* --- CONTACT MODAL STYLES --- */
        .contact-modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        #contact-modal p {
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        #contact-modal p a {
            font-weight: 600;
            text-decoration: underline;
        }

        .contact-modal-images {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .contact-modal-images img {
            height: 250px;
            width: auto;
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }

        /* --- INSTRUCTOR REFERRAL PAGE --- */
        .referral-header-card {
            background-color: #1a202c;
            color: #fff;
            text-align: center;
            padding: 30px;
        }

        .referral-header-card h2 {
            color: #fff;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .referral-header-card>p {
            color: #a0aec0;
            margin-bottom: 20px;
        }

        .how-it-works-link {
            color: var(--primary-color);
            text-decoration: underline;
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 30px;
            display: inline-block;
        }

        .referral-steps {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }

        .referral-step {
            flex: 1;
        }

        .referral-step span {
            display: block;
            background-color: var(--primary-color);
            color: var(--dark-color);
            font-weight: 600;
            padding: 8px 10px;
            /* Increased padding */
            border-radius: 6px;
            /* Slightly more rounded corners */
            margin-bottom: 15px;
            /* More space below */
            min-height: 40px;
            /* Ensures all boxes are the same height */
            display: grid;
            /* Added for vertical centering */
            place-items: center;
            /* Added for vertical centering */
        }

        .referral-step p {
            font-size: 14px;
            color: #d1d5db;
            line-height: 1.5;
        }

        .referral-terms {
            text-align: left;
            border-top: 1px solid #4a5568;
            padding-top: 20px;
            font-size: 13px;
            color: #a0aec0;
        }

        .referral-terms h4 {
            font-size: 14px;
            color: #fff;
            margin-bottom: 10px;
        }

        .referral-terms ul {
            list-style: disc;
            padding-left: 20px;
        }

        .referral-terms ul li {
            margin-bottom: 8px;
        }

        .referral-form-card {
            margin-top: 30px;
        }

        .referral-form-card h2 {
            font-size: 22px;
            font-weight: 600;
            padding-bottom: 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 30px;
        }

        .radio-group {
            display: flex;
            align-items: center;
            gap: 10px;
            height: 45px;
        }

        .radio-group label {
            margin-bottom: 0;
        }

        .radio-group input {
            margin-right: 5px;
        }

        .form-footer-note {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-color);
            font-size: 14px;
        }

        .form-footer-note a {
            color: var(--dark-color);
            text-decoration: underline;
            font-weight: 500;
        }

        .rewards-card-link {
            text-decoration: none;
        }

        /* --- REVIEWS MODAL STYLES --- */
        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .reviews-header h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .reviews-header .modal-close-btn {
            position: static;
            /* Override absolute positioning */
            font-size: 24px;
        }

        .reviews-body {
            padding: 20px 25px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .reviews-notice {
            background-color: #eef2f7;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .review-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
        }

        .review-item:last-child {
            border-bottom: none;
        }

        .review-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .review-meta span {
            color: var(--gray-color);
        }

        .review-stars {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .review-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-color);
        }

        .reviews-footer {
            padding: 15px 25px;
            border-top: 1px solid var(--border-color);
            background-color: #f9fafb;
            text-align: center;
        }

        .reviews-footer a {
            display: inline-block;
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
        }

        .reviews-footer a.active {
            background-color: var(--primary-color);
            color: var(--dark-color);
        }

        /* --- INSTRUCTOR CALENDAR VIEW STYLES --- */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-title h2 {
            font-size: 28px;
            font-weight: 600;
            margin: 0;
        }

        .calendar-actions {
            display: flex;
            gap: 10px;
        }

        .calendar-options-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .smart-scheduling-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .smart-scheduling-toggle .fa-info-circle {
            color: var(--gray-color);
        }

        .lesson-duration-options label {
            font-weight: 500;
            margin-left: 15px;
        }

        .lesson-duration-options input {
            margin-right: 5px;
        }

        .calendar-container {
            padding: 0;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .month-display {
            font-size: 18px;
            font-weight: 500;
        }

        .view-switcher .btn {
            border-radius: 0;
        }

        .view-switcher .btn:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }

        .view-switcher .btn:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .view-switcher .btn.active {
            background-color: var(--dark-color);
            color: var(--white-color);
        }

        .calendar-grid-container {
            overflow-x: auto;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            min-width: 900px;
        }

        .day-header-spacer {
            border-bottom: 1px solid var(--border-color);
        }

        .day-header {
            text-align: center;
            padding: 10px 0;
            font-size: 14px;
            color: var(--gray-color);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .day-header strong {
            font-weight: 600;
            color: var(--dark-color);
        }

        /* --- CALENDAR TODAY INDICATOR (Corrected) --- */
        .day-header.today {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 2px;
            /* Adds a small space between day and number */
            height: 57px;
            /* Matches the height of other day headers */
            padding: 5px 0;
        }

        .day-header.today span {
            background-color: var(--primary-color);
            color: var(--dark-color);
            font-weight: 600;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            margin: 0 auto;
            /* Centers the circle */
        }

        .time-label {
            grid-column: 1;
            text-align: right;
            padding-right: 10px;
            font-size: 13px;
            color: var(--gray-color);
            position: relative;
            top: -10px;
        }

        .time-slot {
            border-left: 1px solid var(--border-color);
            border-top: 1px dashed var(--border-color);
            height: 60px;
            position: relative;
        }

        .time-slot.with-event {
            position: relative;
        }

        .calendar-event {
            position: absolute;
            left: 5px;
            right: 5px;
            border-radius: 8px;
            padding: 8px;
            font-size: 13px;
            color: var(--dark-color);
            overflow: hidden;
            z-index: 2;
        }

        .calendar-event.event-lesson {
            background-color: #FFF9C4;
            border-left: 4px solid var(--primary-color);
        }

        .calendar-event.event-personal {
            background-color: #E3F2FD;
            border-left: 4px solid #2196F3;
        }

        .calendar-event strong {
            font-weight: 600;
            display: block;
        }

        .main-content-footer {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            margin-top: 20px;
            font-size: 14px;
            color: var(--gray-color);
            border-top: 1px solid var(--border-color);
        }

        .main-content-footer a {
            margin-left: 20px;
            text-decoration: underline;
        }

        /* --- Toggle Switch from W3Schools --- */
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: var(--primary-color);
        }

        input:focus+.slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* --- INSTRUCTOR PRICING VIEW STYLES --- */
        .pricing-header {
            margin-bottom: 30px;
        }

        .pricing-header h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .pricing-header p {
            color: var(--gray-color);
            line-height: 1.6;
        }

        .pricing-header p strong {
            color: var(--dark-color);
        }

        .pricing-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
        }

        .pricing-item:first-of-type {
            border-top: none;
            padding-top: 0;
        }

        .pricing-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .pricing-label .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .pricing-label .dot.yellow {
            background-color: var(--primary-color);
        }

        .pricing-label .dot.blue {
            background-color: #3b82f6;
        }

        .pricing-value {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 16px;
            font-weight: 500;
        }

        .pricing-value .btn {
            padding-left: 20px;
            padding-right: 20px;
        }

        .pricing-value .btn i {
            margin-right: 5px;
        }

        /* --- INSTRUCTOR EDIT PRICE VIEW STYLES --- */
        .edit-price-header {
            margin-bottom: 25px;
        }

        .edit-price-header .back-link {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-color);
            margin-bottom: 5px;
        }

        .edit-price-header h2 {
            font-size: 28px;
            font-weight: 600;
        }

        .edit-price-container {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .price-info {
            font-size: 14px;
            color: var(--gray-color);
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .price-note {
            font-size: 13px;
            color: var(--gray-color);
            line-height: 1.6;
        }

        .pricing-footer-note {
            font-size: 13px;
            color: var(--gray-color);
            margin-top: 15px;
        }

        .edit-price-sidebar h4 {
            font-weight: 600;
        }

        .edit-price-sidebar p {
            font-size: 14px;
            color: var(--gray-color);
        }

        .edit-price-sidebar p strong {
            color: var(--dark-color);
        }

        .success-message {
            position: fixed;
            top: 30px;
            right: 30px;
            background-color: #d1fae5;
            color: #065f46;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 5px solid #10b981;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
        }

        .success-message span {
            font-weight: 600;
        }

        .success-message p {
            margin: 0;
        }

        .success-message .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #065f46;
            margin-left: auto;
            padding-left: 20px;
        }

        /* --- CREATE EVENT DROPDOWN STYLES --- */
        .create-event-dropdown {
            display: none;
            /* Hidden by default */
            position: absolute;
            top: 105%;
            right: 0;
            background-color: var(--white-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            width: 200px;
            z-index: 100;
            overflow: hidden;
        }

        .create-event-dropdown.active {
            display: block;
            /* Shown when active */
        }

        .create-event-dropdown a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            font-size: 14px;
            color: var(--dark-color);
        }

        .create-event-dropdown a:hover {
            background-color: var(--light-gray-color);
        }

        .create-event-dropdown a i {
            width: 25px;
            margin-right: 5px;
            color: var(--gray-color);
        }

        /* --- NEW EVENT MODAL STYLES --- */
        .new-event-body {
            padding: 25px;
            max-height: 75vh;
            /* Set a maximum height (75% of the viewport height) */
            overflow-y: auto;
            /* Add a scrollbar only when needed */
        }

        .time-selector-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr auto 1fr auto 1fr;
            gap: 10px;
            align-items: center;
        }

        .time-selector-grid select,
        .new-event-body select,
        .new-event-body input,
        .new-event-body textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            font-family: var(--font-family);
        }

        .new-event-body .radio-group {
            display: flex;
            gap: 20px;
        }

        .new-event-body .radio-group label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- INSTRUCTOR BOOKING DETAILS VIEW STYLES --- */
        .booking-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .booking-details-header .back-link {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .booking-details-header h2 {
            font-size: 28px;
            font-weight: 600;
        }

        .modify-booking-wrapper {
            position: relative;
        }

        .modify-booking-dropdown {
            display: none;
            /* Hidden by default */
            position: absolute;
            top: 105%;
            right: 0;
            background-color: var(--white-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            width: 240px;
            z-index: 100;
            overflow: hidden;
        }

        .modify-booking-dropdown.active {
            display: block;
        }

        .modify-booking-dropdown a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            font-size: 14px;
            color: var(--dark-color);
        }

        .modify-booking-dropdown a:hover {
            background-color: var(--light-gray-color);
        }

        .modify-booking-dropdown a i {
            width: 25px;
            margin-right: 5px;
            color: var(--gray-color);
        }

        .booking-confirmation-banner {
            background-color: #d1fae5;
            color: #065f46;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .booking-details-card {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .booking-main-details h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .booking-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 30px;
        }

        .booking-info-grid .booking-info-item {
            gap: 15px;
        }

        .booking-learner-details {
            display: flex;
            gap: 15px;
            background-color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .booking-learner-details img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
        }

        .booking-learner-details p {
            color: var(--gray-color);
            font-size: 13px;
        }

        .booking-learner-details strong {
            font-size: 16px;
        }

        .booking-learner-details a {
            font-size: 14px;
            text-decoration: underline;
        }


        /* --- PROMOTION BANNER STYLES --- */
        .offer-banner-container {
            padding: 0;
            overflow: hidden;
        }

        .offer-banner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            margin-bottom: 0;
        }

        .offer-banner>div {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .banner-arrow {
            transition: transform 0.3s ease;
        }

        .banner-arrow.rotated {
            transform: rotate(-180deg);
        }

        /* --- PROMOTION BANNER STYLES (Corrected) --- */
        .promotion-details {
            text-align: center;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            /* Smooth transition for padding */
        }

        .promotion-details.expanded {
            max-height: 300px;
            /* Or a larger value if your content needs more space */
            padding: 0px 40px 20px 40px;
            /* Padding is now only applied when expanded */
        }

        .promotion-details h4 {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 20px;
        }

        .fee-boxes {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .fee-box {
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: 600;
            border: 1px solid var(--border-color);
        }

        .fee-box span {
            display: block;
            font-size: 14px;
            font-weight: 400;
            color: var(--gray-color);
        }

        .fee-box.original {
            text-decoration: line-through;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
        }

        .promotion-terms {
            font-size: 13px;
            color: var(--gray-color);
        }


        /* --- INSTRUCTOR REPORTS VIEW STYLES --- */
        .reports-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 25px;
        }

        .reports-header h2 {
            font-size: 28px;
            font-weight: 600;
            margin: 0;
        }

        .reports-header .tabs {
            border-bottom: none;
            margin-bottom: 0;
        }

        .reports-header .tab-link {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid transparent;
        }

        .reports-header .tab-link.active {
            background-color: var(--secondary-color);
            border-color: var(--primary-color);
            color: var(--dark-color);
        }

        .reports-header .tab-link.active::after {
            display: none;
            /* remove the underline */
        }

        .stat-card a {
            color: var(--gray-color);
        }

        /* --- REPORTS - FINANCIAL YEAR TAB STYLES --- */
        .payout-legend {
            position: absolute;
            top: 70px;
            right: 40px;
            font-size: 13px;
            display: flex;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pending-payout-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .pending-payout-card h4 {
            margin: 0;
        }

        .next-payout-item {
            font-weight: 500;
            cursor: pointer;
        }

        .transaction-summary-card {
            padding: 0;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-header h4,
        .summary-header p,
        .summary-header a,
        .summary-header strong {
            margin: 0;
            line-height: 1.5;
        }

        .summary-header p {
            font-size: 13px;
            color: var(--gray-color);
        }

        .summary-header a {
            font-size: 14px;
            text-decoration: underline;
            font-weight: 500;
        }

        .fortnightly-reports-table {
            font-size: 14px;
        }

        .reports-table-header,
        .reports-table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .reports-table-header {
            font-weight: 500;
            color: var(--gray-color);
        }

        .reports-table-row:last-child {
            border-bottom: none;
        }

        .reports-table-row span:first-child {
            font-weight: 500;
        }

        .report-links {
            text-align: right;
        }

        .report-links a {
            text-decoration: underline;
            margin-left: 20px;
        }

        /* --- INSTRUCTOR TRANSACTION REPORT STYLES --- */
        .transaction-report-card {
            padding: 40px;
        }

        .report-header {
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .report-header .logo {
            justify-content: center;
            margin-bottom: 15px;
        }

        .report-header h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .report-header p {
            color: var(--gray-color);
            margin: 0;
        }

        .report-meta {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            line-height: 1.7;
            margin-bottom: 30px;
        }

        .report-meta span {
            color: var(--gray-color);
        }

        .report-table {
            font-size: 14px;
        }

        .report-table-header {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr 1fr 1fr;
            gap: 15px;
            padding: 10px 15px;
            background-color: var(--light-gray-color);
            font-weight: 600;
            color: var(--gray-color);
            border-radius: 6px;
        }

        .report-table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr 1fr 1fr;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .report-table-row.sub-item {
            color: var(--gray-color);
            padding-top: 0;
        }

        .report-table-row.net-row {
            font-weight: 600;
        }

        .text-right {
            text-align: right;
        }

        .report-table-footer {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            font-size: 14px;
            line-height: 2;
        }

        .report-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--gray-color);
        }

        .report-footer a {
            color: var(--dark-color);
            text-decoration: underline;
        }

        /* --- START: REPLACE with this CSS --- */
        .pending-payout-card.expanded {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            margin-bottom: 0;
            border-bottom: none;
        }

        .next-payout-item .fa-chevron-down {
            transition: transform 0.3s ease;
        }

        .next-payout-item.expanded .fa-chevron-down {
            transform: rotate(-180deg);
        }

        #payout-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding-top 0.4s ease-out, padding-bottom 0.4s ease-out;
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            padding-left: 20px;
            padding-right: 20px;
        }

        #payout-details-content.expanded {
            max-height: 500px;
            /* Adjust if content is taller */
            padding-top: 20px;
            padding-bottom: 20px;
        }

        .payout-details-header,
        .payout-details-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            padding: 10px 0;
        }

        .payout-details-header {
            font-weight: 500;
            color: var(--gray-color);
            font-size: 12px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 5px;
        }

        .payout-details-row>div:nth-child(3),
        .payout-details-row>div:nth-child(4) {
            text-align: right;
        }

        .payout-details-header>div:nth-child(3),
        .payout-details-header>div:nth-child(4) {
            text-align: right;
        }

        .payout-details-row div {
            font-weight: 500;
        }

        /* --- START: ADD FOR PROFILE DROPDOWN --- */
        .user-profile {
            position: relative;
            /* Required for dropdown positioning */
        }

        .profile-dropdown {
            display: none;
            /* Hidden by default */
            position: absolute;
            top: 120%;
            right: 0;
            background-color: var(--white-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 180px;
            z-index: 100;
            overflow: hidden;
            /* Ensures border-radius is applied to children */
            border: 1px solid var(--border-color);
        }

        .user-profile:hover .profile-dropdown {
            display: block;
            /* Show on hover */
        }

        .profile-dropdown a {
            display: block;
            padding: 12px 15px;
            font-size: 14px;
            color: var(--dark-color);
            font-weight: 500;
        }

        .profile-dropdown a:hover {
            background-color: var(--light-gray-color);
        }

        .profile-dropdown a i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
            color: var(--gray-color);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            min-width: 900px;
            position: relative;
            /* <-- ADD THIS LINE */
        }

        /* --- END: ADD FOR PROFILE DROPDOWN --- */
        /* --- END: CSS REPLACEMENT --- */
        /* --- START: Add these styles for the Profile Dropdown --- */

        /* This makes the user-profile a container for the absolute-positioned dropdown */
        .user-profile {
            position: relative;
        }

        .profile-dropdown {
            display: none;
            /* Hidden by default */
            position: absolute;
            top: 120%;
            /* Position it slightly below the user profile info */
            right: 0;
            background-color: var(--white-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 240px;
            /* Adjust width as needed */
            z-index: 100;
            overflow: hidden;
            /* Ensures border-radius is applied to children */
            border: 1px solid var(--border-color);
        }

        /* This is the magic part: When you hover over the .user-profile, the .profile-dropdown inside it becomes visible */
        .user-profile:hover .profile-dropdown {
            display: block;
        }

        .profile-dropdown a {
            display: flex;
            /* Use flexbox for alignment */
            align-items: center;
            /* Vertically align icon and text */
            padding: 12px 15px;
            font-size: 14px;
            color: var(--dark-color);
            font-weight: 500;
        }

        .profile-dropdown a:hover {
            background-color: var(--light-gray-color);
        }

        .profile-dropdown a i {
            margin-right: 12px;
            /* Space between icon and text */
            width: 20px;
            text-align: center;
            color: var(--gray-color);
        }

        /* --- END: Add these styles --- */

        /* --- START: Add these styles for the Notification Page --- */
        .notifications-list {
            padding: 0;
        }

        .notification-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .notification-item:hover {
            background-color: var(--light-gray-color);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item.unread {
            background-color: var(--secondary-color);
            border-left: 4px solid var(--primary-color);
        }

        .notification-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--light-gray-color);
            display: grid;
            place-items: center;
            font-size: 18px;
            color: var(--gray-color);
            flex-shrink: 0;
        }

        .notification-item.unread .notification-icon {
            background-color: var(--primary-color);
            color: var(--dark-color);
        }

        .notification-details p {
            margin: 0 0 4px 0;
            line-height: 1.4;
            font-size: 15px;
        }

        .notification-details p strong {
            font-weight: 600;
        }

        .notification-time {
            font-size: 13px;
            color: var(--gray-color);
        }

        .notification-item>.fa-chevron-right {
            margin-left: auto;
            color: var(--gray-color);
        }

        /* --- END: Notification Page Styles --- */
        /* --- START: Add these styles for the Booking Notification Modal --- */
        #booking-notification-modal-header h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 5px 0;
        }

        #booking-notification-modal-header p {
            color: var(--gray-color);
            margin: 0;
        }

        .modal-booking-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .lesson-tag {
            display: inline-block;
            background-color: var(--light-gray-color);
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .modal-booking-info p {
            margin: 0 0 8px 0;
            font-size: 15px;
        }

        .learner-name-modal {
            font-weight: 500;
        }

        .location-modal {
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-booking-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-self: flex-start;
            padding-top: 15px;
        }

        /* --- START: ADDED FOR NOTES FORM --- */
        .add-note-form {
            padding: 20px;
        }

        .note-input-group {
            margin-bottom: 15px;
            position: relative;
        }

        .note-input-group input,
        .note-input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: var(--font-family);
        }

        .note-input-group input:focus,
        .note-input-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .note-input-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .date-input-group i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        #add-note-form-container input#note-date {
            background-color: #fff;
            /* Ensure it's not greyed out */
        }

        /* --- START: ADDED FOR RESCHEDULE PAGE --- */
        .warning-box.danger {
            background-color: #fef2f2;
            /* Light red */
            border: 1px solid #fca5a5;
            /* Red border */
            color: #991b1b;
            /* Dark red text */
        }

        .warning-box.danger p {
            color: #b91c1c;
            /* Slightly lighter red for paragraph */
        }

        .new-tag {
            background-color: #d1fae5;
            /* Light green */
            color: #065f46;
            /* Dark green */
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            vertical-align: middle;
            margin-left: 10px;
        }

        #instructor-reschedule-booking-view .booking-details-info p {
            margin: 0;
            line-height: 1.4;
        }

        /* --- START: Added for strikethrough on old booking --- */
        #instructor-reschedule-booking-view .booking-details-grid {
            text-decoration: line-through;
            text-decoration-color: #b91c1c;
            /* A dark red color for the line */
            text-decoration-thickness: 2px;
            color: var(--gray-color);
            /* Fades the text to gray */
        }

        /* We don't want to strike through the icons or the "Learner details" title */
        #instructor-reschedule-booking-view .booking-details-grid i,
        #instructor-reschedule-booking-view .booking-details-grid .learner-info strong {
            text-decoration: none;
        }

        #instructor-reschedule-booking-view .booking-details-grid .learner-info strong {
            color: var(--dark-color);
            /* Keep the title text dark */
        }

        /* --- END: Added for strikethrough --- */
        /* --- END: ADDED FOR RESCHEDULE PAGE --- */
        /* --- END: ADDED FOR NOTES FORM --- */
        /* --- END: Booking Notification Modal Styles --- */

        /* --- START: ADD THESE CSS RULES --- */
        .calendar-event.event-proposed {
            background-color: #FFF9C4;
            /* Light yellow background */
            border-left: 4px solid var(--primary-color);
            /* Bright yellow left border */
        }

        /* --- END: ADDED CSS RULES --- */
        /* --- START: ADD THESE STYLES FOR THE PAYOUT ACCORDION --- */
        .pending-payout-card.expanded {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            margin-bottom: 0;
            border-bottom: none;
        }

        .next-payout-item .fa-chevron-down {
            transition: transform 0.3s ease;
        }

        .next-payout-item.expanded .fa-chevron-down {
            transform: rotate(-180deg);
        }

        #payout-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding-top 0.4s ease-out, padding-bottom 0.4s ease-out;
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            padding-left: 20px;
            padding-right: 20px;
        }

        #payout-details-content.expanded {
            max-height: 500px;
            /* Adjust if content is taller */
            padding-top: 20px;
            padding-bottom: 20px;
        }

        /* --- END: PAYOUT ACCORDION STYLES --- */
        /* --- START: Add these styles for the Payout Accordion --- */
        .pending-payout-card.expanded {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            margin-bottom: 0;
            border-bottom: none;
        }

        .next-payout-item .fa-chevron-down {
            transition: transform 0.3s ease;
        }

        .next-payout-item.expanded .fa-chevron-down {
            transform: rotate(-180deg);
        }

        #payout-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding-top 0.4s ease-out, padding-bottom 0.4s ease-out;
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            padding-left: 20px;
            padding-right: 20px;
        }

        #payout-details-content.expanded {
            max-height: 500px;
            /* Adjust if content is taller */
            padding-top: 20px;
            padding-bottom: 20px;
        }

        /* --- END: Payout Accordion Styles --- */

        /* --- START: ADD THESE STYLES FOR RESPONSIVENESS --- */

        /* --- Main Layout Adjustments for Tablets and Smaller --- */

        /* Hide hamburger on desktop by default */
        /* Hide hamburger on desktop by default */
        .mobile-menu-btn {
            display: none;
        }

        @media (max-width: 992px) {

            /* Hide hamburger on desktop by default */

            .dashboard-layout {
                grid-template-columns: 220px 1fr;
                /* Slightly smaller sidebar */
            }

            .main-content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                /* 2 columns on tablets */
            }

            .learner-details-grid {
                grid-template-columns: 1fr;
                /* Stack on tablets */
            }

            .login-page {
                grid-template-columns: 1fr;
                /* Stack login page on smaller screens */
            }

            .login-art {
                display: none;
                /* Hide the art on smaller screens for focus */
            }
        }

        /* --- Major Layout Changes for Mobile Phones --- */
        @media (max-width: 768px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
                /* Single column layout */
            }

            .sidebar {
                position: fixed;
                left: -100%;
                /* Hide sidebar off-screen by default */
                top: 0;
                height: 100vh;
                z-index: 1001;
                /* Ensure it's on top of content */
                transition: left 0.3s ease-in-out;
                width: 250px;
            }

            .sidebar.open {
                left: 0;
                /* Bring sidebar into view when open */
            }

            .main-content {
                width: 100%;
                padding-top: 80px;
                /* Add padding to top to avoid header overlap */
            }

            .dashboard-header {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                background: var(--light-gray-color);
                padding: 15px 20px;
                z-index: 1000;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            /* Hamburger menu icon styling */
            .mobile-menu-btn {
                display: block;
                font-size: 24px;
                background: none;
                border: none;
                cursor: pointer;
                z-index: 1002;
            }

            .stats-grid,
            .support-category-grid {
                grid-template-columns: 1fr;
                /* Single column on mobile */
            }

            #instructor-support-view .support-article-grid {
                grid-template-columns: 1fr;
            }

            #instructor-support-view .support-article-sidebar {
                display: none;
                /* Hiding this on mobile for simplicity, can be made into a dropdown */
            }

            .history-table-header,
            .history-table-row {
                display: block;
                border-bottom: 2px solid var(--primary-color);
                padding: 15px;
            }

            .history-table-header {
                display: none;
            }

            /* Hide headers, use data-labels */
            .history-table-row>div {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid var(--border-color);
            }

            .history-table-row>div:last-child {
                border-bottom: none;
            }

            .history-table-row>div::before {
                content: attr(data-label);
                font-weight: 600;
                margin-right: 10px;
            }

            /* Landing page hero section */
            .hero {
                flex-direction: column-reverse;
                padding: 20px;
            }

            .hero-images {
                margin-bottom: 30px;
                height: 300px;
            }

            .landing-container header {
                padding: 15px;
            }

            .nav-links .btn {
                display: none;
            }

            /* Hide login buttons in nav */
        }

        /* Add a class to handle the overlay when the menu is open */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            /* Hidden by default */
        }

        .overlay.active {
            display: block;
        }

        .location-tags-container {
            padding: 5px 20px 20px 20px;
        }

        .location-tag {
            display: inline-flex;
            align-items: center;
            background-color: #f1f1f1;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            margin: 5px;
        }

        .location-tag button {
            background: none;
            border: none;
            color: var(--gray-color);
            margin-left: 8px;
            font-size: 16px;
            cursor: pointer;
        }

        .day-row {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .day-row:last-of-type {
            border-bottom: none;
        }

        .day-row>.checkbox-container {
            flex-basis: 120px;
            flex-shrink: 0;
            font-weight: 500;
        }

        .time-slots-wrapper {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-grow: 1;
        }

        .time-slot-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .time-slot-group select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }

        .day-actions {
            flex-basis: 150px;
            flex-shrink: 0;
            text-align: right;
        }

        .day-actions a {
            margin-left: 15px;
            font-size: 14px;
            font-weight: 500;
            color: var(--dark-color);
            text-decoration: underline;
        }

        #service-area-map {
            height: 450px;
            /* You can adjust this height */
            width: 100%;
            border-radius: 8px;
            background-color: var(--light-gray-color);
        }

        /* --- START: NEW AVAILABILITY CALENDAR STYLES --- */
        #new-availability-container {
            padding: 10px 20px 20px 20px;
        }

        .availability-day-row {
            display: grid;
            grid-template-columns: 120px 1fr auto;
            align-items: center;
            gap: 20px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            transition: opacity 0.3s ease;
        }

        .availability-day-row:last-of-type {
            border-bottom: none;
        }

        .availability-day-row.day-disabled {
            opacity: 0.5;
        }

        .day-label {
            font-weight: 600;
            font-size: 16px;
        }

        .time-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-inputs input[type="time"] {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            font-family: var(--font-family);
            width: 120px;
        }

        .time-inputs input:disabled {
            background-color: #f1f1f1;
            cursor: not-allowed;
        }

        /* --- START: CALENDAR AVAILABILITY STYLES --- */
        .time-slot.slot-unavailable {
            background-color: #f0f0f0;
            /* Light gray for unavailable times */
        }

        .time-slot.slot-available {
            background-color: #A5D6A7;
            ;
            /* Light green for available times */
        }

        /* --- START: ADD FOR VERIFICATION STEPS --- */
        .verification-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            text-align: center;
        }

        .step-indicator {
            position: relative;
            color: var(--gray-color);
            font-weight: 500;
            width: 33.33%;
        }

        .step-indicator span {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: var(--white-color);
            border: 2px solid var(--border-color);
            margin: 0 auto 10px auto;
            font-weight: 600;
            font-size: 14px;
        }

        .step-indicator.active span {
            border-color: var(--primary-color);
        }

        .step-indicator.complete span {
            background-color: #4CAF50;
            /* Green */
            border-color: #4CAF50;
            color: white;
            font-size: 18px;
        }

        .step-indicator.complete span::after {
            content: '✓';
        }

        .step-indicator.active,
        .step-indicator.complete {
            color: var(--dark-color);
        }

        .verification-step {
            display: none;
            /* All steps hidden by default */
        }

        .verification-step.active {
            display: block;
            /* Show the active step */
        }

        /* --- START: ADD FOR SUPER ADMIN PAGE --- */
        .instructor-verification-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .instructor-verification-row:last-child {
            border-bottom: none;
        }

        .instructor-verification-header {
            font-weight: 600;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
        }

        #verification-modal-body .input-group {
            margin-bottom: 15px;
        }

        .document-link {
            display: inline-block;
            margin-top: 5px;
            font-weight: 500;
            text-decoration: underline;
        }

        .document-link i {
            margin-right: 5px;
        }

        /* --- END: ADD FOR SUPER ADMIN PAGE --- */
        /* --- END: ADD FOR VERIFICATION STEPS --- */
        /* --- END: CALENDAR AVAILABILITY STYLES --- */

        /* --- END: NEW AVAILABILITY CALENDAR STYLES --- */
        /* --- END: RESPONSIVENESS STYLES --- */

        /* --- START: ADD FOR SUPER ADMIN CONTROLS --- */
        .user-control-header,
        .user-control-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            gap: 15px;
        }

        .user-control-header {
            font-weight: 600;
            color: var(--gray-color);
            background-color: var(--light-gray-color);
        }

        .user-control-row:last-child {
            border-bottom: none;
        }

        .status-indicator {
            font-weight: 600;
        }

        .status-indicator.active {
            color: #4CAF50;
            /* Green */
        }

        .status-indicator.disabled {
            color: #E53935;
            /* Red */
        }

        /* --- END: ADD FOR SUPER ADMIN CONTROLS --- */
        /* --- START: ADD FOR USER DETAILS MODAL --- */

        /* Clickable user name in the admin list */
        .user-control-row .user-name-link {
            font-weight: 600;
            color: var(--dark-color);
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s ease;
            /* Add smooth color transition */
        }

        .user-control-row .user-name-link:hover {
            color: var(--primary-color);
        }

        /* Modal Body Content Styling */
        /* Modal Body Content Styling */
        #user-details-modal-body {
            padding-top: 10px;
            /* Add some space below the title */
            max-height: 60vh;
            /* Limit height to 60% of viewport height */
            overflow-y: auto;
            /* Add vertical scrollbar ONLY if needed */
            padding-right: 15px;
            /* Add padding to prevent scrollbar overlap */
        }

        #user-details-modal-body .detail-item {
            margin-bottom: 15px;
            /* Increase spacing between items */
            font-size: 15px;
            line-height: 1.5;
            /* Improve readability for multi-line details */
        }

        #user-details-modal-body .detail-item strong {
            display: inline-block;
            width: 140px;
            /* Slightly adjust width if needed */
            color: var(--gray-color);
            font-weight: 500;
            margin-right: 10px;
            /* Add space between label and value */
            vertical-align: top;
            /* Align label top if value wraps */
        }

        /* Ensure status indicator within modal looks right */
        #user-details-modal-body .status-indicator {
            font-weight: 600;
            padding: 2px 6px;
            /* Add slight padding */
            border-radius: 4px;
            /* Slightly rounded corners */
            font-size: 13px;
            /* Smaller font size */
            display: inline-block;
            /* Make it behave like a badge */
        }

        #user-details-modal-body .status-indicator.active {
            background-color: #E6F4EA;
            /* Light green background */
            color: #4CAF50;
        }

        #user-details-modal-body .status-indicator.disabled {
            background-color: #fdecea;
            /* Light red background */
            color: #E53935;
        }


        #user-details-modal-body img.user-photo-modal {
            max-width: 120px;
            /* Slightly larger image */
            max-height: 120px;
            border-radius: 8px;
            margin-top: 8px;
            /* Consistent margin */
            border: 1px solid var(--border-color);
            display: block;
            /* Ensure it takes its own line */
        }

        /* --- Improved Close Button ('X' in corner) Styling --- */
        /* This reuses and slightly refines the general modal close button */
        #user-details-modal .modal-close-btn {
            position: absolute;
            top: 12px;
            /* Consistent positioning */
            right: 18px;
            /* Consistent positioning */
            background: none;
            border: none;
            font-size: 30px;
            /* Adjusted size */
            font-weight: 300;
            line-height: 1;
            cursor: pointer;
            color: var(--gray-color);
            padding: 5px;
            transition: color 0.2s ease, transform 0.2s ease;
            z-index: 10;
            opacity: 0.7;
        }

        #user-details-modal .modal-close-btn:hover {
            color: var(--dark-color);
            transform: scale(1.1);
            opacity: 1;
        }

        /* --- Styling for the "Close" Button in the Footer --- */
        /* This reuses the general secondary button style */
        #user-details-modal .form-actions .modal-close-btn {
            /* Inherits styles from .btn and .btn-secondary */
            position: static;
            /* Important: Override absolute positioning */
            font-size: inherit;
            font-weight: inherit;
            padding: 12px 28px;
            opacity: 1;
            transform: none;
            color: var(--dark-color);
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
        }

        #user-details-modal .form-actions .modal-close-btn:hover {
            background-color: var(--light-gray-color);
            color: var(--dark-color);
        }


        /* --- END: ADD FOR USER DETAILS MODAL --- */
    </style>
</head>

<body>
    <div id="page-overlay" class="overlay"></div>


    <div id="landing-page" class="page active">
        <div class="landing-container">
            <header>
                <nav>
                    <div class="logo">
                        <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                        <span>SAFE LEARNERS</span>
                    </div>
                    <div class="nav-links">
                        <a href="#">Sydney ▾</a>
                        <a href="#" id="instructor-login-btn-1" class="btn btn-secondary">Instructor Login</a>
                        <a href="#" id="learner-login-btn-1" class="btn btn-primary">Learner Login</a>
                    </div>
                </nav>
            </header>

            <main class="hero">
                <div class="hero-content">
                    <span class="tag">Driving excellence</span>
                    <h1>Find the Right Fit from <br>1000+ Trusted Driving <br><span>Instructors</span></h1>
                    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been
                        the industry's standard dummy text ever since the 1500s.</p>
                    <div class="hero-buttons">
                        <a href="#" id="learner-login-btn-2" class="btn btn-primary">Learner Login</a>
                        <a href="#" id="instructor-login-btn-2" class="btn btn-secondary">Instructor Login</a>
                    </div>
                </div>
                <div class="hero-images">
                    <div class="happy-client-badge">
                        <p><strong>30K +</strong><span>happy client</span></p>
                    </div>
                    <img src="istockphoto-1490391507-612x612.jpg" alt="Happy Driver 1" class="hero-img-1">
                    <img src="istockphoto-1462539852-612x612.jpg" alt="Happy Driver 2" class="hero-img-2">
                </div>
            </main>

            <div class="road-footer">
                <img src="291429995_48aa561c-0fb7-4de1-8956-55dac2201764 1.png" alt="Yellow Sports Car"
                    class="car-graphic">
            </div>
        </div>
    </div>

    <div id="login-page" class="page">
        <div class="login-page">
            <div class="login-art">
                <div class="logo-large">
                    <img src="https://placehold.co/150x150/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h2>SAFE LEARNERS</h2>
                    <p>DRIVE RIGHT</p>
                </div>
                <div class="road-footer">
                    <img src="291429995_48aa561c-0fb7-4de1-8956-55dac2201764 1.png" alt="Yellow Sports Car"
                        class="car-graphic">
                </div>
            </div>
            <div class="login-form-container">
                <form id="login-form">
                    <h2 id="login-title">Instructor <span class="text-primary">Login</span></h2>
                    <div class="input-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="input-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <div class="form-options">
                        <label class="checkbox-container">
                            <input type="checkbox" name="remember">
                            <span class="checkmark"></span>
                            Remember Me For 90 Days
                        </label>
                        <a href="#" class="forgot-password">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Login</button>
                    <p id="error-message" class="error-text"></p>
                    <p class="signup-link">Don't Have An Account? <a href="#" id="go-to-signup">Signup Now</a></p>

                    <p class="signup-link" style="margin-top: 10px;"><a href="#"
                            onclick="showPage('landing-page')">&larr; Back to Home</a></p>
                </form>
            </div>
        </div>
    </div>
    <div id="signup-page" class="page">
        <div class="login-page">
            <div class="login-art">
                <div class="logo-large">
                    <img src="https://placehold.co/150x150/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h2>SAFE LEARNERS</h2>
                    <p>DRIVE RIGHT</p>
                </div>
                <div class="road-footer">
                    <img src="291429995_48aa561c-0fb7-4de1-8956-55dac2201764 1.png" alt="Yellow Sports Car"
                        class="car-graphic">
                </div>
            </div>
            <div class="login-form-container">
                <form id="signup-form">
                    <h2>Learner <span class="text-primary">Signup</span></h2>

                    <div class="form-row">
                        <div class="input-group">
                            <label for="signup-firstname">First Name</label>
                            <input type="text" id="signup-firstname" name="firstName" required>
                        </div>
                        <div class="input-group">
                            <label for="signup-surname">Surname</label>
                            <input type="text" id="signup-surname" name="surname" required>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="signup-email">Email Address</label>
                        <input type="email" id="signup-email" name="email" required>
                    </div>
                    <div class="input-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" name="password" minlength="6" required>
                    </div>

                    <div class="form-row">
                        <div class="input-group">
                            <label for="signup-mobile">Mobile Number</label>
                            <input type="tel" id="signup-mobile" name="mobile" required>
                        </div>
                        <div class="input-group">
                            <label for="signup-dob">Date Of Birth</label>
                            <input type="date" id="signup-dob" name="dob" required>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="signup-gender">Gender</label>
                        <select id="signup-gender" name="gender" required>
                            <option value="" disabled selected>Select gender...</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">Create Account</button>
                    <p id="signup-error-message" class="error-text"></p>
                    <p class="signup-link">Already Have An Account? <a href="#" id="go-to-login">Login Now</a></p>
                </form>
            </div>
        </div>
    </div>

    <div id="super-admin-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SUPER ADMIN</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li class="active"><a href="#" data-view="super-admin-verifications">Pending Verifications</a>
                        </li>
                        <li><a href="#" data-view="super-admin-controls">Controls</a></li>
                        <li><a href="#" data-view="super-admin-past-bookings"> Bookings</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <button class="btn btn-secondary instructor-logout-btn">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <h3>Pending Instructor Verifications</h3>
                </header>
                <div id="pending-instructors-list" class="card" style="padding: 0;">
                </div>
            </main>
            <main id="super-admin-controls-view" class="main-content" style="display: none;">
                <header class="dashboard-header">
                    <h3>User Controls</h3>
                </header>

                <div class="tabs">
                    <button class="tab-link active" data-target="instructor-controls-content">Instructors</button>
                    <button class="tab-link" data-target="learner-controls-content">Learners</button>
                </div>

                <div id="instructor-controls-content" class="tab-pane active" style="margin-top: 20px;">
                    <div class="card" style="padding: 0;">
                    </div>
                </div>

                <div id="learner-controls-content" class="tab-pane" style="margin-top: 20px; display: none;">
                    <div class="card" style="padding: 0;">
                    </div>
                </div>
            </main>

            <main id="super-admin-past-bookings-view" class="main-content" style="display: none;">
                <header class="dashboard-header">
                    <h3>Learner & Instructor Bookings</h3>
                </header>
                
                <div class="tabs">
                    <button class="tab-link active" data-target="admin-learners-booking-tab">Learners</button>
                    <button class="tab-link" data-target="admin-instructors-booking-tab">Instructors</button>
                </div>

                <div id="admin-learners-booking-tab" class="tab-pane active" style="margin-top: 20px;">
                    <div class="card" style="padding: 0;">
                        <p style="padding: 20px; text-align: center;">Loading learners...</p>
                    </div>
                </div>
                
                <div id="admin-instructors-booking-tab" class="tab-pane" style="margin-top: 20px; display: none;">
                    <div class="card" style="padding: 0;">
                        <p style="padding: 20px; text-align: center;">Loading instructors...</p>
                    </div>
                </div>
            </main>

            <div id="user-details-modal" class="modal-overlay">
                <div class="modal-content" style="max-width: 600px;">
                    <button class="modal-close-btn">&times;</button>
                    <h3 id="user-details-modal-title"
                        style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px;">
                        User Details</h3>
                    <div id="user-details-modal-body">
                        <p>Loading details...</p>
                    </div>
                    <div class="form-actions"
                        style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                        <button class="btn btn-secondary modal-close-btn">Close</button>
                    </div>
                </div>
            </div>

            <div id="learner-bookings-modal" class="modal-overlay">
                <div class="modal-content" style="max-width: 800px;"> <button class="modal-close-btn">&times;</button>
                    <h3 id="learner-bookings-modal-title"
                        style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px;">
                        Bookings for [Learner Name]
                    </h3>
                    <div id="learner-bookings-modal-body" style="max-height: 65vh; overflow-y: auto;">
                        <p>Loading bookings...</p>
                    </div>
                    <div class="form-actions"
                        style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                        <button class="btn btn-secondary modal-close-btn">Close</button>
                    </div>
                </div>
            </div>
            
            <div id="instructor-bookings-modal" class="modal-overlay">
                <div class="modal-content" style="max-width: 800px;">
                    <button class="modal-close-btn">&times;</button>
                    <h3 id="instructor-bookings-modal-title" style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px;">
                        Bookings for [Instructor Name]
                    </h3>
                    <div id="instructor-bookings-modal-body" style="max-height: 65vh; overflow-y: auto;">
                        <p>Loading bookings...</p>
                    </div>
                    <div class="form-actions" style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                        <button class="btn btn-secondary modal-close-btn">Close</button>
                    </div>
                </div>
            </div>
            ```

    <div id="verification-details-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close-btn">&times;</button>
            <h3 id="verification-modal-title"
                style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px;">
                Verification Details</h3>
            <div id="verification-modal-body">
            </div>
            <div class="form-actions"
                style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                <button class="btn btn-secondary modal-close-btn">Close</button>
                <button id="mark-verified-btn" class="btn btn-primary">Mark as Verified</button>
            </div>
        </div>
    </div>


    <div id="instructor-signup-page" class="page">
        <div class="login-page">
            <div class="login-art">
                <div class="logo-large">
                    <img src="https://placehold.co/150x150/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h2>SAFE LEARNERS</h2>
                    <p>DRIVE RIGHT</p>
                </div>
                <div class="road-footer">
                    <img src="291429995_48aa561c-0fb7-4de1-8956-55dac2201764 1.png" alt="Yellow Sports Car"
                        class="car-graphic">
                </div>
            </div>
            <div class="login-form-container">
                <form id="instructor-signup-form">
                    <h2>Instructor <span class="text-primary">Signup</span></h2>
                    <div class="form-row">
                        <div class="input-group">
                            <label for="instructor-signup-firstname">First Name</label>
                            <input type="text" id="instructor-signup-firstname" name="firstName" required>
                        </div>
                        <div class="input-group">
                            <label for="instructor-signup-surname">Surname</label>
                            <input type="text" id="instructor-signup-surname" name="surname" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="instructor-signup-email">Email Address</label>
                        <input type="email" id="instructor-signup-email" name="email" required>
                    </div>
                    <div class="input-group">
                        <label for="instructor-signup-password">Password</label>
                        <input type="password" id="instructor-signup-password" name="password" minlength="6" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Create Instructor Account</button>
                    <p id="instructor-signup-error-message" class="error-text"></p>
                    <p class="signup-link">Already Have An Account? <a href="#" class="go-to-login-link">Login Now</a>
                    </p>
                </form>
            </div>
        </div>
    </div>




    <div id="instructor-dashboard-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="EzLicence Logo">
                    <h3>Safe Learners</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li class="active"><a href="#" data-view="instructor-dashboard-view">Dashboard</a></li>
                        <li><a href="#" data-view="instructor-calendar-view">Calendar</a></li>
                        <li><a href="#" data-view="instructor-learners-view">Learners</a></li>
                        <li><a href="#" data-view="instructor-reports-view">Reports</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <a href="#" data-view="instructor-referral-view" class="rewards-card-link">
                        <div class="card ez-rewards-card">
                            <h5>EzRewards</h5>
                            <h3>Earn $500</h3>
                            <p>Refer instructors to EzLicence</p>
                        </div>
                    </a>
                    <ul>
                        <li><a href="#" id="instructor-nav-feedback">Give Feedback</a></li>
                        <li><a href="#" data-view="instructor-support-view">Support</a></li>

                        <li><a href="#" id="instructor-nav-contact">Contact</a></li>
                    </ul>
                    <button class="btn btn-secondary instructor-logout-btn">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <button class="mobile-menu-btn" id="instructor-hamburger-btn">&#9776;</button>

                    <h3>Dashboard</h3>
                    <div class="user-info">
                        <i id="notification-bell-icon" class="fas fa-bell"></i>
                        <div class="user-profile">
                            <img src="https://placehold.co/100x100?text=M" alt="User Avatar">
                            <span id="instructor-user-name">Mandeep</span> ▾
                            <div class="profile-dropdown">
                                <a href="#" data-view="instructor-account-settings-view"><i class="fas fa-user-cog"></i>
                                    Account Settings</a>
                                <a href="#" data-view="instructor-profile-edit-view"><i class="fas fa-id-card"></i> My
                                    Profile & Vehicle</a>
                                <a href="#" data-view="instructor-service-area-view"><i
                                        class="fas fa-map-marked-alt"></i> Service Area & Availability</a>
                                <a href="#" data-view="instructor-pricing-view"><i class="fas fa-dollar-sign"></i> Set
                                    Pricing</a>
                                <a href="#" data-view="instructor-verifications-view"><i
                                        class="fas fa-check-circle"></i> Verifications</a>
                                <a href="#" data-view="instructor-banking-view"><i class="fas fa-university"></i>
                                    Banking</a>
                                <a href="#" class="instructor-logout-btn"><i class="fas fa-sign-out-alt"></i> Log
                                    Out</a>
                                <a href="#" data-view="instructor-reviews-view"><i class="fas fa-star"></i> My
                                    Reviews</a>
                            </div>
                        </div>
                    </div>
                </header>



                <section id="instructor-dashboard-view" class="instructor-view active">
                    <div id="instructor-main-dashboard">
                        <div class="instructor-dashboard-header">
                            <h2>Bookings</h2>
                            <div class="instructor-actions">
                                <button class="btn btn-secondary invite-learner-btn">Invite Learner</button>
                                <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <div class="card stat-card">
                                <p>Earnings</p>
                                <h3>$309.37</h3>
                                <a href="#" id="trigger-payout-details">Your next payout: 23 Jun</a>
                            </div>
                            <div class="card stat-card">
                                <p>Cancellation Rate</p>
                                <h3>0.0%</h3>
                                <a href="#">Your cancels in the last 90 days</a>
                            </div>
                            <div class="card stat-card">
                                <p>Booking hours per learner</p>
                                <h3>3.05</h3>
                                <a href="#">Excludes new learners (within 90 days)</a>
                            </div>
                            <div class="card stat-card">
                                <p>Learner rating</p>
                                <h3>5.0</h3>
                                <a href="#" id="open-reviews-modal">Your reviews</a>
                            </div>
                        </div>

                        <div class="booking-section" style="margin-top: 40px;">
                            <div class="tabs">
                                <button class="tab-link active" data-target="upcoming-booking-content">Upcoming</button>
                                <button class="tab-link" data-target="pending-proposals-content">Pending
                                    proposals</button>
                                <button class="tab-link" data-target="booking-history-content">Booking history</button>
                            </div>

                            <div id="upcoming-booking-content" class="tab-pane active">
                            </div>

                            <div id="pending-proposals-content" class="tab-pane tab-content">
                                <p>No pending booking proposals. <a href="#">Create a new proposal.</a></p>
                            </div>

                            <div id="booking-history-content" class="tab-pane tab-content">
                            </div>
                        </div>
                    </div>
                    <div id="verification-prompt-card" class="card"
                        style="display: none; text-align: center; padding: 40px;">
                        <h2>Get Verified to Get Started</h2>
                        <p style="color: var(--gray-color); max-width: 450px; margin: 15px auto 25px;">
                            To access your dashboard, book lessons, and start earning, you need to complete our identity
                            verification process.
                        </p>
                        <button id="start-verification-btn" class="btn btn-primary" style="padding: 12px 40px;">Verify
                            Now</button>
                    </div>
                </section>
                <section id="instructor-reviews-view" class="instructor-view">
                    <div class="page-view-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;"><a href="#"
                                    data-view="instructor-dashboard-view">Dashboard</a> > My Reviews</p>
                            <h2>My Reviews</h2>
                        </div>
                    </div>

                    <div id="instructor-reviews-list" class="card" style="padding: 0;">
                        <p style="padding: 20px; text-align: center;">Loading reviews...</p>
                    </div>
                    <footer class="main-content-footer" style="margin-top: 40px;">
                        © Safe Learners Pty Ltd
                        <div>
                            <a href="#">Contact</a>
                            <a href="#">Support</a>
                            <a href="#">Code of Conduct</a>
                            <a href="#">Terms & Conditions</a>
                            <a href="#">Privacy Policy</a>
                        </div>
                    </footer>
                </section>

                <section id="instructor-learners-view" class="instructor-view">
                    <div class="instructor-dashboard-header">
                        <h2>Learners</h2>
                        <div class="instructor-actions">
                            <button class="btn btn-secondary invite-learner-btn">Invite Learner</button>
                            <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab-link active" data-target="my-learners-content">My Learners</button>
                        <button class="tab-link" data-target="pending-invites-content">Pending Invites</button>
                    </div>

                    <div id="my-learners-content" class="tab-pane active">
                        <div class="search-bar"
                            style="width: 100%; max-width: 400px; margin-top: 20px; margin-bottom: 20px;">
                            <input type="text" placeholder="Search by learner name or phone number"
                                style="border-radius: 8px; padding-left: 35px; height: 42px;">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="card learners-list">
                            <div class="learners-list-header">
                                <div>Learner Details</div>
                                <div>Guardian Details</div>
                                <div>Booking Hours Completed</div>
                                <div>Upcoming Bookings</div>
                                <div></div>
                            </div>
                            <div class="learners-list-row">
                                <div class="learner-cell-details">
                                    <h5>Angelina K.</h5>
                                    <span>0421 819 495</span>
                                </div>
                                <div>-</div>
                                <div>0</div>
                                <div>0</div>
                                <div class="learner-actions">
                                    <a href="#" class="view-learner-details-btn">Learner Details</a>
                                    <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                                </div>
                            </div>
                            <div class="learners-list-row">
                                <div class="learner-cell-details">
                                    <h5>Anum A.</h5>
                                    <span>0432 986 253</span>
                                </div>
                                <div>-</div>
                                <div>0</div>
                                <div>0</div>
                                <div class="learner-actions">
                                    <a href="#" class="view-learner-details-btn">Learner Details</a>
                                    <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                                </div>
                            </div>
                            <div class="learners-list-row">
                                <div class="learner-cell-details">
                                    <h5>Araf A.</h5>
                                    <span>0426 394 757</span>
                                </div>
                                <div>-</div>
                                <div>0</div>
                                <div>1</div>
                                <div class="learner-actions">
                                    <a href="#" class="view-learner-details-btn">Learner Details</a>
                                    <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                                </div>
                            </div>
                            <div class="learners-list-row">
                                <div class="learner-cell-details">
                                    <h5>Ashok B.</h5>
                                    <span>0452 081 244</span>
                                </div>
                                <div>-</div>
                                <div>0</div>
                                <div>0</div>
                                <div class="learner-actions">
                                    <a href="#" class="view-learner-details-btn">Learner Details</a>
                                    <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="pending-invites-content" class="tab-pane tab-content" style="display: none;">
                        <p>You have no pending invites.</p>
                    </div>
                </section>

                <section id="instructor-notifications-view" class="instructor-view">
                    <div class="page-view-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;"><a href="#"
                                    data-view="instructor-dashboard-view">Dashboard</a> > Notifications</p>
                            <h2>Notifications</h2>
                        </div>
                        <button class="btn btn-secondary btn-small">Mark all as read</button>
                    </div>

                    <div class="tabs">
                        <button class="tab-link active">Booking Notifications</button>
                        <button class="tab-link">Booking Proposals</button>
                    </div>

                    <div class="card notifications-list">
                        <div class="notification-item unread">
                            <div class="notification-icon"><i class="fas fa-calendar-check"></i></div>
                            <div class="notification-details">
                                <p><strong>New Safe Learners Booking</strong></p>
                                <p>Siddanth G. has made new booking(s).</p>
                                <span class="notification-time">Notification received at 16 Jun 2025, 1:48 PM</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="notification-item unread">
                            <div class="notification-icon"><i class="fas fa-calendar-check"></i></div>
                            <div class="notification-details">
                                <p><strong>New Safe Learners Booking</strong></p>
                                <p>Siddanth G. has made new booking(s).</p>
                                <span class="notification-time">Notification received at 16 Jun 2025, 1:47 PM</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="notification-item">
                            <div class="notification-icon"><i class="fas fa-calendar-check"></i></div>
                            <div class="notification-details">
                                <p><strong>New Safe Learners Booking</strong></p>
                                <p>Araf A. has made new booking(s).</p>
                                <span class="notification-time">Notification received at 15 Jun 2025, 7:19 PM</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </section>

                <section id="instructor-propose-booking-view" class="instructor-view">
                    <div class="page-view-header">
                        <div>
                            <p class="breadcrumbs" style="font-size: 14px; color: var(--gray-color);">Calendar > New
                                Booking Proposal</p>
                            <h2>New Booking Proposal</h2>
                        </div>
                        <div class="page-view-actions">
                            <button class="btn btn-secondary" data-view="instructor-calendar-view">Cancel
                                Proposal</button>
                            <button class="btn btn-primary btn-disabled" disabled>Propose Booking +</button>
                        </div>
                    </div>

                    <div class="card booking-proposal-card">
                        <div class="card-header" style="padding-bottom: 20px;">
                            <h4>Booking <span class="draft-tag">DRAFT</span></h4>
                        </div>

                        <form>
                            <div class="form-group">
                                <label for="proposal-learner">Learner *</label>
                                <div class="learner-select-group">
                                    <select id="proposal-learner">
                                        <option>Select a learner</option>
                                    </select>
                                    <button type="button" class="btn btn-secondary">+ Add new</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Booking Type</label>
                                <div class="booking-type-selector">
                                    <input type="radio" id="type-1hr" name="booking-type" value="1hr" checked>
                                    <label for="type-1hr">1-Hour Driving Lesson</label>

                                    <input type="radio" id="type-2hr" name="booking-type" value="2hr">
                                    <label for="type-2hr">2-Hour Driving Lesson</label>

                                    <input type="radio" id="type-test" name="booking-type" value="test">
                                    <label for="type-test">Driving Test Package</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Lesson start time *</label>
                                <div class="form-group-inline">
                                    <select>
                                        <option>Select a day</option>
                                    </select>
                                    <select>
                                        <option>Select a time</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Lesson pick up location</label>
                                <div class="location-field" style="background-color: #f7f7f7;">
                                    <span>Select a learner to begin</span>
                                    <button class="edit-btn" disabled><i class="fas fa-pencil-alt"></i> Edit</button>
                                </div>
                                <div class="form-group-inline" style="margin-top: 15px;">
                                    <input type="text" placeholder="Street no." disabled>
                                    <input type="text" placeholder="Street name" disabled>
                                </div>
                                <div class="form-group-inline" style="margin-top: 15px;">
                                    <input type="text" placeholder="Street" disabled>
                                    <select disabled>
                                        <option>Annangrove NSW 2156</option>
                                    </select>
                                </div>
                            </div>

                            <div class="booking-proposal-footer">
                                <div>
                                    <p class="form-note" style="margin: 0; max-width: 500px;">
                                        Booking proposals will 'hold' the selected time slot(s) until confirmed by the
                                        learner. Proposals remain valid for 24 hours OR the proposed booking start time
                                        (whichever arrives first).
                                    </p>
                                </div>
                                <div class="footer-actions">
                                    <button type="button" class="btn btn-secondary btn-disabled" disabled>+ Add Another
                                        Booking</button>
                                    <button type="submit" class="btn btn-primary btn-disabled" disabled>Propose
                                        Booking</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>
                <section id="instructor-learner-details-view" class="instructor-view">
                    <a href="#" class="back-link instructor-back-to-learners-btn"><i class="fas fa-chevron-left"></i>
                        Back to Learners</a>

                    <div class="learner-details-grid">
                        <div class="learner-details-left-col">
                            <div class="card learner-profile-card">
                                <div class="learner-avatar">AK</div>
                                <div class="learner-info">
                                    <h3>Angelina K. <span class="age-tag">Age 21</span></h3>
                                    <span class="learner-tag">Learner</span>
                                    <p><i class="fas fa-phone-alt"></i> 0421819495</p>
                                </div>
                                <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                            </div>

                            <div class="card learner-notes-card">
                                <div class="card-header">
                                    <h4>Your Notes</h4>
                                    <button class="btn btn-secondary btn-small">Write a Note</button>
                                </div>
                                <div class="learner-notes-card-body">
                                    <p>Write your first note about Angelina K.<br>(These notes are only visible by you.)
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="learner-details-right-col">
                            <div class="card">
                                <h4>Upcoming Bookings</h4>
                                <div class="empty-state">
                                    <p>No upcoming bookings</p>
                                </div>
                            </div>

                            <div class="card" style="padding: 0;">
                                <h4 style="padding: 20px 20px 0;">Booking History</h4>
                                <div class="learner-history-table">
                                    <div class="learner-history-header">
                                        <div>Booking</div>
                                        <div>Date</div>
                                        <div>Time</div>
                                        <div>Location</div>
                                        <div>Status</div>
                                        <div>Payment</div>
                                    </div>
                                    <div class="learner-history-row">
                                        <div><a href="#" class="booking-id-link">#7806613</a></div>
                                        <div>Sun, 05 Jan 2025</div>
                                        <div>10:00 am - 11:00 am</div>
                                        <div>223 Targo Road, Girraween 2145 NSW</div>
                                        <div><span class="status-badge status-completed">COMPLETED</span></div>
                                        <div><span class="status-badge status-processed">PROCESSED</span></div>
                                    </div>
                                    <div class="learner-history-row">
                                        <div><a href="#" class="booking-id-link">#7795012</a></div>
                                        <div>Sun, 22 Dec 2024</div>
                                        <div>10:00 am - 11:00 am</div>
                                        <div>223 Targo Rd, Girraween 2145 NSW</div>
                                        <div><span class="status-badge status-completed">COMPLETED</span></div>
                                        <div><span class="status-badge status-processed">PROCESSED</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="instructor-referral-view" class="instructor-view">
                    <a href="#" class="back-link" data-view="instructor-dashboard-view"><i
                            class="fas fa-chevron-left"></i> Back to Dashboard</a>

                    <div class="card referral-header-card">
                        <h2>Instructor Referral Program</h2>
                        <p>Earn $500 for each driving instructor you refer*</p>
                        <a href="#" class="how-it-works-link">How does it work?</a>
                        <div class="referral-steps">
                            <div class="referral-step">
                                <span>Step 1</span>
                                <p>Refer a fully accredited driving instructor to Safe Learners.</p>
                            </div>
                            <div class="referral-step">
                                <span>Step 2</span>
                                <p>Referred instructor is onboarded by Safe Learners.</p>
                            </div>
                            <div class="referral-step">
                                <span>Step 3</span>
                                <p>Referred instructor completes 25 driving lesson bookings.</p>
                            </div>
                            <div class="referral-step">
                                <span>Step 4</span>
                                <p>Safe Learners pays $500 into your nominated bank account.</p>
                            </div>
                        </div>
                        <div class="referral-terms">
                            <h4>Terms & Conditions</h4>
                            <ul>
                                <li>A referral fee will not be payable for Referred Instructors if:</li>
                                <li>The Referred Instructor was already referred to Safe Learners by another party or
                                    has already had contact with Safe Learners;</li>
                                <li>the Referred Instructor has already agreed to join Safe Learners;</li>
                                <li>EzLicence declines to proceed the Referred Instructor for any reason; and/or</li>
                                <li>the Referred Instructor does not complete 25 bookings within 60 days of going live
                                    on the platform.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card referral-form-card">
                        <h2>Refer To Safe Learners</h2>
                        <form id="referral-form">
                            <div class="form-grid">
                                <div class="input-group">
                                    <label for="ref-your-name">Your name</label>
                                    <input type="text" id="ref-your-name" value="SINGH, Mandeep" disabled>
                                </div>
                                <div class="input-group">
                                    <label>Do you have the contact details of the referred instructor?</label>
                                    <div class="radio-group">
                                        <input type="radio" id="contact-yes" name="has-contact" value="yes" checked>
                                        <label for="contact-yes">Yes</label>
                                        <input type="radio" id="contact-no" name="has-contact" value="no">
                                        <label for="contact-no">No</label>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label for="ref-instructor-name">Name of instructor you are referring</label>
                                    <input type="text" id="ref-instructor-name" required>
                                </div>
                                <div class="input-group">
                                    <label for="ref-tel">Telephone number</label>
                                    <input type="tel" id="ref-tel" placeholder="0400 000 000">
                                </div>
                                <div class="input-group">
                                    <label for="ref-city">City and service region</label>
                                    <input type="text" id="ref-city" placeholder="e.g. Sydney, Eastern Suburbs">
                                </div>
                                <div class="input-group">
                                    <label for="ref-email">Email address</label>
                                    <input type="email" id="ref-email" placeholder="">
                                </div>
                                <div class="input-group">
                                    <label for="ref-transmission">Vehicle transmission</label>
                                    <select id="ref-transmission" required>
                                        <option value="" disabled selected>Please select</option>
                                        <option value="auto">Automatic</option>
                                        <option value="manual">Manual</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-actions" style="text-align: left; margin-top: 20px;">
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                    <p class="form-footer-note">If you would like to speak to someone about the referral program please
                        <a href="#">contact us</a>.
                    </p>
                </section>

                <section id="instructor-support-view" class="instructor-view">
                    <div class="support-index-container" style="max-width: none; padding: 0;">
                        <header class="support-index-header">
                            <div class="breadcrumbs">
                                <a href="#">EzLicence Support</a> &nbsp; > &nbsp; Driving Instructors
                            </div>
                            <div class="search-bar">
                                <input type="text" placeholder="Search">
                                <i class="fas fa-search"></i>
                            </div>
                        </header>

                        <main>
                            <div class="support-index-title">
                                <h1>Driving Instructors</h1>
                                <p>Information & support for driving instructors</p>
                            </div>

                            <div class="support-category-grid">
                                <div class="support-category-column">
                                    <h3>Getting Started With EzLicence</h3>
                                    <ul>
                                        <li><a href="#" data-view="instructor-support-article-view">How EzLicence
                                                works</a></li>

                                        <li><a href="#" data-view="instructor-support-criteria-view">Business
                                                Criteria</a></li>

                                        <li><a href="#">Getting started</a></li>
                                        <li><a href="#">How to use our support centre</a></li>
                                        <li><a href="#">See all 9 articles</a></li>
                                    </ul>
                                </div>

                                <div class="support-category-column">
                                    <h3>Manage Your Account</h3>
                                    <ul>
                                        <li><a href="#">How to navigate your instructor account</a></li>
                                        <li><a href="#">How to log in to your instructor account</a></li>
                                        <li><a href="#">How to complete a 2-step verification</a></li>
                                        <li><a href="#">See all 12 articles</a></li>
                                    </ul>
                                </div>
                            </div>
                        </main>
                    </div>
                    <div class="floating-help-btn">? Help</div>
                </section>

                <section id="instructor-support-article-view" class="instructor-view">
                    <div class="support-article-container" style="max-width: none; padding: 0;">
                        <header class="support-index-header">
                            <div class="breadcrumbs">
                                <a href="#" data-view="instructor-support-view">EzLicence Support</a> &nbsp; > &nbsp;
                                <a href="#" data-view="instructor-support-view">Driving Instructors</a> &nbsp; > &nbsp;
                                Getting Started With EzLicence
                            </div>
                            <div class="search-bar">
                                <input type="text" placeholder="Search">
                                <i class="fas fa-search"></i>
                            </div>
                        </header>

                        <div class="support-article-grid">
                            <aside class="support-article-sidebar">
                                <h3>Articles in this section</h3>
                                <ul>
                                    <li><a href="#" class="active">How EzLicence works</a></li>
                                    <li><a href="#" data-view="instructor-support-criteria-view">Business Criteria</a>
                                    </li>
                                    <li><a href="#">Getting started</a></li>
                                    <li><a href="#">How to use our support centre</a></li>
                                </ul>
                            </aside>

                            <article class="support-article-content">
                                <h1>How EzLicence works</h1>
                                <p class="meta">1 year ago - Updated</p>

                                <h3>This will be useful if:</h3>
                                <p>You are a <strong>Driving Instructor User</strong> of the EzLicence booking platform.
                                </p>

                                <h3>You are trying to:</h3>
                                <p>Understand how EzLicence works</p>

                                <h3>Overview:</h3>
                                <p>EzLicence is the preferred platform of over 950 independent instructors, and we know
                                    that EzLicence will benefit your business too! What makes EzLicence so great?</p>

                                <ol style="padding-left: 20px; color: var(--gray-color); line-height: 1.8;">
                                    <li><strong>Reach more learner drivers</strong> - we provide a platform for driving
                                        instructors to showcase their services to a wider audience. EzLicence can
                                        increase your visibility and attract potential clients to your business.</li>
                                    <li><strong>Convenient scheduling</strong> - we offer a user-friendly, real-time
                                        scheduling system, allowing instructors to manage their availability and
                                        schedule lessons with ease, benefiting both instructors and learners.</li>
                                    <li><strong>Expert marketing support</strong> - we assist driving instructors with
                                        marketing by featuring their profiles on the platform, making it easier for
                                        learners to find and connect with them.</li>
                                </ol>
                            </article>
                        </div>
                    </div>
                    <div class="floating-help-btn">? Help</div>
                </section>

                <section id="instructor-support-criteria-view" class="instructor-view">
                    <div class="support-article-container" style="max-width: none; padding: 0;">
                        <header class="support-index-header">
                            <div class="breadcrumbs">
                                <a href="#" data-view="instructor-support-view">EzLicence Support</a> &nbsp; > &nbsp;
                                <a href="#" data-view="instructor-support-view">Driving Instructors</a> &nbsp; > &nbsp;
                                Getting Started With EzLicence
                            </div>
                            <div class="search-bar">
                                <input type="text" placeholder="Search">
                                <i class="fas fa-search"></i>
                            </div>
                        </header>

                        <div class="support-article-grid">
                            <aside class="support-article-sidebar">
                                <h3>Articles in this section</h3>
                                <ul>
                                    <li><a href="#" data-view="instructor-support-article-view">How EzLicence works</a>
                                    </li>
                                    <li><a href="#" class="active">Business Criteria</a></li>
                                    <li><a href="#">Getting started</a></li>
                                    <li><a href="#">How to use our support centre</a></li>
                                    <li><a href="#">Private Learner Fact Sheet</a></li>
                                    <li><a href="#">Payout Processing Fees Fact Sheet</a></li>
                                    <li><a href="#">EzLicence Driving Instructor Policies</a></li>
                                    <li><a href="#">Driving Instructor Cancellation Policy</a></li>
                                    <li><a href="#">Driving Instructor Code of Conduct</a></li>
                                </ul>
                            </aside>

                            <article class="support-article-content">
                                <h1>Business Criteria</h1>
                                <p class="meta">1 year ago - Updated</p>

                                <h3>This will be useful if:</h3>
                                <p>You are a <strong>Driving Instructor User</strong> of the EzLicence booking platform.
                                </p>

                                <h3>You are trying to:</h3>
                                <p>You are wanting to understand the requirements to join.</p>

                                <h3>Overview:</h3>
                                <p>We can't wait to work with you! To speed up the onboarding process, make sure you
                                    have the following items readily available:</p>

                                <h3>Accreditations</h3>
                                <ul style="padding-left: 20px; color: var(--dark-color); line-height: 1.8;">
                                    <li>Australian Driver's Licence</li>
                                    <li>Driving Instructor's Licence</li>
                                    <li>Working with Children Check or state equivalent</li>
                                </ul>

                                <h3>Vehicle</h3>
                                <ul style="padding-left: 20px; color: var(--dark-color); line-height: 1.8;">
                                    <li>Vehicle Registration</li>
                                    <li>Vehicle Insurance (Comprehensive or Third Party Property)</li>
                                    <li>5-star ANCAP safety rating</li>
                                </ul>
                            </article>
                        </div>
                    </div>
                    <div class="floating-help-btn">? Help</div>
                </section>

                <!-- START: INSTRUCTOR CALENDAR VIEW -->
                <section id="instructor-calendar-view" class="instructor-view">
                    <div class="calendar-header">
                        <div class="calendar-title">
                            <h2>Calendar</h2>
                            <div class="breadcrumbs" style="margin:0;">
                                <span>Calendar</span> > <span>June 2025</span>
                            </div>
                        </div>
                        <div class="calendar-actions">
                            <button class="btn btn-secondary" data-view="instructor-pricing-view">Set Pricing</button>
                            <div style="position: relative;"> <button id="create-event-btn"
                                    class="btn btn-primary">Create Event</button>
                                <div id="create-event-dropdown" class="create-event-dropdown">
                                    <a href="#" data-view="instructor-propose-booking-view"><i
                                            class="fas fa-calendar-alt"></i> Booking Proposal</a>
                                    <a href="#"><i class="fas fa-calendar-plus"></i> Other Event</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card calendar-options-card">
                        <div class="smart-scheduling-toggle">
                            <span>Smart Scheduling</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="lesson-duration-options">
                            <label><input type="checkbox" checked> 1hr</label>
                            <label><input type="checkbox" checked> 2hr</label>
                        </div>
                    </div>

                    <div class="card calendar-container">
                        <div class="calendar-controls">
                            <div class="calendar-nav">
                                <button id="cal-today-btn" class="btn btn-secondary btn-small"
                                    onclick="goToToday()">Today</button>
                                <button id="cal-prev-week-btn" class="btn btn-secondary btn-small"
                                    onclick="goToPrevWeek()"><i class="fas fa-chevron-left"></i></button>
                                <button id="cal-next-week-btn" class="btn btn-secondary btn-small"
                                    onclick="goToNextWeek()"><i class="fas fa-chevron-right"></i></button>
                                <span id="cal-month-display" class="month-display">June 2025</span>
                            </div>
                            <div class="view-switcher">
                                <button class="btn btn-secondary btn-small">Day</button>
                                <button class="btn btn-secondary btn-small active">Week</button>
                                <button class="btn btn-secondary btn-small">Month</button>
                            </div>
                        </div>

                        <div class="calendar-grid-container">
                            <div id="dynamic-calendar-grid" class="calendar-grid">
                            </div>
                        </div>
                    </div>
                    <footer class="main-content-footer">
                        © Safe Learners Pty Ltd
                        <div>
                            <a href="#">Contact</a>
                            <a href="#">Support</a>
                            <a href="#">Code of Conduct</a>
                            <a href="#">Terms & Conditions</a>
                            <a href="#">Privacy Policy</a>
                        </div>
                    </footer>
                </section>

                <section id="instructor-pricing-view" class="instructor-view">
                    <div class="pricing-header">
                        <h2>Pricing</h2>
                        <p><strong>Safe Learners Learners:</strong> from Safe Learners marketplace.<br>
                            <strong>Private Learners:</strong> invited to Safe Learners by you.
                        </p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Lesson</h4>
                            <p class="subtitle">Price per booking hour</p>
                        </div>
                        <div class="pricing-item">
                            <div class="pricing-label">
                                <span class="dot yellow"></span> Safe Learners
                            </div>
                            <div class="pricing-value">
                                <span>$75.00</span>
                                <button class="btn btn-secondary btn-small"><i class="fas fa-pencil-alt"></i>
                                    Edit</button>
                            </div>
                        </div>
                        <div class="pricing-item">
                            <div class="pricing-label">
                                <span class="dot blue"></span> Private
                            </div>
                            <div class="pricing-value">
                                <span>$75.00</span>
                                <button class="btn btn-secondary btn-small"><i class="fas fa-pencil-alt"></i>
                                    Edit</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Test Package</h4>
                            <p class="subtitle">Pick up 1hr before, 45-minute pre-test warm-up, and drop-off after
                                result</p>
                        </div>
                        <div class="pricing-item">
                            <div class="pricing-label">
                                <span class="dot yellow"></span> Safe Learners
                            </div>
                            <div class="pricing-value">
                                <span>$225.00</span>
                                <button class="btn btn-secondary btn-small"><i class="fas fa-pencil-alt"></i>
                                    Edit</button>
                            </div>
                        </div>
                        <div class="pricing-item">
                            <div class="pricing-label">
                                <span class="dot blue"></span> Private
                            </div>
                            <div class="pricing-value">
                                <span>$225.00</span>
                                <button class="btn btn-secondary btn-small"><i class="fas fa-pencil-alt"></i>
                                    Edit</button>
                            </div>
                        </div>
                    </div>

                    <div id="price-update-success-msg" class="success-message" style="display: none;">
                        <span><i class="fas fa-check-circle"></i> Pricing Updated</span>
                        <p>New pricing will apply to bookings made from tomorrow.</p>
                        <button class="close-btn">&times;</button>
                    </div>
                </section>

                <section id="instructor-edit-price-view" class="instructor-view">
                    <div class="edit-price-header">
                        <a href="#" class="back-link" data-view="instructor-pricing-view"><i
                                class="fas fa-chevron-left"></i> Pricing</a>
                        <h2>Lesson Pricing (Auto)</h2>
                    </div>
                    <div class="edit-price-container">
                        <div class="edit-price-main">
                            <div class="card">
                                <div class="pricing-label">
                                    <span class="dot yellow"></span> Safe Learners
                                </div>
                                <div class="input-group" style="margin-top: 20px;">
                                    <label for="hourly-lesson-price">Hourly Lesson Price</label>
                                    <input type="text" id="hourly-lesson-price" value="75">
                                </div>
                                <p class="price-info">Learners pay $67.50 - $75.00/hr<br>You'll earn $50.63 - $56.25/hr
                                </p>
                                <p class="price-note">Amount varies due to bulk purchase discounts (for a maximum of
                                    10%). Discount costs are shared between Safe Learners and Instructor. Learners are
                                    more likely to buy in bulk when you with discounts apply.</p>
                            </div>
                            <p class="pricing-footer-note">Pricing changes apply to all bookings (new and existing
                                Learners) made from (tomorrow 19 Jun 2025, 12:00 AM)</p>
                        </div>
                        <aside class="edit-price-sidebar">
                            <div class="card">
                                <h4>Market Rates</h4>
                                <p>Avg. hourly price near you: <strong>$76.00/hr</strong></p>
                                <img src="https://i.imgur.com/8z2n2gR.png" alt="Market Rates Graph"
                                    style="width: 100%; margin-top: 15px;">
                            </div>
                            <button id="save-price-changes-btn" class="btn btn-primary btn-full">Save Changes</button>
                        </aside>
                    </div>

                </section>
                <section id="instructor-booking-details-view" class="instructor-view">
                    <div class="booking-details-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;"><a href="#" class="back-link"
                                    data-view="instructor-calendar-view">Calendar</a> > <a href="#" class="back-link"
                                    data-view="instructor-dashboard-view">Upcoming Bookings</a> > Booking #8160596</p>
                            <h2>Booking #8160596</h2>
                        </div>
                        <div class="modify-booking-wrapper">
                            <button id="modify-booking-btn" class="btn btn-secondary">Modify Booking</button>
                            <div id="modify-booking-dropdown" class="modify-booking-dropdown">
                                <a href="#" id="reschedule-booking-link"><i class="fas fa-calendar-alt"></i> Reschedule
                                    booking</a>
                                <a href="#" id="cancel-booking-link"><i class="fas fa-times-circle"></i> Cancel without
                                    new booking</a>
                            </div>
                        </div>
                    </div>

                    <div class="booking-confirmation-banner">
                        <i class="fas fa-check-circle"></i>
                        <span>This booking has been confirmed by Ryan.</span>
                    </div>

                    <div class="card booking-details-card">
                        <div class="booking-main-details">
                            <h4>Booking #8160596 <span class="status-badge status-confirmed">CONFIRMED</span></h4>
                            <div class="booking-info-grid">
                                <div class="booking-info-item"><i class="fas fa-calendar-alt"></i> Sat, 21 Jun 2025
                                </div>
                                <div class="booking-info-item"><i class="fas fa-clock"></i> 11:45 am - 1:45 pm</div>
                                <div class="booking-info-item"><i class="fas fa-car"></i> 2 Hour Driving Lesson (Auto)
                                </div>
                                <div class="booking-info-item"><i class="fas fa-map-marker-alt"></i> Dirrabarri Lane,
                                    Parramatta NSW, Parramatta 2150 NSW</div>
                            </div>
                        </div>
                        <div class="booking-learner-details">
                            <img src="https://placehold.co/100x100?text=R" alt="Learner Avatar">
                            <div>
                                <p>Learner details</p>
                                <strong>Ryan B.</strong>
                                <a href="tel:0478922109">0478922109</a>
                            </div>
                        </div>
                    </div>
                    <div class="card" id="payment-details-card">

                        <div class="payment-details-header">
                            <h4>Payment <span class="status-badge status-pending">PENDING</span></h4>
                            <button class="btn btn-secondary btn-small btn-disabled" disabled>Reverse Payment</button>
                        </div>
                        <div class="payment-details-body">
                            <p>Booking Made On<br>8 Jun 2025, 2:04 PM</p>
                            <div class="payment-amount">
                                <h2>$112.50</h2>
                                <p class="text-primary" style="font-weight: 500;">Your Net Payment</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="notes-header">
                            <h4>Your Notes <i class="fas fa-info-circle"></i></h4>
                            <button id="add-note-btn" class="btn btn-secondary btn-small">+ Add a Note</button>
                        </div>
                        <div id="notes-placeholder" class="notes-body">
                            <p>Write your first note about Ryan B.<br><small>(These notes are only visible by
                                    you.)</small></p>
                        </div>
                        <div id="add-note-form-container" class="add-note-form" style="display: none;">
                            <form id="add-note-form">
                                <div class="note-input-group date-input-group">
                                    <input type="text" id="note-date" readonly>
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="note-input-group">
                                    <textarea id="note-text" placeholder="Start typing to leave a note..."></textarea>
                                </div>
                                <div class="note-actions">
                                    <button type="button" id="cancel-note-btn" class="btn btn-secondary">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Note</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card" style="padding: 0;">
                        <h4 style="padding: 20px;">Booking Update History</h4>
                        <div class="history-table">
                            <div class="history-table-header wide-grid">
                                <div>Event</div>
                                <div>Updated</div>
                                <div>Status</div>
                            </div>
                            <div class="history-table-row wide-grid">
                                <div><i class="fas fa-user" style="margin-right: 10px;"></i> <strong>Ryan B.</strong>
                                    confirmed this booking</div>
                                <div>10 days ago</div>
                                <div><span class="status-badge status-confirmed">CONFIRMED</span></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="instructor-reschedule-booking-view" class="instructor-view">
                    <div class="page-view-header">
                        <div>
                            <p id="reschedule-breadcrumbs" class="breadcrumbs" style="margin:0;">Upcoming Bookings >
                                Booking #... > Modify Booking</p>
                            <h2>Reschedule Booking</h2>
                        </div>
                        <div class="page-view-actions">
                            <button id="discard-reschedule-btn" class="btn btn-secondary">Discard Changes</button>
                            <button class="btn btn-primary btn-disabled" disabled>Propose Booking +</button>
                        </div>
                    </div>

                    <div id="reschedule-warning-box" class="warning-box danger"
                        style="margin-top: 20px; display: flex; align-items: flex-start; gap: 10px;">
                        <i class="fas fa-exclamation-triangle" style="margin-top: 3px;"></i>
                        <div>
                            <strong>This action will CANCEL the current booking and propose a NEW booking.</strong>
                            <p style="margin: 5px 0 0 0; color: inherit;">A learner will be notified that the current
                                booking is cancelled and can either accept or decline the new booking proposal.</p>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <div class="booking-details-title" style="border-bottom: none; padding-bottom: 0;">
                            <h4 id="reschedule-current-booking-id">Booking #8160596 <span
                                    class="status-badge status-confirmed">CONFIRMED</span></h4>
                        </div>
                        <div class="booking-details-grid" style="margin-top: 15px;">
                            <div id="reschedule-current-date" class="booking-details-info">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Sat, 21 Jun 2025</span>
                            </div>
                            <div id="reschedule-current-time" class="booking-details-info">
                                <i class="fas fa-clock"></i>
                                <span>11:45 am - 1:45 pm</span>
                            </div>
                            <div id="reschedule-current-type" class="booking-details-info">
                                <i class="fas fa-car"></i>
                                <span>2 Hour Driving Lesson (Auto)</span>
                            </div>
                            <div id="reschedule-current-location" class="booking-details-info">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Dirrabarri Lane, Parramatta NSW, Parramatta 2150 NSW</span>
                            </div>
                            <div id="reschedule-current-learner" class="booking-details-info learner-info">
                                <img src="https://placehold.co/100x100?text=R" alt="Learner">
                                <div>
                                    <strong>Learner details</strong>
                                    <p>Ryan B.<br>0478922109</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card booking-proposal-card" style="margin-top: 20px;">
                        <div class="card-header" style="padding-bottom: 20px;">
                            <h4>Booking <span class="new-tag">NEW</span></h4>
                        </div>
                        <form>
                            <div class="form-group">
                                <label for="reschedule-learner">Learner *</label>
                                <div class="input-group">
                                    <select id="reschedule-learner" disabled>
                                        <option>Ryan B. - 0478922109</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Booking Type</label>
                                <div class="booking-type-selector">
                                    <input type="radio" id="reschedule-type-1hr" name="reschedule-booking-type"
                                        value="1hr">
                                    <label for="reschedule-type-1hr">1-Hour Driving Lesson</label>

                                    <input type="radio" id="reschedule-type-2hr" name="reschedule-booking-type"
                                        value="2hr" checked>
                                    <label for="reschedule-type-2hr">2-Hour Driving Lesson</label>

                                    <input type="radio" id="reschedule-type-test" name="reschedule-booking-type"
                                        value="test">
                                    <label for="reschedule-type-test">Driving Test Package</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Lesson start time *</label>
                                <div class="form-group-inline">
                                    <select>
                                        <option>Select a day</option>
                                    </select>
                                    <select>
                                        <option>Select a time</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Lesson pick up location</label>
                                <div class="location-field">
                                    <span id="reschedule-new-location">330 Church St, Parramatta NSW 2150</span>
                                    <button class="edit-btn"><i class="fas fa-pencil-alt"></i> Edit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>

                <section id="instructor-reports-view" class="instructor-view">
                    <div class="reports-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;">Reports > Summary</p>
                            <h2>Summary</h2>
                        </div>
                        <div class="tabs">
                            <button class="tab-link active">Summary</button>
                            <button class="tab-link">This Financial Year</button>

                            <button class="tab-link">FY 2023/24</button>
                        </div>
                    </div>

                    <div class="stats-grid summary-content">

                        <div class="card stat-card">
                            <p>Earnings</p>
                            <h3>$309.37</h3>
                            <a href="#" id="trigger-payout-details">Your next payout: 23 Jun</a>
                        </div>
                        <div class="card stat-card">
                            <p>Cancellation Rate</p>
                            <h3>0.0%</h3>
                            <a href="#">Your cancels in the last 90 days</a>
                        </div>
                        <div class="card stat-card">
                            <p>Booking hours per learner</p>
                            <h3>3.05</h3>
                            <a href="#">Excludes new learners (within 90 days)</a>
                        </div>
                        <div class="card stat-card">
                            <p>Learner rating</p>
                            <h3>5.0</h3>
                            <a href="#">Your reviews</a>
                        </div>
                    </div>

                    <div class="card summary-content">

                        <div class="card-header">
                            <h4>Earnings report</h4>
                            <p class="subtitle" style="margin-bottom:0;">Your payouts by month (last 12 months)</p>
                        </div>
                        <img src="https://i.imgur.com/uF20k8i.png" alt="Earnings Report Graph" style="width: 100%;">
                    </div>

                    <div class="stats-grid summary-content" style="grid-template-columns: repeat(4, 1fr);">

                        <div class="card stat-card">
                            <p>Next Payout (23 Jun 2025)</p>
                            <h3>$309.37</h3>
                        </div>
                        <div class="card stat-card">
                            <p>Previous Payout (9 Jun 2025)</p>
                            <h3>$696.98</h3>
                        </div>
                        <div class="card stat-card">
                            <p>FYTD Payout (YTD: 25)</p>
                            <h3>$9,731.24</h3>
                        </div>
                        <div class="card stat-card">
                            <p>All Time Earnings</p>
                            <h3>$11,255.97</h3>
                        </div>
                        <div class="card stat-card">
                            <p>Ave Weekly Earnings (last 90 days)</p>
                            <h3>$535.40</h3>
                        </div>
                        <div class="card stat-card">
                            <p>Ave Earnings Per Hour (last 90 days)</p>
                            <h3>$53.54</h3>
                        </div>
                        <div class="card stat-card">
                            <p>Upcoming Bookings</p>
                            <h3>$385.31</h3>
                        </div>
                        <div class="card stat-card">
                            <p>Credits Held By Your Learners</p>
                            <h3>$855.45</h3>
                        </div>
                    </div>

                    <div class="card summary-content">

                        <div class="card-header">
                            <h4>Booking Activity</h4>
                        </div>
                        <div class="stats-grid"
                            style="grid-template-columns: repeat(2, 1fr); text-align: center; margin-top:0;">
                            <div class="stat-card" style="padding: 10px;">
                                <h3>51,714</h3>
                                <p>Searches in your area</p>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <h3>1</h3>
                                <p>Test packages</p>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <h3>219</h3>
                                <p>Total booking hrs</p>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <h3>78</h3>
                                <p>Learners</p>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <h3>7</h3>
                                <p>Upcoming hrs booked</p>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <h3>216</h3>
                                <p>Lesson hrs completed</p>
                            </div>
                        </div>
                    </div>

                    <div id="financial-year-content" class="tab-pane" style="position: relative; display: none;">





                        <div class="card transaction-summary-card">
                            <div class="summary-header">
                                <div>
                                    <h4>TRANSACTION SUMMARY (YTD)</h4>
                                    <p>2024/25: 1 Jul 2024 - 30 Jun 2025</p>
                                </div>
                                <div>
                                    <p>PAYOUT</p>
                                    <strong>$9,982.41</strong>
                                </div>
                                <a href="#">Transaction Summary</a>
                            </div>
                            <div class="fortnightly-reports-table">
                                <div class="reports-table-header">
                                    <span>FORTNIGHTLY REPORTS</span>
                                    <span>PAYOUT</span>
                                    <span></span>
                                </div>
                                <div class="reports-table-row">
                                    <span>#5107463 &nbsp; &nbsp; 1 Jul 2024</span>
                                    <span>$251.17</span>
                                    <div class="report-links">
                                        <a href="#">Tax Invoice</a>
                                        <a href="#">Transaction Report</a>
                                    </div>
                                </div>
                                <div class="reports-table-row">
                                    <span>#5114290 &nbsp; &nbsp; 22 Jul 2024</span>
                                    <span>$1,756.48</span>
                                    <div class="report-links">
                                        <a href="#">Tax Invoice</a>
                                        <a href="#">Transaction Report</a>
                                    </div>
                                </div>
                                <div class="reports-table-row">
                                    <span>#5232758 &nbsp; &nbsp; 9 Jun 2025</span>
                                    <span>$696.98</span>
                                    <div class="report-links">
                                        <a href="#">Tax Invoice</a>
                                        <a href="#">Transaction Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div id="fy-23-24-content" class="tab-pane" style="display: none;">
                        <div class="card transaction-summary-card">
                            <div class="summary-header">
                                <div>
                                    <h4>TRANSACTION SUMMARY (YTD)</h4>
                                    <p>2023/24: 1 Jul 2023 - 30 Jun 2024</p>
                                </div>
                                <div>
                                    <p>PAYOUT</p>
                                    <strong>$1,273.56</strong>
                                </div>
                                <a href="#">Transaction Summary</a>
                            </div>
                            <div class="fortnightly-reports-table">
                                <div class="reports-table-header">
                                    <span>FORTNIGHTLY REPORTS</span>
                                    <span>PAYOUT</span>
                                    <span></span>
                                </div>
                                <div class="reports-table-row">
                                    <span>#5097346 &nbsp; &nbsp; 27 May 2024</span>
                                    <span>$276.43</span>
                                    <div class="report-links">
                                        <a href="#">Tax Invoice</a>
                                        <a href="#">Transaction Report</a>
                                    </div>
                                </div>
                                <div class="reports-table-row">
                                    <span>#5102348 &nbsp; &nbsp; 10 Jun 2024</span>
                                    <span>$291.42</span>
                                    <div class="report-links">
                                        <a href="#">Tax Invoice</a>
                                        <a href="#">Transaction Report</a>
                                    </div>
                                </div>
                                <div class="reports-table-row">
                                    <span>#5104853 &nbsp; &nbsp; 24 Jun 2024</span>
                                    <span>$705.71</span>
                                    <div class="report-links">
                                        <a href="#">Tax Invoice</a>
                                        <a href="#">Transaction Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>



                <section id="instructor-payout-details-view" class="instructor-view">
                    <div class="reports-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;"><a href="#"
                                    data-view="instructor-reports-view">Reports</a> > This financial year</p>
                            <h2>This financial year</h2>
                        </div>
                        <div class="tabs">
                            <button class="tab-link" data-view="instructor-reports-view">Summary</button>
                            <button class="tab-link active">This Financial Year</button>
                            <button class="tab-link">FY 2023/24</button>
                        </div>
                    </div>

                    <div class="card pending-payout-card">
                        <a href="#" class="next-payout-item"
                            style="display: flex; justify-content: space-between; align-items: center; width: 100%; text-decoration: none;">
                            <span style="font-weight: 600;">Next Payout - 23 Jun 2025</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                    </div>

                    <div id="payout-details-content">
                        <div class="payout-details-header">
                            <div>Learner</div>
                            <div>Day / Time</div>
                            <div>Payout</div>
                            <div>Lesson ID</div>
                        </div>
                        <div class="payout-details-list">
                            <div class="payout-details-row">
                                <div><i class="fas fa-circle"
                                        style="color: #FFC700; font-size: 8px; margin-right: 8px;"></i>Jasper C.</div>
                                <div>15 Jun 2025, 11:30 AM</div>
                                <div>$101.25</div>
                                <div>#8129177</div>
                            </div>
                            <div class="payout-details-row">
                                <div><i class="fas fa-circle"
                                        style="color: #FFC700; font-size: 8px; margin-right: 8px;"></i>Jasper C.</div>
                                <div>14 Jun 2025, 4:45 PM</div>
                                <div>$101.25</div>
                                <div>#8129174</div>
                            </div>
                            <div class="payout-details-row">
                                <div><i class="fas fa-circle"
                                        style="color: #FFC700; font-size: 8px; margin-right: 8px;"></i>Siddanth G.</div>
                                <div>14 Jun 2025, 1:15 PM</div>
                                <div>$106.87</div>
                                <div>#8141653</div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="instructor-transaction-report-view" class="instructor-view">
                    <div class="page-view-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;"><a href="#"
                                    data-view="instructor-reports-view">Reports</a> > <a href="#"
                                    data-view="instructor-reports-view">Financial Year 2023/24</a> > Transaction Report
                                #5102348</p>
                            <h2>Report #5102348</h2>
                        </div>
                        <div class="page-view-actions">
                            <button id="download-pdf-btn" class="btn btn-primary"><i class="fas fa-download"></i>
                                Download PDF</button>
                        </div>
                    </div>

                    <div id="report-content" class="card transaction-report-card">
                        <div class="report-header">
                            <div class="logo">
                                <img src="https://placehold.co/100x40/FFC700/000000?text=SL" alt="Safe Learners Logo">
                                <span>Safe Learners</span>
                            </div>
                            <h2>Transaction Report</h2>
                            <p>Payout funds will be deposited to your bank account within 2-3 business days</p>
                        </div>

                        <div class="report-meta">
                            <div>
                                <strong>To</strong><br>
                                Mandeep Singh<br>
                                Mandeep Singh<br>
                                ABN 96108108611<br>
                                12 Yelta St, The Ponds<br>
                                The Ponds NSW 2769
                            </div>
                            <div>
                                <span>ID:</span> 5102348<br>
                                <span>Date:</span> 10 Jun 2024<br>
                                <span>Amount:</span> $291.42<br>
                                <span>Description:</span> EZL TRANSFER
                            </div>
                        </div>

                        <div class="report-table">
                            <div class="report-table-header">
                                <div>Date</div>
                                <div>Learner Name</div>
                                <div>Transaction</div>
                                <div class="text-right">Amount</div>
                                <div class="text-right">Net Payment</div>
                            </div>
                            <div class="report-table-row">
                                <div>28 May 2024</div>
                                <div>Ruby S.</div>
                                <div>Private Lesson (1 x $70.00)</div>
                                <div class="text-right">$70.00</div>
                                <div></div>
                            </div>
                            <div class="report-table-row sub-item">
                                <div></div>
                                <div></div>
                                <div>Invited Learner Admin Fee</div>
                                <div class="text-right">-$1.23</div>
                                <div></div>
                            </div>
                            <div class="report-table-row net-row">
                                <div></div>
                                <div></div>
                                <div>Net Payment</div>
                                <div></div>
                                <div class="text-right">$68.77</div>
                            </div>
                            <div class="report-table-row">
                                <div>30 May 2024</div>
                                <div>Ram B.</div>
                                <div>Private Lesson (1 x $30.00)</div>
                                <div class="text-right">$30.00</div>
                                <div></div>
                            </div>
                            <div class="report-table-row sub-item">
                                <div></div>
                                <div></div>
                                <div>Booking Service Fee</div>
                                <div class="text-right">-$17.50</div>
                                <div></div>
                            </div>
                            <div class="report-table-row net-row">
                                <div></div>
                                <div></div>
                                <div>Net Payment</div>
                                <div></div>
                                <div class="text-right">$52.50</div>
                            </div>

                            <div class="report-table-footer">
                                <div>
                                    <p>Subtotal</p>
                                    <p>Booking Payments</p>
                                    <p>Booking Service Fees</p>
                                    <p>Private Learner Admin Fees</p>
                                    <p>Payout Processing Fee</p>
                                    <p>Monthly Account Fee</p>
                                    <p><strong>Net Payment</strong></p>
                                </div>
                                <div class="text-right">
                                    <p>&nbsp;</p>
                                    <p>$350.00</p>
                                    <p>-$52.50</p>
                                    <p>-$2.46</p>
                                    <p>-$1.42</p>
                                    <p>-$2.20</p>
                                    <p><strong>$291.42</strong></p>
                                </div>
                            </div>
                        </div>

                        <div class="report-footer">
                            <div>
                                <strong>Safe Learners Pty Ltd</strong><br>
                                ABN: 43 612 095 968<br>
                                C/- WOTSO ADELAIDE 217-219 Flinders Street, Adelaide SA 5000
                            </div>
                            <div class="text-right">
                                For questions regarding your payout,<br>
                                please visit our support centre at <a href="#">support.safelearners.com.au/ou</a><br>
                                <br>
                                Kind Regards,<br>
                                <strong>Safe Learners</strong>
                            </div>
                        </div>
                    </div>
                </section>
                </section>
                <section id="instructor-account-settings-view" class="instructor-view">
                    <div class="page-view-header">
                        <div>
                            <p class="breadcrumbs" style="margin:0;"><a href="#"
                                    data-view="instructor-dashboard-view">Dashboard</a> > Account Settings</p>
                            <h2>Account Settings</h2>
                        </div>
                    </div>
                    <div class="card" style="padding: 20px;">
                        <form id="account-settings-form">
                            <h4>Personal Details</h4>
                            <div class="form-row" style="margin-top: 20px;">
                                <div class="input-group">
                                    <label for="as-first-name"><i class="fas fa-user"></i> First Name</label>
                                    <input type="text" id="as-first-name" placeholder="Enter First Name">
                                </div>
                                <div class="input-group">
                                    <label for="as-surname"><i class="fas fa-user"></i> Surname</label>
                                    <input type="text" id="as-surname" placeholder="Enter Surname">
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="as-email"><i class="fas fa-envelope"></i> Email Address</label>
                                <input type="email" id="as-email" placeholder="Enter Email Address" disabled
                                    style="background-color: #f1f1f1; cursor: not-allowed;">
                            </div>
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="as-mobile"><i class="fas fa-mobile-alt"></i> Mobile Number</label>
                                    <input type="tel" id="as-mobile" placeholder="Enter Mobile Number">
                                </div>
                                <div class="input-group">
                                    <label for="as-dob"><i class="fas fa-calendar-alt"></i> Date of Birth</label>
                                    <input type="date" id="as-dob" placeholder="YYYY-MM-DD">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="as-gender"><i class="fas fa-venus-mars"></i> Gender</label>
                                    <select id="as-gender">
                                        <option value="" disabled selected>Select</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="as-pincode"><i class="fas fa-map-marker-alt"></i> Pin Code</label>
                                    <input type="number" id="as-pincode" placeholder="Enter Pin Code">
                                </div>
                            </div>

                            <hr style="margin: 30px 0; border-color: var(--border-color);">

                            <h4>Change Password</h4>
                            <p class="form-note" style="margin: 10px 0 20px;">Leave blank if you do not wish to change
                                password.</p>
                            <div class="input-group">
                                <label for="as-new-password"><i class="fas fa-lock"></i> New Password</label>
                                <input type="password" id="as-new-password" placeholder="Enter New Password">
                            </div>
                            <div class="input-group">
                                <label for="as-confirm-password"><i class="fas fa-lock"></i> Confirm New
                                    Password</label>
                                <input type="password" id="as-confirm-password" placeholder="Confirm New Password">
                            </div>
                            <div class="input-group">
                                <label for="as-current-password"><i class="fas fa-key"></i> Current Password (Required
                                    to change)</label>
                                <input type="password" id="as-current-password" placeholder="Enter Current Password">
                            </div>
                            <div class="form-actions" style="text-align: right; margin-top: 30px;">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </section>

                <section id="instructor-profile-edit-view" class="instructor-view">
                    <h2>My Profile and Vehicle Details</h2>
                    <p class="subtitle" style="color: var(--gray-color); margin-top: 5px;">This information will be
                        visible on your public profile.</p>

                    <form id="instructor-profile-form">
                        <div class="profile-content-grid" style="margin-top: 25px;">
                            <div class="profile-main">
                                <div class="card">
                                    <div class="card-header">
                                        <h4>My Profile</h4>
                                    </div>
                                    <div class="form-group" style="padding: 20px;">
                                        <div class="form-group">
                                            <label for="instructor-photo">Upload Instructor Photo</label>
                                            <input type="file" id="instructor-photo" accept="image/*"
                                                class="form-control">
                                        </div>
                                        <label for="instructor-bio">Your Instructor Bio</label>
                                        <textarea id="instructor-bio" rows="10" class="form-control"
                                            style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-family: var(--font-family);"
                                            placeholder="Tell learners a little about yourself..."></textarea>

                                        <label for="languages-spoken" style="margin-top: 20px;">Enter Any Languages You
                                            Speak Fluently</label>
                                        <input type="text" id="languages-spoken"
                                            placeholder="e.g. English, Hindi, Spanish" style="width: 100%;">

                                        <div class="form-group-inline" style="margin-top: 20px;">
                                            <div>
                                                <label>When did you start instructing?</label>
                                                <select id="instructor-start-year">
                                                    <option>2025</option>
                                                    <option>2024</option>
                                                    <option>2023</option>
                                                    <option>2022</option>
                                                    <option>2021</option>
                                                    <option>2020</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label>Transmission(s) you offer</label>
                                                <select id="instructor-transmission">
                                                    <option value="Auto">Auto</option>
                                                    <option value="Manual">Manual</option>
                                                    <option value="Both">Both</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card" style="margin-top: 20px;">
                                    <div class="card-header">
                                        <h4>Vehicle Details</h4>
                                    </div>
                                    <div class="form-group" style="padding: 20px;">
                                        <div class="form-group">
                                            <label for="vehicle-photo">Upload Vehicle Photo</label>
                                            <input type="file" id="vehicle-photo" accept="image/*" class="form-control">
                                        </div>
                                        <div class="form-group-inline">
                                            <div>
                                                <label>Vehicle Make</label>
                                                <input type="text" id="vehicle-make" placeholder="e.g. Toyota">
                                            </div>
                                            <div>
                                                <label>Vehicle Model</label>
                                                <input type="text" id="vehicle-model" placeholder="e.g. Corolla">
                                            </div>
                                        </div>
                                        <div class="form-group-inline" style="margin-top: 20px;">
                                            <div>
                                                <label>ANCAP Safety Rating</label>
                                                <select id="vehicle-ancap">
                                                    <option>5 Star</option>
                                                    <option>4 Star</option>
                                                    <option>3 Star</option>
                                                    <option>Other/Not Rated</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label>Dual Controls?</label>
                                                <select id="vehicle-dual-controls">
                                                    <option value="Yes">Yes</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <aside class="profile-sidebar">
                                <div class="card">
                                    <div class="card-header" style="text-align: center;">
                                        <img src="https://placehold.co/100x100/FFC700/000000?text=SL"
                                            style="height: 60px; border-radius: 50%;">
                                        <h4 style="margin-top: 10px;">Your Public Profile Link</h4>
                                    </div>
                                    <div style="padding: 20px;">
                                        <p style="font-size: 14px; color: var(--gray-color); text-align:center;">Share
                                            this link with potential learners to direct them to your profile.</p>
                                        <div class="share-link-wrapper">
                                            <input type="text" value="safelearners.com/mandeep" readonly>
                                            <button type="button" class="btn btn-secondary"><i class="far fa-copy"></i>
                                                Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-full" style="margin-top: 20px;">Save
                                    and Change</button>
                            </aside>
                        </div>
                    </form>
                </section>


                <section id="instructor-service-area-view" class="instructor-view">
                    <div class="page-view-header">
                        <h2>Service Area & Availability</h2>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Service Area</h4>
                        </div>
                        <div style="padding: 20px;">
                            <p id="service-area-summary" style="color: var(--gray-color); margin-bottom: 20px;">Loading
                                service area details...</p>
                            <div id="service-area-map"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Serviced Suburbs / Test Locations</h4>
                        </div>
                        <div style="padding: 20px;">
                            <label for="suburb-autocomplete-input"
                                style="font-weight: 500; display: block; margin-bottom: 8px;">Add a suburb</label>
                            <div class="input-group" style="margin-bottom: 15px;">
                                <input type="text" id="suburb-autocomplete-input"
                                    placeholder="Start typing a suburb name...">
                            </div>
                            <div id="location-tags-container" class="location-tags-container">
                                <p style="padding: 0;">Loading suburbs...</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Availability</h4>
                        </div>
                        <div style="padding: 20px;">
                            <p style="color: var(--gray-color); line-height: 1.6;">The management of your real-time
                                availability within your operating hours is done via your instructor calendar. You may
                                have an event in your calendar to represent any time that you're unavailable for
                                bookings that fall outside of your operating hours. Your calendar is the source of truth
                                and needs to be updated by you. We use this to prevent double bookings. Your Safe
                                Learners calendar needs to be updated by you each time you make new or have any changes
                                to your personal life appointments and the duration of the lessons, not any corner
                                detail. We also provide the opportunity to nominate travel times.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Your Weekly Availability</h4>
                        </div>
                        <div id="new-availability-container">
                            <div class="availability-day-row" data-day="sunday">
                                <span class="day-label">Sunday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="availability-day-row" data-day="monday">
                                <span class="day-label">Monday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="availability-day-row" data-day="tuesday">
                                <span class="day-label">Tuesday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="availability-day-row" data-day="wednesday">
                                <span class="day-label">Wednesday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="availability-day-row" data-day="thursday">
                                <span class="day-label">Thursday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="availability-day-row" data-day="friday">
                                <span class="day-label">Friday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="availability-day-row" data-day="saturday">
                                <span class="day-label">Saturday</span>
                                <div class="time-inputs">
                                    <input type="time" class="start-time" value="09:00" disabled>
                                    <span>-</span>
                                    <input type="time" class="end-time" value="17:00" disabled>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" class="day-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions" style="text-align: right; margin-top: 20px;">
                        <button id="save-availability-btn" class="btn btn-primary">Save and Change</button>
                    </div>
                </section>



                <!-- END: INSTRUCTOR CALENDAR VIEW -->
            </main>
        </div>
    </div>
    <div id="verification-page" class="page">
        <div class="login-form-container" style="align-items: flex-start; padding-top: 10vh;">
            <div style="width: 100%; max-width: 480px;">

                <div id="verification-progress-bar" class="verification-progress">
                    <div class="step-indicator" id="progress-dl">
                        <span>1</span> Driver's License
                    </div>
                    <div class="step-indicator" id="progress-il">
                        <span>2</span> Instructor License
                    </div>
                    <div class="step-indicator" id="progress-wwc">
                        <span>3</span> WWC Check
                    </div>
                    <div class="step-indicator" id="progress-vr">
                        <span>4</span> Vehicle Registration Certificate
                    </div>
                </div>
                <div id="driver-license-step" class="verification-step">
                    <h2>Step 1: Verify Your Driver's License</h2>
                    <p class="subtitle" style="color: var(--gray-color); margin-bottom: 30px;">
                        Please upload a clear, front-facing photo of your driver's license.
                    </p>
                    <div class="input-group">
                        <label for="license-upload">Driver's License Photo</label>
                        <input type="file" id="license-upload" accept="image/*" required
                            style="padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <button id="submit-license-btn" class="btn btn-primary btn-full">Upload and Continue</button>
                    <button class="btn btn-secondary btn-full skip-verification-btn" style="margin-top: 10px;">Skip &
                        Fill Later</button>
                </div>

                <div id="instructor-license-step" class="verification-step">
                    <h2>Step 2: Verify Your Instructor Licence</h2>
                    <p class="subtitle" style="color: var(--gray-color); margin-bottom: 30px;">
                        Now, please upload a clear photo of your NSW Driving Instructor Licence.
                    </p>
                    <div class="input-group">
                        <label for="instructor-license-upload">Instructor Licence Photo</label>
                        <input type="file" id="instructor-license-upload" accept="image/*" required
                            style="padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <button id="submit-instructor-license-btn" class="btn btn-primary btn-full">Upload and
                        Continue</button>
                    <button class="btn btn-secondary btn-full skip-verification-btn" style="margin-top: 10px;">Skip &
                        Fill Later</button>
                </div>

                <div id="wwc-step" class="verification-step">
                    <h2>Step 3: Verify Your WWC Check</h2>
                    <p class="subtitle" style="color: var(--gray-color); margin-bottom: 30px;">
                        Finally, upload a clear photo or screenshot of your Working with Children Check clearance.
                    </p>
                    <div class="input-group">
                        <label for="wwc-upload">WWC Clearance Photo</label>
                        <input type="file" id="wwc-upload" accept="image/*" required
                            style="padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <button id="submit-wwc-btn" class="btn btn-primary btn-full">Upload and Continue</button>
                    <button class="btn btn-secondary btn-full skip-verification-btn" style="margin-top: 10px;">Skip &
                        Fill Later</button>
                </div>
                <div id="vehicle-rego-step" class="verification-step">
                    <h2>Step 4: Verify Your Vehicle Registration</h2>
                    <p class="subtitle" style="color: var(--gray-color); margin-bottom: 30px;">
                        Please upload a clear photo of your current Certificate of Registration for the vehicle you will
                        be using.
                    </p>
                    <div class="input-group">
                        <label for="rego-upload">Certificate of Registration Photo</label>
                        <input type="file" id="rego-upload" accept="image/*" required
                            style="padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                    </div>
                    <button id="submit-rego-btn" class="btn btn-primary btn-full">Upload and Finish</button>
                    <button class="btn btn-secondary btn-full skip-verification-btn" style="margin-top: 10px;">Skip &
                        Finish</button>
                </div>

                <div id="confirm-step-container" class="verification-step">
                    <h2 id="confirm-title">Confirm Details</h2>
                    <p id="confirm-subtitle" class="subtitle" style="color: var(--gray-color); margin-bottom: 30px;">
                        Please confirm the details we extracted from your document.
                    </p>
                    <div id="confirmation-fields">
                    </div>

                    <p class="signup-link" style="margin-top: 10px; margin-bottom: 20px;">
                        <a href="#" id="retake-image-btn" style="color: var(--gray-color);">Wrong details? Retake image
                            in good lighting</a>
                    </p>

                    <button id="confirm-details-btn" class="btn btn-primary btn-full">Yes, these are correct</button>
                </div>

                <div id="all-verified-step" class="verification-step" style="text-align: center; padding-top: 50px;">
                    <h2>✅ All Documents Verified!</h2>
                    <p>Thank you for completing the verification process. You will now be redirected to your dashboard.
                    </p>
                </div>

                <p id="upload-status" class="error-text" style="height: auto;"></p>
            </div>
        </div>
    </div>

    <div id="dashboard-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>



                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="nav-feedback-main">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-main">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <button class="mobile-menu-btn" id="learner-hamburger-btn">&#9776;</button>

                    <h3>Dashboard</h3>
                    <div class="user-info">
                        <div class="notification-container">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">1</span>
                            <div class="notification-popup">
                                <img src="https://placehold.co/100x100?text=M" alt="Instructor Mandeep">
                                <div class="popup-text">
                                    <p>How was your learning experience with Mandeep?</p>
                                    <a href="#" id="leave-rating-link">Please leave a rating.</a>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        <div class="user-profile">
                            <img src="https://placehold.co/100x100?text=User" alt="User Avatar">
                            <span id="user-name-main">Jhon</span> ▾
                        </div>
                    </div>
                </header>

                <section id="dashboard-main-content" class="dashboard-body content-view active">
                    <h2 id="welcome-message">Welcome back, Shikhar!</h2>
                    <div class="cards-grid">
                        <div id="my-instructor-card" class="card instructor-card">
                            <div class="card-header">
                                <h4>My Instructor</h4>
                                <button id="instructor-card-book-btn" class="btn btn-primary btn-small">Book
                                    Now</button>
                            </div>

                            <div id="instructor-details-content" style="display: none;">
                                <div class="card-body instructor-details">
                                    <div class="instructor-info">
                                        <img id="my-instructor-photo" src="" alt="Instructor Photo">
                                        <div>
                                            <h5 id="my-instructor-name"></h5>
                                            <p id="my-instructor-price"></p>
                                        </div>
                                    </div>
                                    <div class="vehicle-info">
                                        <img id="my-vehicle-photo" src="" alt="Vehicle Photo">
                                        <div>
                                            <h5 id="my-vehicle-name"></h5>
                                            <p id="my-vehicle-details"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <a href="#" id="switch-instructor-link">Switch Instructor &rarr;</a>
                                </div>
                            </div>

                            <div id="no-instructor-content"
                                style="padding: 40px 20px; text-align: center; display: none;">
                                <p style="color: var(--gray-color); margin-bottom: 15px;">You haven't booked an
                                    instructor yet.</p>
                                <button id="find-instructor-btn" class="btn btn-primary">Find an Instructor Now</button>
                            </div>
                        </div>
                        <div class="card wallet-card">
                            <div class="card-header">
                                <h4>My Wallet</h4>
                                <button id="add-credit-btn" class="btn btn-secondary btn-small">Add Credit</button>
                            </div>
                            <div class="card-body">
                                <h2 class="wallet-balance">$ 30</h2>
                                <p class="wallet-note">Includes $ 30 Of Non Refundable Credit</p>
                            </div>
                            <div class="card-footer">
                                <a href="#">View Details &rarr;</a>
                            </div>
                        </div>
                    </div>
                    <div class="card test-package-card">
                        <div class="test-package-details">
                            <div class="package-icon"><span>P</span></div>
                            <div class="package-info">
                                <h4>Driving Test Package</h4>
                                <ul>
                                    <li>2.5hr Test Package</li>
                                    <li>Use Instructor's Vehicle for Test</li>
                                    <li>Pick Up & Drop Off Included</li>
                                    <li>45 Minute Pre-Test Warm Up Lesson</li>
                                </ul>
                            </div>
                        </div>
                        <div class="test-package-action">
                            <span class="price">$ 200</span>
                            <button class="btn btn-primary open-booking-btn dynamic-booking-btn">Book Now</button>
                        </div>
                    </div>
                    <div class="booking-section">
                        <h3>Booking</h3>
                        <div class="tabs">
                            <button class="tab-link" data-target="upcoming-content">Upcoming</button>
                            <button class="tab-link active" data-target="services-content">Services</button>
                            <button class="tab-link" data-target="history-content">History</button>
                        </div>

                        <div id="upcoming-content" class="tab-pane tab-content">
                            <p>You Have No Upcoming Booking To View At This Time</p>
                        </div>

                        <div id="services-content" class="tab-pane active">
                            <div class="services-grid">
                                <div class="service-card">
                                    <img src="https://placehold.co/200x100?text=Image" alt="Image of Your choice"
                                        class="illustration">
                                    <h4>1 hour <br>Driving Lesson</h4>
                                    <p>Price <strong>$70</strong><br>Transmission <strong>Auto</strong></p>
                                    <button class="btn btn-primary btn-full open-booking-btn dynamic-booking-btn">Book
                                        with Fazley</button>
                                </div>
                                <div class="service-card">
                                    <span class="popular-tag">MOST POPULAR</span>
                                    <img src="https://placehold.co/200x100?text=Image" alt="Image of Your choice"
                                        class="illustration">
                                    <h4>2 hour <br>Driving Lesson</h4>
                                    <p>Price <strong>$140</strong><br>Transmission <strong>Auto</strong></p>
                                    <button class="btn btn-primary btn-full open-booking-btn dynamic-booking-btn">Book
                                        with Fazley</button>
                                </div>
                                <div class="service-card">
                                    <img src="https://placehold.co/200x100?text=Image" alt="Image of Your choice"
                                        class="illustration">
                                    <h4>2.5 hours <br>Test Package</h4>
                                    <p>Price <strong>$225</strong><br>Transmission <strong>Auto</strong></p>
                                    <button class="btn btn-primary btn-full open-booking-btn dynamic-booking-btn">Book
                                        with Fazley</button>
                                </div>
                            </div>
                        </div>

                        <div id="history-content" class="tab-pane tab-content">
                            <div class="booking-history-container">
                                <div class="booking-history-table">
                                    <div class="history-header">
                                        <div class="history-cell">Booking</div>
                                        <div class="history-cell">Instructor</div>
                                        <div class="history-cell">Date</div>
                                        <div class="history-cell">Time</div>
                                        <div class="history-cell">Location</div>
                                        <div class="history-cell">Status</div>
                                        <div class="history-cell">Payment</div>
                                    </div>
                                    <div class="history-row">
                                        <div class="history-cell" data-label="Booking">
                                            <a href="#" class="booking-id-link">#7934355</a>
                                        </div>
                                        <div class="history-cell instructor-cell" data-label="Instructor">
                                            <img src="https://placehold.co/100x100?text=M" alt="Mandeep">
                                            <span>Mandeep</span>
                                        </div>
                                        <div class="history-cell" data-label="Date">Mon, 24 Feb 2025</div>
                                        <div class="history-cell" data-label="Time">9:00 am - 10:00 am</div>
                                        <div class="history-cell" data-label="Location">5 Hogan PL, Quakers Hill 2763
                                            NSW</div>
                                        <div class="history-cell" data-label="Status">
                                            <span class="status-badge status-completed">COMPLETED</span>
                                        </div>
                                        <div class="history-cell" data-label="Payment">
                                            <span class="status-badge status-processed">PROCESSED</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <div id="switch-instructor-content" class="content-view">
                    <div id="switch-instructor-content" class="content-view">
                        <a href="#" id="back-to-dashboard-btn" class="back-link">
                            <i class="fas fa-chevron-left"></i> Back to Dashboard
                        </a>
                    </div>
                    <header class="instructor-filters">
                        <div class="filter-group">
                            <label>Time</label>
                            <button class="filter-btn active" data-time-filter="any">Anytime</button>
                            <button class="filter-btn" data-time-filter="am">AM</button>
                            <button class="filter-btn" data-time-filter="pm">PM</button>
                        </div>
                        <div class="filter-group">
                            <label>Day</label>
                            <button class="filter-btn">Today - Sun</button>
                            <button class="filter-btn">Mon - Thu</button>
                            <button class="filter-btn">Custom</button>
                        </div>
                        <button id="clear-filters-btn" class="btn btn-secondary">Clear Filter</button>
                        <select id="sort-filter" class="filter-sort">
                            <option value="default">Sort</option>
                            <option value="price-asc">Price (Low to High)</option>
                            <option value="price-desc">Price (High to Low)</option>
                        </select>
                    </header>
                    <section class="instructor-page-layout">
                        <div class="instructor-list-container">
                            <!-- ADD: back button for instructor list page -->
                            <div class="list-page-header">
                                <a href="#" id="back-to-dashboards-btn" class="back-link">
                                    <i class="fas fa-chevron-left"></i> Back
                                </a>
                            </div>

                            <h3>63 Auto instructors available in the next 7 days</h3>
                            <p class="subtitle">From $60.00/hr</p>
                            <div class="instructor-grid">
                            </div>
                        </div>
                        <aside class="instructor-search-sidebar">
                            <div class="card">
                                <div class="form-group">
                                    <label for="transmission-filter">Transmission</label>
                                    <select id="transmission-filter">
                                        <option value="any">Any</option>
                                        <option value="Auto">Auto</option>
                                        <option value="Manual">Manual</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="language-filter">Spoken Languages</label>
                                    <select id="language-filter">
                                        <option value="any">Any spoken languages</option>
                                        <option value="English">English</option>
                                        <option value="Hindi">Hindi</option>
                                        <option value="Spanish">Spanish</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="region-input">Region</label>
                                    <div class="location-field">
                                        <input type="text" id="region-input" placeholder="Enter suburb or postcode..."
                                            style="border:none; width:100%;">
                                    </div>
                                </div>
                                <button id="region-search-btn" class="btn btn-primary btn-full">Search</button>
                            </div>
                        </aside>
                    </section>
                </div>
            </main>

        </div>
    </div>

    <div id="main-wallet-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" id="nav-dashboard-main-wallet">Dashboard</a></li>
                        <li class="active"><a href="#" id="nav-wallet-main-wallet">Wallet</a></li>
                        <li><a href="#" class="nav-invite-friends">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="feedback-btn">Give Feedback</a></li>
                        <li><a href="#" id="support-btn">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-main-wallet" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <div class="breadcrumbs">
                        <span> > Wallet</span>
                    </div>
                    <div class="user-info">
                        <div class="notification-container">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">1</span>
                            <div class="notification-popup">
                                <img src="https://media.istockphoto.com/id/483627817/photo/showing-off-his-pearly-whites.jpg?s=612x612&w=0&k=20&c=gk6aVVGp52YFx1ZzPVQplGc7JL5zkrfxQTuLjIn2RU8="
                                    alt="Instructor Mandeep">
                                <div class="popup-text">
                                    <p>How was your learning experience with Mandeep?</p>
                                    <a href="#" id="leave-rating-link">Please leave a rating.</a>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        <div class="user-profile">
                            <img src="https://img.freepik.com/free-photo/happy-man-student-with-afro-hairdo-shows-white-teeth-being-good-mood-after-classes_273609-16608.jpg"
                                alt="User Avatar">
                            <span id="user-name-wallet">Jhon</span> ▾
                        </div>
                    </div>
                </header>

                <section class="wallet-view-grid">
                    <div class="wallet-view-main">
                        <div class="card">
                            <h4>Payment Method</h4>
                            <div class="payment-method-card">
                                <span>Mastercard ending in 9059</span>
                                <button class="close-btn">&times;</button>
                            </div>
                        </div>
                        <div class="card">
                            <h4>All Transactions</h4>
                            <div class="transactions-table">
                                <div class="transactions-header">
                                    <div>Transaction ID</div>
                                    <div>Description</div>
                                    <div>Date</div>
                                    <div>Amount</div>
                                    <div>Balance</div>
                                </div>
                                <div class="transaction-row">
                                    <div>#2289679</div>
                                    <div>1 Hour Driving Lesson with Mandeep...</div>
                                    <div>Fri, 21 Feb 2025</div>
                                    <div>-$75.00</div>
                                    <div>$0.00</div>
                                </div>
                                <div class="transaction-row">
                                    <div>#2289678</div>
                                    <div>Credit purchased</div>
                                    <div>Fri, 21 Feb 2025</div>
                                    <div>$75.00</div>
                                    <div>$75.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <aside class="wallet-view-sidebar">
                        <div class="card">
                            <div class="card-header">
                                <h4>My Wallet</h4>
                                <button id="add-credit-from-main-wallet-btn" class="btn btn-secondary btn-small">Add
                                    Credit</button>
                            </div>
                            <div class="card-body">
                                <h2 class="wallet-balance">$0</h2>
                                <p class="wallet-note">Includes $0.00 of non refundable credit</p>
                            </div>
                        </div>
                    </aside>
                </section>
            </main>
        </div>
    </div>
    <div id="wallet-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="nav-feedback-main">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-wallet">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-wallet" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <div class="breadcrumbs">
                        <span>My Wallet</span> > <span>Add Credit</span>
                    </div>
                    <div class="user-info">
                        <div class="notification-container">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">1</span>
                            <div class="notification-popup">
                                <img src="https://placehold.co/100x100?text=M" alt="Instructor Mandeep">
                                <div class="popup-text">
                                    <p>How was your learning experience with Mandeep?</p>
                                    <a href="#" id="leave-rating-link">Please leave a rating.</a>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        <div class="user-profile">
                            <img src="https://placehold.co/100x100?text=User" alt="User Avatar">
                            <span id="user-name-main">Jhon</span> ▾
                        </div>
                    </div>
                </header>

                <section class="wallet-content">
                    <div class="wallet-main">
                        <h2>Add Lesson Credit</h2>
                        <p class="subtitle">Buy more and save!</p>

                        <div class="credit-options">
                            <div class="credit-option selected">
                                <input type="radio" id="hours10" name="credit" value="10" checked>
                                <label for="hours10" class="option-details">
                                    <div class="option-title">
                                        <h4>10 hours</h4>
                                        <span class="tag discount-tag">10% OFF</span>
                                    </div>
                                    <p>Perfect for new learners starting their driving journey from scratch</p>
                                </label>
                            </div>
                            <div class="credit-option">
                                <input type="radio" id="hours6" name="credit" value="6">
                                <label for="hours6" class="option-details">
                                    <div class="option-title">
                                        <h4>6 hours</h4>
                                        <span class="tag discount-tag-alt">5% OFF</span>
                                    </div>
                                    <p>Ideal for new learners, overseas license holders, or anyone needing a driving
                                        skill refresh.</p>
                                </label>
                            </div>
                            <div class="credit-option custom-hours">
                                <input type="radio" id="custom" name="credit" value="custom">
                                <label for="custom" class="option-details">
                                    <div class="option-title">
                                        <h4>Select custom hours</h4>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <aside class="wallet-sidebar">
                        <div class="card order-summary">
                            <h4>Order Summary</h4>
                            <div class="summary-item">
                                <span>1 hr Booking Credit</span>
                            </div>
                            <div class="summary-total">
                                <span>Total Payment Due</span>
                                <span class="total-price">$0.00</span>
                            </div>
                            <button class="btn btn-primary btn-full">Continue</button>
                        </div>
                        <div class="card bnp-card">
                            <h4>Buy Now Pay Later</h4>
                            <p>4 payments of $0.00</p>
                            <div class="payment-logos">
                                Pay in 4
                                <img src="https://placehold.co/100x25/00A39A/FFFFFF?text=afterpay" alt="Afterpay">
                                <img src="https://placehold.co/100x25/FFB3C7/000000?text=klarna" alt="Klarna">
                            </div>
                        </div>
                    </aside>
                </section>

            </main>
        </div>
    </div>

    <div id="booking-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="nav-feedback-main">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-booking">Support</a></li>
                    </ul>
                    <button id="logout-button-booking" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <div class="breadcrumbs">
                        <span>Dashboard</span> > <span>Make a Booking</span>
                    </div>
                    <div class="user-info">
                        <div class="notification-container">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">1</span>
                            <div class="notification-popup">
                                <img src="https://placehold.co/100x100?text=M" alt="Instructor Mandeep">
                                <div class="popup-text">
                                    <p>How was your learning experience with Mandeep?</p>
                                    <a href="#" id="leave-rating-link">Please leave a rating.</a>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        <div class="user-profile">
                            <img src="https://placehold.co/100x100?text=User" alt="User Avatar">
                            <span id="user-name-main">Jhon</span> ▾
                        </div>
                    </div>
                </header>

                <section class="booking-content">
                    <div class="booking-main">
                        <!-- ADD: back button for instructor list page -->
                        <div class="list-page-header">
                            <a href="#" id="back-to-dashboard-btn" class="back-link">
                                <i class="fas fa-chevron-left"></i> Back
                            </a>
                        </div>

                        <h2>Make a Booking</h2>

                        <div class="card">
                            <h4>My Instructor</h4>
                            <div class="instructor-details" style="margin-top: 20px;">
                                <div class="instructor-info">
                                    <img src="https://img.freepik.com/free-photo/handsome-man-smiling-happy-face-portrait-close-up_53876-145493.jpg"
                                        alt="Instructor Fazley">
                                    <div>
                                        <h5>Fazley</h5>
                                        <p>$70/hr<br>Offers 1 & 2hr lessons</p>
                                    </div>
                                </div>
                                <div class="vehicle-info">
                                    <img src="https://di-uploads-pod25.dealerinspire.com/edmarktoyota/uploads/2024/02/2024-toyota-corolla-banner.jpg"
                                        alt="Toyota Corolla">
                                    <div>
                                        <h5>Toyota Corolla 2011 (Auto)</h5>
                                        <p>5-star ANCAP rating<br>Dual controls fitted</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h4>New Booking</h4>
                            <div class="booking-type-tabs" id="booking-type-tabs">
                                <button class="tab-link active" data-lesson-type="1-hour">1-Hour Lesson</button>
                                <button class="tab-link" data-lesson-type="2-hour">2-Hour Lesson</button>
                                <button class="tab-link" data-lesson-type="test-package">Driving Test Package</button>
                            </div>
                            <div id="test-package-warning" class="warning-box" style="display: none;">
                                <strong>WARNING:</strong> You must book your own driving test with local roads
                                authority. Our Test Package only books the instructor and vehicle.
                            </div>

                            <form id="booking-form">
                                <div class="form-group" id="test-location-group" style="display: none;">
                                    <label for="test-location">Driving test location</label>
                                    <select id="test-location" name="testLocation">
                                        <option value="">Select the test location</option>
                                        <!-- Options will be populated by JS -->
                                    </select>
                                </div>
                                <div class="form-group-inline">
                                    <div class="form-group">
                                        <label for="available-dates">Available Dates</label>
                                        <select id="available-dates" name="bookingDate">
                                            <option value="">Select a day</option>
                                            <!-- Options will be populated by JS -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="available-times">Available Times</label>
                                        <select id="available-times" name="bookingTime">
                                            <option value="">Select a time</option>
                                            <!-- Options will be populated by JS -->
                                        </select>
                                    </div>
                                </div>
                                <p id="pickup-time-note" class="form-note" style="display: none;">* The pickup time will
                                    be 1 hour prior to the test start time.</p>

                                <div class="form-group">
                                    <label>Pick Up Location</label>
                                    <select id="pickup-location-select" name="pickupLocation">
                                        <option value="">Select a pickup location...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Drop Off Location</label>
                                    <div class="location-field">
                                        <span id="dropoff-location-display">5 Hogan PL, Quakers Hill NSW 2763</span>
                                        <button type="button" class="edit-btn" id="edit-dropoff-btn"><i
                                                class="fas fa-pencil-alt"></i> Edit</button>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary btn-full btn-disabled"
                                        id="confirm-booking-btn" disabled>Confirm Booking</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <aside class="booking-sidebar">
                        <div class="card order-summary">
                            <h4>Order Summary</h4>
                            <div id="order-summary-content">
                                <div class="summary-item">
                                    <span>Lesson Type:</span><span id="summary-lesson-type">-</span>
                                </div>
                                <div class="summary-item">
                                    <span>Date & Time:</span><span id="summary-date-time">-</span>
                                </div>
                                <div class="summary-item">
                                    <span>Price:</span><span id="summary-price">-</span>
                                </div>
                            </div>
                            <div class="summary-total">
                                <span>Total Payment Due</span>
                                <span class="total-price" id="summary-total-price">$0.00</span>
                            </div>
                            <button class="btn btn-primary btn-full btn-disabled" disabled
                                id="sidebar-continue-btn">Continue</button>
                        </div>
                    </aside>
                </section>



            </main>
        </div>
    </div>

    <div id="instructor-profile-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="nav-feedback-main">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-profile">Support</a></li>

                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-profile" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <a href="#" id="back-to-instructors-btn" class="back-link"><i class="fas fa-chevron-left"></i> Back</a>

                <section class="profile-content-grid">
                    <div class="profile-main">
                        <header class="profile-header">
                            <img src="https://media.istockphoto.com/id/509481682/photo/close-up-portrait-of-arabic-nice-man.jpg?s=612x612&w=0&k=20&c=5wx2Qf0J3oXzTiSBRTR3Xjm6ANzLOMhPOboOZZnU6fw="
                                alt="Instructor Syed" class="profile-photo">
                            <img src="https://stimg.cardekho.com/images/carexteriorimages/930x620/Toyota/Urban-Cruiser/12237/1735368926257/front-left-side-47.jpg"
                                alt="Car" class="profile-car-photo">
                            <div class="profile-header-info">
                                <h2>Syed</h2>
                                <div class="profile-rating">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                        class="fas fa-star"></i><i class="far fa-star"></i>
                                    <span>4.3 - 3 ratings</span>
                                </div>
                            </div>
                        </header>

                        <div class="profile-section">
                            <h3>Instructor Bio</h3>
                            <p>My name is Syed. I have been a driving instructor since 2024. I want to have a positive
                                impact. I am patient and understanding. I highly enjoy seeing learners gain confidence
                                and independence. I am experienced in teaching new drivers but also international
                                drivers looking to adjust to Australian roads and rules. My main goal when working with
                                learners is to help you become a safe, risk-averse driver.</p>
                        </div>

                        <div class="profile-section">
                            <ul class="checkmark-list">
                                <li><i class="fas fa-check"></i> Auto Lessons & Test Packages</li>
                                <li><i class="fas fa-check"></i> Verified Working with Children Check</li>
                                <li><i class="fas fa-check"></i> Driving Instructor's Licence</li>
                                <li><i class="fas fa-check"></i> Instructed for 1 yr. 2 mo.</li>
                            </ul>
                        </div>

                        <div class="profile-section">
                            <h3>Spoken language(s)</h3>
                            <span class="language-tag">English</span>
                        </div>
                    </div>
                    <aside class="profile-sidebar">
                        <div class="card price-card">
                            <div class="price-card-item">
                                <div>
                                    <h4>Hourly Price</h4>
                                    <p>Offers 1 & 2hr lessons</p>
                                </div>
                                <span>$80/hr</span>
                            </div>
                            <div class="price-card-item">
                                <h4>6hrs or more</h4>
                                <span class="tag save-tag">SAVE 5%</span>
                            </div>
                            <div class="price-card-item">
                                <h4>10hrs or more</h4>
                                <span class="tag save-tag">SAVE 10%</span>
                            </div>
                            <div class="price-card-item">
                                <h4>Test Package (2.5 hrs)</h4>
                                <span>$225</span>
                            </div>
                            <button class="btn btn-primary btn-full open-booking-btn">Book Now</button>
                            <button id="check-availability-btn" class="btn btn-secondary btn-full">Check
                                Availability</button>
                        </div>
                        <div class="card bnp-card">
                            <h4>Buy Now Pay Later</h4>
                            <p>4 payments of $20.00</p>
                            <div class="payment-logos">
                                Pay in 4
                                <img src="https://placehold.co/100x25/00A39A/FFFFFF?text=afterpay" alt="Afterpay">
                                <img src="https://placehold.co/100x25/FFB3C7/000000?text=klarna" alt="Klarna">
                            </div>
                        </div>
                    </aside>
                </section>
            </main>
        </div>
    </div>
    <div id="booking-details-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="nav-feedback-main">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-profile">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-details" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <div class="breadcrumbs">
                        <span>Dashboard</span> > <span>Booking #7934355</span>
                    </div>
                    <div class="user-info">
                        <div class="notification-container">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">1</span>
                            <div class="notification-popup">
                                <img src="https://placehold.co/100x100?text=M" alt="Instructor Mandeep">
                                <div class="popup-text">
                                    <p>How was your learning experience with Mandeep?</p>
                                    <a href="#" id="leave-rating-link">Please leave a rating.</a>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        <div class="user-profile">
                            <img src="https://placehold.co/100x100?text=User" alt="User Avatar">
                            <span id="user-name-main">Jhon</span> ▾
                        </div>
                    </div>
                </header>

                <section class="booking-details-content">
                    <div class="booking-details-header">
                        <h2>Booking #7934355</h2>
                        <div class="booking-details-actions">
                            <button class="btn btn-secondary"><i class="fas fa-question-circle"></i> Support</button>
                            <button class="btn btn-secondary">Modify Booking</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="booking-main-info">
                            <div class="booking-info-item">
                                <span class="status-badge status-completed">COMPLETED</span>
                            </div>
                            <div class="booking-info-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Mon, 24 Feb 2025</span>
                            </div>
                            <div class="booking-info-item">
                                <i class="fas fa-clock"></i>
                                <span>9:00 am - 10:00 am</span>
                            </div>
                            <div class="booking-info-item">
                                <i class="fas fa-road"></i>
                                <span>1 Hour Driving Lesson (Auto)</span>
                            </div>
                            <div class="booking-info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>5 Hogan PL, Quakers Hill 2763 NSW</span>
                            </div>
                            <div class="booking-info-instructor">
                                <img src="https://placehold.co/100x100?text=M" alt="Instructor Mandeep">
                                <div>
                                    <p>Instructor details</p>
                                    <h5>Mandeep</h5>
                                    <p>0497 011 481</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h4>Payment</h4>
                        <div class="payment-details">
                            <div>
                                <p>Booking made on 21 Feb 2025, 8:07 PM</p>
                                <span class="status-badge status-processed">PROCESSED</span>
                            </div>
                            <div class="payment-amount">
                                <h2>$75</h2>
                                <p>From your EzLicence Wallet</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h4>Booking Update History</h4>
                        <div class="update-history-list">
                            <div class="update-history-item">
                                <div class="update-icon"><i class="fas fa-credit-card"></i></div>
                                <div class="update-details">
                                    <p><strong>Payment</strong> booking payment applied</p>
                                    <p class="update-time">4 months ago</p>
                                </div>
                                <span class="status-badge status-processed">PROCESSED</span>
                            </div>
                            <div class="update-history-item">
                                <div class="update-icon"><i class="fas fa-calendar-check"></i></div>
                                <div class="update-details">
                                    <p><strong>Booking</strong> processed</p>
                                    <p class="update-time">4 months ago</p>
                                </div>
                                <span class="status-badge status-completed">COMPLETED</span>
                            </div>
                            <div class="update-history-item">
                                <div class="update-icon"><i class="fas fa-user-check"></i></div>
                                <div class="update-details">
                                    <p><strong>Shikhar G.</strong> confirmed this booking</p>
                                    <p class="update-time">4 months ago</p>
                                </div>
                                <span class="status-badge status-confirmed">CONFIRMED</span>
                            </div>
                            <div class="update-history-item">
                                <div class="update-icon"><i class="fas fa-user-plus"></i></div>
                                <div class="update-details">
                                    <p><strong>Shikhar G.</strong> accepted booking proposal</p>
                                    <p class="update-time">4 months ago</p>
                                </div>
                                <span class="status-badge status-confirmed">CONFIRMED</span>
                            </div>
                            <div class="update-history-item">
                                <div class="update-icon"><i class="fas fa-paper-plane"></i></div>
                                <div class="update-details">
                                    <p><strong>Mandeep</strong> proposed this booking</p>
                                    <p class="update-time">4 months ago</p>
                                </div>
                                <span class="status-badge status-pending">PENDING</span>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="rating-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="nav-feedback-main">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-profile">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button class="btn btn-secondary logout-btn">Logout</button>
                </div>
            </aside>
            <main class="main-content rating-page-main">
                <div class="card rating-card">
                    <form id="rating-form">
                        <h2>Rate Your Instructor</h2>
                        <p class="rating-question">How was your learning experience with Mandeep?</p>
                        <div class="rating-input-group">
                            <input type="radio" name="rating" id="rating-1" value="1" required><label
                                for="rating-1">1</label>
                            <input type="radio" name="rating" id="rating-2" value="2"><label for="rating-2">2</label>
                            <input type="radio" name="rating" id="rating-3" value="3"><label for="rating-3">3</label>
                            <input type="radio" name="rating" id="rating-4" value="4"><label for="rating-4">4</label>
                            <input type="radio" name="rating" id="rating-5" value="5"><label for="rating-5">5</label>
                        </div>
                        <p class="rating-note">* 5 is the highest rating.</p>
                        <textarea name="feedback" placeholder="Enter your feedback here..." rows="5"></textarea>
                        <button type="submit" class="btn btn-primary btn-full">Submit</button>
                        <p class="rating-note">Please note: This review will be public to assist future learners.</p>
                    </form>
                </div>
            </main>
        </div>
    </div>
    <div id="invite-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="feedback-btn">Give Feedback</a></li>
                        <li><a href="#" id="support-btn">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-invite" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <div class="card invite-header-card">
                    <h2>Refer Friends & Family To Earn Cash!</h2>
                    <p>Earn Cash Together With Your Friends & Family Each Time They Make Their First Purchase With Safe
                        Learners.</p>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <i class="fas fa-gift"></i>
                            <span>You Get <strong>$20 Cash</strong> From Safe Learners</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-gift"></i>
                            <span>They Get <strong>$10 Cash</strong> From Safe Learners</span>
                        </div>
                    </div>
                    <p class="terms-text">Lorem Ipsum Is Simply Dummy Text Of The Printing And Typesetting Industry.
                        Lorem Ipsum Has Been The Industry's Standard Dummy Text Ever Since The 1500s. <a href="#">Terms
                            And Conditions Apply</a></p>
                </div>

                <div class="card share-card">
                    <span class="share-tag">Start Sharing</span>
                    <h3>Simple Share Your Unique Link</h3>
                    <div class="share-link-wrapper">
                        <input type="text" id="referral-link-input" value="https://safelearners.com/ref/Design@202"
                            readonly>
                        <button id="copy-link-btn" class="btn btn-secondary"><i class="far fa-copy"></i> Copy
                            Link</button>
                    </div>
                    <p class="or-text">Or Tell people to enter <span class="referral-code">Design@202</span> into the
                        referral code field during the Signup</p>
                    <div class="social-share-btns">
                        <button class="btn btn-secondary"><i class="fab fa-facebook-f"></i> Facebook</button>
                        <button class="btn btn-secondary"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                        <button class="btn btn-secondary"><i class="far fa-envelope"></i> Email</button>
                    </div>
                </div>

                <div class="card rewards-card">
                    <div class="rewards-header">
                        <h3>My Rewards</h3>
                        <span>Current Balance: $02</span>
                    </div>
                    <div class="rewards-content">
                        <div class="reward-summary-circle">
                            <h2>0</h2>
                            <p>Referrals</p>
                            <hr>
                            <h2>$0</h2>
                            <p>Earned</p>
                        </div>
                        <div class="rewards-table">
                            <div class="rewards-table-header">
                                <div>Date</div>
                                <div>Transaction</div>
                                <div>Amount</div>
                            </div>
                            <div class="rewards-table-row">
                                <div>---</div>
                                <div>---</div>
                                <div>---</div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <div id="instructor-booking-details-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li class="active"><a href="#" id="nav-dashboard-ibd">Dashboard</a></li>
                        <li><a href="#" id="nav-wallet-ibd">Wallet</a></li>
                        <li><a href="#" class="nav-invite-friends">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#">Give Feedback</a></li>
                        <li><a href="#">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-ibd" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content">
                <header class="dashboard-header">
                    <div class="breadcrumbs">
                        <span> > </span> <a href="#">Upcoming Bookings</a> <span> > Booking #8132725</span>
                    </div>
                    <div class="user-info">
                        <i class="fas fa-bell"></i>
                        <div class="user-profile">
                            <img src="https://placehold.co/100x100?text=M" alt="User Avatar">
                            <span id="instructor-user-name-details">Mandeep</span> ▾

                            <div class="profile-dropdown">
                                <a href="#" id="edit-profile-link"><i class="fas fa-user-edit"></i> My Profile</a>
                                <a href="#" class="instructor-logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                            </div>
                        </div>
                    </div>
                </header>

                <section class="booking-details-body">
                    <div class="card">
                        <div class="booking-details-title">
                            <h2>Booking #8132725 <span class="status-badge status-completed">COMPLETED</span></h2>
                        </div>
                        <div class="booking-details-grid">
                            <div class="booking-details-info">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Sun, 08 Jun 2025</span>
                            </div>
                            <div class="booking-details-info">
                                <i class="fas fa-clock"></i>
                                <span>2:30 pm - 4:30 pm</span>
                            </div>
                            <div class="booking-details-info">
                                <i class="fas fa-car"></i>
                                <span>2 Hour Driving Lesson (Auto)</span>
                            </div>
                            <div class="booking-details-info">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>14 Jasper Rd, Baulkham Hills 2153 NSW</span>
                            </div>
                            <div class="booking-details-info learner-info">
                                <img src="https://placehold.co/100x100?text=J" alt="Learner">
                                <div>
                                    <strong>Learner details</strong>
                                    <p>Janavika H.<br>0452668197</p>
                                </div>
                            </div>
                            <div class="booking-details-info parent-info">
                                <i class="fas fa-user-shield"></i>
                                <div>
                                    <strong>Parent details</strong>
                                    <p>MANISH H.<br>0452668197</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="payment-details-header">
                            <h4>Payment <span class="status-badge status-processed">PROCESSED</span></h4>
                            <button class="btn btn-secondary btn-small"><i class="fas fa-history"></i> Reverse
                                Payment</button>
                        </div>
                        <div class="payment-details-body">
                            <p>Booking Made On<br>26 May 2025, 7:07 AM</p>
                            <div class="payment-amount">
                                <h2>$112.50</h2>
                                <p>Your Net Payment</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="notes-header">
                            <h4>Your Notes <i class="fas fa-info-circle"></i></h4>
                            <button class="btn btn-secondary btn-small">+ Add a Note</button>
                        </div>
                        <div class="notes-body">
                            <p>Write your first note about Janavika H.<br>(These notes are only visible by you.)</p>
                        </div>
                    </div>

                    <div class="card">
                        <h4>Booking Update History</h4>
                        <div class="history-table" style="margin-top: 15px;">
                            <div class="history-table-header wide-grid">
                                <div></div>
                                <div>Event</div>
                                <div>Updated</div>
                                <div>Status</div>
                            </div>
                            <div class="history-table-row wide-grid">
                                <div class="update-icon"><i class="fas fa-credit-card"></i></div>
                                <div><strong>Payment</strong> booking payment applied</div>
                                <div>10 days ago</div>
                                <div><span class="status-badge status-processed">PROCESSED</span></div>
                            </div>
                            <div class="history-table-row wide-grid">
                                <div class="update-icon"><i class="fas fa-calendar-check"></i></div>
                                <div><strong>Booking</strong> processed</div>
                                <div>10 days ago</div>
                                <div><span class="status-badge status-completed">COMPLETED</span></div>
                            </div>
                            <div class="history-table-row wide-grid">
                                <div class="update-icon"><i class="fas fa-user"></i></div>
                                <div><strong>Janavika H.</strong> confirmed this booking</div>
                                <div>23 days ago</div>
                                <div><span class="status-badge status-confirmed">CONFIRMED</span></div>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <div id="availability-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="modal-close-btn">&times;</button>
            <h4>To begin the booking process please select "Book with Syed".</h4>

            <div class="availability-controls">
                <label><input type="radio" name="status" checked> Available</label>
                <label><input type="radio" name="status"> Closed / booked out</label>
            </div>

            <div class="calendar-nav">
                <button>&lt;</button>
                <button class="today-btn">Today</button>
                <span>26 Jun – 2 Jul 2025</span>
                <button>&gt;</button>
            </div>

            <div class="schedule-grid-container">
                <div class="schedule-grid">
                    <div class="time-labels">
                        <div>5am</div>
                        <div>6am</div>
                        <div>7am</div>
                        <div>8am</div>
                        <div>9am</div>
                        <div>10am</div>
                        <div>11am</div>
                        <div>12pm</div>
                        <div>1pm</div>
                        <div>2pm</div>
                        <div>3pm</div>
                        <div>4pm</div>
                        <div>5pm</div>
                        <div>6pm</div>
                        <div>7pm</div>
                        <div>8pm</div>
                        <div>9pm</div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Thu 26/6</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Fri 27/6</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Sat 28/6</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Sun 29/6</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Mon 30/6</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Tue 1/7</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                    <div class="day-column">
                        <div class="day-header">Wed 2/7</div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                        <div class="time-slot unavailable"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="invite-learner-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close-btn">&times;</button>
            <div class="invite-modal-header">
                <i class="fas fa-user-plus"></i>
                <h3>Invite Learner</h3>
            </div>
            <form id="invite-learner-form">
                <div class="form-group-inline" style="gap: 25px;">
                    <div class="input-group">
                        <label for="invite-learner-name">Learner Name *</label>
                        <input type="text" id="invite-learner-name" required>
                    </div>
                    <div class="input-group">
                        <label for="invite-learner-mobile">Mobile *</label>
                        <input type="tel" id="invite-learner-mobile" placeholder="0400 000 000" required>
                    </div>
                </div>
                <div class="invite-modal-actions">
                    <button type="button" class="btn btn-secondary btn-disabled" disabled>Propose Booking</button>
                    <button type="submit" class="btn btn-primary">Send SMS Invite</button>
                </div>
            </form>
        </div>
    </div>
    <div id="contact-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 550px; text-align: left; padding: 25px 35px;">
            <button class="modal-close-btn">&times;</button>
            <h3 class="contact-modal-title">Contact Our Team</h3>
            <p>Under the "Support" menu, you will find some great resources and answers to many of the more commonly
                asked questions.</p>
            <div class="contact-modal-images">
                <img src="https://placehold.co/150x300/f1f1f1/333?text=App+Screen+1" alt="App Screenshot 1">
                <img src="https://placehold.co/150x300/f1f1f1/333?text=App+Screen+2" alt="App Screenshot 2">
            </div>
            <p>If you need further assistance or you have feedback, please click <a href="#">here</a> to submit a
                request.</p>
            <p>In case of an emergency, please SMS the details to <br><strong>0490 418 703</strong></p>
            <p>Learners who require assistance can contact our Customer Support Team by <a href="#">Submitting a
                    request</a>.</p>
        </div>
    </div>
    <div id="reviews-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px; padding: 0;">
            <div class="reviews-header">
                <h3>Reviews ★ 5.0 - 32 Ratings</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="reviews-body">
                <div class="reviews-notice">
                    <i class="fas fa-info-circle"></i>
                    <span>Your 25 most recent reviews will be displayed on your public profile.</span>
                </div>
                <div class="review-item">
                    <div class="review-meta">
                        <strong>Kylah</strong>
                        <span>Posted on 8 Jun 2025</span>
                    </div>
                    <div class="review-stars">
                        ★★★★★
                    </div>
                    <p class="review-text">Very helpful, kind and calm, made me feel comfortable and confident in
                        driving. I definitely recommend!</p>
                </div>
                <div class="review-item">
                    <div class="review-meta">
                        <strong>Jasper</strong>
                        <span>Posted on 3 Jun 2025</span>
                    </div>
                    <div class="review-stars">
                        ★★★★★
                    </div>
                    <p class="review-text">Mandeep is a calm and highly effective instructor. He is exceptionally
                        attentive and provides clear, constructive feedback by promptly identifying mistakes and guiding
                        you toward the correct approach. I look forward to continuing my learning journey with him.
                        Highly recommended.</p>
                </div>
                <div class="review-item">
                    <div class="review-meta">
                        <strong>Ryan</strong>
                        <span>Posted on 29 May 2025</span>
                    </div>
                    <div class="review-stars">
                        ★★★★★
                    </div>
                    <p class="review-text">Easy to talk to and provided in-depth feedback on important areas to improve.
                    </p>
                </div>
            </div>
            <div class="reviews-footer">
                <a href="#" class="active">1</a>
                <a href="#">2</a>
                <a href="#">3</a>
                <a href="#">4</a>
                <a href="#">5</a>
                <a href="#">...</a>
                <a href="#">Next ›</a>
                <a href="#">Last »</a>
            </div>
        </div>
    </div>

    <div id="new-event-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 650px;">
            <div class="reviews-header" style="padding: 15px 25px;">
                <h3>New Event</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="new-event-body">
                <form id="new-event-form">
                    <div class="input-group">
                        <label for="event-name">Event name *</label>
                        <input type="text" id="event-name" required>
                    </div>
                    <div class="input-group">
                        <label for="event-address">Address</label>
                        <input type="text" id="event-address">
                    </div>
                    <div class="form-group">
                        <label>Start time *</label>
                        <div class="time-selector-grid">
                            <select>
                                <option>18</option>
                            </select>
                            <select>
                                <option>June</option>
                            </select>
                            <select>
                                <option>2025</option>
                            </select>
                            <span>-</span>
                            <select>
                                <option>17</option>
                            </select>
                            <span>:</span>
                            <select>
                                <option>00</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>End time *</label>
                        <div class="time-selector-grid">
                            <select>
                                <option>18</option>
                            </select>
                            <select>
                                <option>June</option>
                            </select>
                            <select>
                                <option>2025</option>
                            </select>
                            <span>-</span>
                            <select>
                                <option>18</option>
                            </select>
                            <span>:</span>
                            <select>
                                <option>00</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Please choose event type *</label>
                        <select required>
                            <option>Please select</option>
                            <option>An automatic transmission lesson</option>
                            <option>Personal event (Not a driving lesson)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <p class="form-note" style="margin: 0; line-height: 1.6;">Travel time of 45 mins will be added
                            before and after this event. Learners will be unable to book during this time. Would you
                            like to change the travel time for this event?</p>
                        <div class="radio-group" style="justify-content: flex-start; margin-top: 10px;">
                            <label><input type="radio" name="travel-time" value="yes"> Yes</label>
                            <label><input type="radio" name="travel-time" value="no" checked> No</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Notes</label>
                        <textarea rows="3"></textarea>
                    </div>
                    <div class="form-actions"
                        style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <button type="submit" class="btn btn-primary btn-full">Create Event</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="feedback-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li class="active"><a href="#" id="nav-feedback-feedback">Give Feedback</a></li>
                        <li><a href="#" id="nav-support-profile">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-feedback" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content rating-page-main">
                <div class="card rating-card" style="text-align: left;">
                    <form id="feedback-form">
                        <h2 style="text-align: center;">Give Feedback</h2>
                        <p class="rating-question" style="text-align: center;">What One Feature Or Improvement Would
                            Enhance Your Experience As A Driving Instructor On Safe Learners?</p>
                        <textarea name="feedback" placeholder="Answer Required" rows="5" required></textarea>
                        <button type="submit" class="btn btn-primary btn-full">Submit</button>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <div id="feedback-success-page" class="page">
        <div class="dashboard-layout">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="https://placehold.co/100x100/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <h3>SAFE LEARNERS</h3>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" data-nav="dashboard">Dashboard</a></li>
                        <li><a href="#" data-nav="wallet">Wallet</a></li>
                        <li><a href="#" data-nav="invite">Invite Friends</a></li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <ul>
                        <li><a href="#" id="feedback-btn">Give Feedback</a></li>
                        <li><a href="#" id="support-btn">Support</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <button id="logout-button-success" class="btn btn-secondary">Logout</button>
                </div>
            </aside>
            <main class="main-content rating-page-main">
                <div class="card rating-card">
                    <div class="feedback-success-content">
                        <img src="https://placehold.co/100x100?text=✓" alt="Success Icon" style="margin-bottom: 20px;">
                        <h2 style="text-align: center;">Feedback Submitted!</h2>
                        <p style="text-align: center;">Thanks For Sharing Your Ideas, Issues Or Appreciation. We Can't
                            Respond Individually, But We'll Pass It On To Those Who Are Working To Help Make Save
                            Learners Better For Everyone.</p>
                        <div style="margin-top: 20px;">
                            <a href="#" id="share-feedback-btn" class="btn btn-primary">Share Feedback</a>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- <div id="support-page" class="page">
    <div class="support-article-container">
        <header class="support-index-header">
            <div class="breadcrumbs">
                EzLicence Support &nbsp; > &nbsp; Driving Instructors &nbsp; > &nbsp; Getting Started With EzLicence
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Search">
                <i class="fas fa-search"></i>
            </div>
        </header>

        <div class="support-article-grid">
            <aside class="support-article-sidebar">
                <h3>Articles in this section</h3>
                <ul>
                    <li><a href="#">How EzLicence works</a></li>
                    <li><a href="#" class="active">Business Criteria</a></li>
                    <li><a href="#">Getting started</a></li>
                    <li><a href="#">How to use our support centre</a></li>
                    <li><a href="#">Private Learner Fact Sheet</a></li>
                    <li><a href="#">Payout Processing Fees Fact Sheet</a></li>
                    <li><a href="#">EzLicence Driving Instructor Policies</a></li>
                    <li><a href="#">Driving Instructor Cancellation Policy</a></li>
                    <li><a href="#">Driving Instructor Code of Conduct</a></li>
                </ul>
            </aside>

            <article class="support-article-content">
                <h1>Business Criteria</h1>
                <p class="meta">1 year ago - Updated</p>

                <h3>This will be useful if:</h3>
                <p>You are a <strong>Driving Instructor User</strong> of the EzLicence booking platform.</p>

                <h3>You are trying to:</h3>
                <p>You are wanting to understand the requirements to join.</p>

                <h3>Overview:</h3>
                <p>We can't wait to work with you! To speed up the onboarding process, make sure you have the following items readily available:</p>

                <h3>Accreditations</h3>
                <ul>
                    <li>Australian Driver's Licence</li>
                    <li>Driving Instructor's Licence</li>
                    <li>Working with Children Check or state equivalent</li>
                </ul>

                <h3>Vehicle</h3>
                <ul>
                    <li>Vehicle Registration</li>
                    <li>Vehicle Insurance (Comprehensive or Third Party Property)</li>
                    <li>5-star ANCAP safety rating</li>
                </ul>
            </article>
        </div>
    </div>
    <div class="floating-help-btn">? Help</div>
</div> -->

    <div id="instructor-feedback-page" class="page">
        <div class="feedback-container">
            <div class="feedback-content">
                <div class="logo">
                    <img src="https://placehold.co/40x40/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <span>Safe Learners</span>
                </div>
                <form id="instructor-feedback-form">
                    <h2>What one feature or improvement would enhance your experience as a driving instructor on Safe
                        Learners?</h2>
                    <p>Answer required</p>
                    <textarea class="input-group input" name="instructor_feedback"
                        placeholder="Type your answer here..." required></textarea>
                    <button type="submit" class="btn btn-submit-dark">Submit</button>
                </form>
            </div>
        </div>
    </div>
    <div id="instructor-feedback-success-page" class="page">
        <div class="feedback-container">
            <div class="feedback-content">
                <div class="logo">
                    <img src="https://placehold.co/40x40/FFC700/000000?text=SL" alt="Safe Learners Logo">
                    <span>Safe Learners</span>
                </div>
                <p class="success-text">
                    If you have a specific question or need help resolving a problem, you can visit our <a href="#">Help
                        Centre</a> or <a href="#">contact us</a> to connect with our support team. UK customers
                    requiring help, click <a href="#">here</a>.
                </p>
                <h2 style="font-weight: 600;">Thanks for sharing your ideas, issues or appreciation.</h2>
                <p class="success-text">We can't respond individually, but we'll pass it on to those who are working to
                    help make Safe Learners better for everyone.</p>
                <button id="instructor-share-feedback-btn" class="btn btn-submit-dark">Share Feedback</button>
            </div>
        </div>
    </div>
    <div id="support-index-page" class="page">
        <div class="support-index-container">
            <header class="support-index-header">
                <div class="breadcrumbs">
                    EzLicence Support &nbsp; > &nbsp; Driving Instructors
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="Search">
                    <i class="fas fa-search"></i>
                </div>
            </header>

            <main>
                <div class="support-index-title">
                    <h1>Driving Instructors</h1>
                    <p>Information & support for driving instructors</p>
                </div>

                <div class="support-category-grid">
                    <div class="support-category-column">
                        <h3>Getting Started With EzLicence</h3>
                        <ul>
                            <li><a href="#" class="support-article-link" data-article="how-it-works">How EzLicence
                                    works</a></li>
                            <li><a href="#" class="support-article-link" data-article="business-criteria">Business
                                    Criteria</a></li>
                            <li><a href="#" class="support-article-link" data-article="getting-started">Getting
                                    started</a></li>
                            <li><a href="#">See all 9 articles</a></li>
                        </ul>
                    </div>

                    <div class="support-category-column">
                        <h3>Manage Your Account</h3>
                        <ul>
                            <li><a href="#">How to navigate your instructor account</a></li>
                            <li><a href="#">See all 12 articles</a></li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <div id="support-page" class="page">
        <div class="support-article-container">
            <header class="support-index-header">
                <div id="article-breadcrumbs" class="breadcrumbs">
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="Search">
                    <i class="fas fa-search"></i>
                </div>
            </header>

            <div class="support-article-grid">
                <aside class="support-article-sidebar">
                    <h3>Articles in this section</h3>
                    <ul id="article-sidebar-links">
                    </ul>
                </aside>

                <article id="article-content-main" class="support-article-content">
                    <h1 id="article-title"></h1>
                    <p id="article-meta" class="meta"></p>
                    <div id="article-body">
                    </div>
                </article>
            </div>
        </div>
        <div class="floating-help-btn">? Help</div>
    </div>

    <div id="booking-notification-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 650px; padding: 25px;">
            <button class="modal-close-btn">&times;</button>
            <div id="booking-notification-modal-header">
                <h3>New Booking</h3>
                <p>Notification received at 16 Jun 2025, 1:48 PM</p>
            </div>
            <div class="card" style="margin-top: 20px;">
                <div class="modal-booking-details">
                    <div class="modal-booking-info">
                        <span class="lesson-tag">Auto Lesson - 1 hour</span>
                        <p><strong>Sat, 21 Jun 2025</strong> &nbsp; 2:30 PM - 3:30 PM</p>
                        <p class="learner-name-modal">Siddanth G. Ⓜ️</p>
                        <p class="location-modal"><i class="fas fa-map-marker-alt"></i> 8 George St, Seven Hills 2147
                            NSW</p>
                    </div>
                    <div class="modal-booking-actions">
                        <button class="btn btn-secondary btn-small">View booking</button>
                        <button class="btn btn-secondary btn-small">Learner details</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="propose-booking-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 550px;">
            <div class="reviews-header" style="padding: 15px 25px;">
                <h3 id="propose-modal-title">Propose Booking - [Learner Name]</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="new-event-body">

                <div class="warning-box" style="margin-bottom: 20px;">
                    <p style="margin: 0;" id="propose-modal-warning">Booking(s) will be on hold for [Learner Name] until
                        confirmed.</p>
                </div>

                <form id="propose-booking-form">
                    <div class="input-group">
                        <select id="propose-booking-type-select">
                            <option value="lesson">Driving Lesson</option>
                            <option value="test">Driving Test Package</option>
                        </select>
                    </div>

                    <div id="propose-lesson-fields">
                        <div class="form-group">
                            <label>Lesson duration</label>
                            <div style="display: flex; gap: 20px; margin-top: 5px;">
                                <label style="font-weight: 500;"><input type="radio" name="lesson-duration" value="1"
                                        checked> 1 hour</label>
                                <label style="font-weight: 500;"><input type="radio" name="lesson-duration" value="2"> 2
                                    hours</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Available dates</label>
                            <input type="text" id="propose-lesson-date" readonly style="background-color: #f1f1f1;">
                        </div>
                        <div class="form-group">
                            <label>Available times</label>
                            <input type="text" id="propose-lesson-time" readonly style="background-color: #f1f1f1;">
                        </div>
                    </div>

                    <div id="propose-test-fields" style="display: none;">
                        <div class="form-group">
                            <label for="propose-test-location">Which local roads authority have you booked your test
                                at?</label>
                            <select id="propose-test-location">
                                <option value="">Select your test location</option>
                                <option value="Castle Hill">Castle Hill</option>
                                <option value="Blacktown">Blacktown</option>
                                <option value="Rockdale">Rockdale</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>What time does your test start?</label>
                            <div class="form-group-inline">
                                <input type="text" id="propose-test-date" readonly style="background-color: #f1f1f1;">
                                <select id="propose-test-time">
                                    <option>Select start time</option>
                                    <option value="8:00 AM">8:00 AM</option>
                                    <option value="9:00 AM">9:00 AM</option>
                                    <option value="10:00 AM">10:00 AM</option>
                                    <option value="11:00 AM">11:00 AM</option>
                                    <option value="1:00 PM">1:00 PM</option>
                                    <option value="2:00 PM">2:00 PM</option>
                                </select>
                            </div>
                        </div>
                        <p class="form-note">* Your pickup time will be 1 hour prior to the test start time.</p>
                    </div>

                    <div class="form-group">
                        <label>Lesson pickup location</label>
                        <div class="location-field">
                            <span id="propose-pickup-location">2 Green Rd, Castle Hill NSW 2154</span>
                            <button type="button" class="edit-btn"><i class="fas fa-pencil-alt"></i> Edit</button>
                        </div>
                    </div>

                    <div class="form-actions"
                        style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                        <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Continue</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script>


    <script>
        // PASTE YOUR FIREBASE CONFIG OBJECT HERE
        const firebaseConfig = {
            apiKey: "AIzaSyB-8AmUdYHW6-UVc0ax09K9nuxI4x11iRs",
            authDomain: "australiadrivingproj.firebaseapp.com",
            projectId: "australiadrivingproj",
            storageBucket: "australiadrivingproj.firebasestorage.app",
            messagingSenderId: "906653434498",
            appId: "1:906653434498:web:6f382d3c20113e0966ea9b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();


        let map; // Make map a global variable

        // This function is called by the Google Maps script tag once it's loaded
        // REPLACE your old initMap function with this
        function initMap() {
            const mapContainer = document.getElementById('service-area-map');
            if (!mapContainer || typeof google === 'undefined') return;

            // Create the map object here, one time only.
            const defaultCenter = { lat: -33.8688, lng: 151.2093 };
            map = new google.maps.Map(mapContainer, { center: defaultCenter, zoom: 10 });

            // Now, load the data and populate the map.
            loadServiceAreaAndAvailability();
        }

        // --- GLOBAL STATE & NAVIGATION ---
        const pages = document.querySelectorAll('.page');
        let lastDashboardView = 'dashboard-main-content';
        const allSidebars = document.querySelectorAll('.sidebar-nav');
        let currentInstructorId = null; // Store the ID of the selected instructor
        let instructorIdToReview = null;
        let instructorNameToReview = null;
        // Add this with your other global variables like 'currentInstructorId'
        let currentInstructorAvailability = {};
        // --- START: ADD THESE GLOBAL VARIABLES ---
        // This object will hold the learner's info when proposing a booking
        let proposalContext = {
            learnerId: null,
            learnerName: null,
            status: 'inactive' // Can be 'inactive' or 'active'
        };
        // --- END: ADDED GLOBAL VARIABLES ---
        // Add this with your other global variables
        let currentCalendarDate = moment();
        // --- ADD THIS GLOBAL VARIABLE ---
        let currentInstructorPricing = { lesson: 70, testPackage: 225 }; // Default fallback values
        let currentUserLocation = "5 Hogan PL, Quakers Hill NSW 2763"; // Placeholder for the current user's location


        function showPage(pageId) {
            pages.forEach(page => page.classList.toggle('active', page.id === pageId));
        }

        function showView(viewId) {
            // This selector now correctly finds content sections in BOTH dashboards
            document.querySelectorAll('#dashboard-page .content-view, #instructor-dashboard-page .instructor-view').forEach(view => {
                view.classList.remove('active');
            });

            const viewToShow = document.getElementById(viewId);
            if (viewToShow) {
                viewToShow.classList.add('active');
                lastDashboardView = viewId;
            }
        }

        function updateSidebarActiveState(target) {
            allSidebars.forEach(sidebar => {
                sidebar.querySelectorAll('li').forEach(li => li.classList.remove('active'));
                const activeLink = sidebar.querySelector(`[data-nav="${target}"]`);
                if (activeLink) activeLink.parentElement.classList.add('active');
            });
        }

        function goToDashboard() { showPage('dashboard-page'); showView(lastDashboardView); updateSidebarActiveState('dashboard'); }
        function goToWallet() { showPage('wallet-page'); updateSidebarActiveState('wallet'); }
        function goToInvite() { showPage('invite-page'); updateSidebarActiveState('invite'); }

        // --- MAIN CLICK CONTROLLER FOR ALL NAVIGATION ---
        // --- MAIN CLICK CONTROLLER FOR ALL NAVIGATION ---
        document.addEventListener('click', (e) => {
            const target = e.target.closest('a, button');
            if (!target) return;

            // 1) Generic sidebar top-level nav
            if (target.matches('[data-nav]')) {
                e.preventDefault();
                const navTarget = target.dataset.nav;
                if (navTarget === 'dashboard') { goToDashboard(); }
                if (navTarget === 'wallet') { goToWallet(); }
                if (navTarget === 'invite') { goToInvite(); }
                return;
            }

            // 2) Wallet / Booking / Profile routes (existing)
            // 2) Wallet / Booking / Profile routes (existing)
            if (target.matches('#add-credit-btn, #add-credit-from-wallet-btn')) { e.preventDefault(); goToWallet(); return; }

            // Updated logic for opening booking page from anywhere
            if (target.matches('.open-booking-btn')) {
                e.preventDefault();
                const card = target.closest('.instructor-card-new');
                if (card && card.dataset.id) {
                    currentInstructorId = card.dataset.id;
                } else {
                    // Handle the case where the button is on the main dashboard and not a specific instructor card
                    // We assume there's a primary instructor set for the learner
                    currentInstructorId = document.getElementById('dashboard-main-content').querySelector('.open-booking-btn').dataset.instructorId;
                }
                showPage('booking-page');
                // Now render the instructor's data on the booking page
                renderBookingPageInstructor(currentInstructorId);
                return;
            }

            // Handles the 'View Profile' button on the instructor list
            if (target.matches('.view-profile-btn')) {
                e.preventDefault();
                const card = target.closest('.instructor-card-new');
                if (card && card.dataset.id) {
                    const instructorId = card.dataset.id;
                    displayInstructorProfile(instructorId);
                } else {
                    console.error("Could not find instructor ID for this profile.");
                }
                return;
            }

            // Handles the 'Check Availability' link on the instructor list
            if (target.matches('.availability-link')) {
                e.preventDefault();
                const instructorId = target.dataset.id;
                // In a real app, you would fetch and display this instructor's availability
                console.log(`Opening availability modal for instructor ID: ${instructorId}`);
                openModal();
                return;
            }

            if (target.matches('#switch-instructor-link')) {
                e.preventDefault();
                showView('switch-instructor-content');
                renderInstructors();
                return;
            }
            // Back from instructor profile to dashboard
            // Back from instructor lists/profile to dashboard
            if (target.matches('#back-to-instructors-btn, #back-to-dashboard-btn')) {
                e.preventDefault();
                showPage('dashboard-page');                // go back to the dashboard page
                showView(lastDashboardView || 'dashboard-main-content'); // restore previous dashboard view
                updateSidebarActiveState('dashboard');     // highlight Dashboard in sidebar
                return;
            }
            // Back from instructor lists/profile to dashboard
            if (target.matches('#back-to-dashboards-btn')) {
                e.preventDefault();
                showPage('dashboard-page');                // go back to the dashboard page
                showView('dashboard-main-content'); // restore previous dashboard view
                updateSidebarActiveState('dashboard');     // highlight Dashboard in sidebar
                return;
            }



            if (target.matches('#history-content .booking-id-link')) { e.preventDefault(); showPage('booking-details-page'); return; }
            if (target.matches('#leave-rating-link')) {
                e.preventDefault();
                // Get data stored on the link by renderLearnerDashboard
                instructorIdToReview = target.dataset.instructorId;
                instructorNameToReview = target.dataset.instructorName;
                if (instructorIdToReview) {
                    showPage('rating-page');
                    // Update the rating page question dynamically
                    const ratingQuestion = document.querySelector('#rating-page .rating-question');
                    if (ratingQuestion) {
                        ratingQuestion.textContent = `How was your learning experience with ${instructorNameToReview || 'your instructor'}?`;
                    }
                    // Optional: Hide the notification popup after clicking
                    const notificationPopup = document.querySelector('.notification-popup');
                    if (notificationPopup) notificationPopup.style.display = 'none';
                } else {
                    alert('Could not determine which instructor to review.');
                }
                return; // Added return
            }

            // 3) NEW: Feedback routes (all places it appears)
            if (target.matches(
                '#nav-feedback-main,' +        // dashboard sidebar
                '#feedback-btn,' +             // success page sidebar
                '#nav-feedback-feedback,' +    // feedback page sidebar (self)
                '#nav-feedback-support,' +     // support page sidebar
                '#share-feedback-btn'          // "Share Feedback" button on success page
            )) {
                e.preventDefault();
                showPage('feedback-page');
                return;
            }

            // 4) NEW: Support routes (all places it appears)
            if (target.matches(
                '#nav-support-main,' +         // dashboard sidebar
                '#support-btn,' +              // success page sidebar
                '#nav-support-support,' +      // support page sidebar (self)
                '#nav-support-profile,' +      // feedback page sidebar
                '#support-back-to-home'        // breadcrumb link on support header
            )) {
                e.preventDefault();
                showPage('support-page');
                return;
            }

            // 5) Logout (your buttons use ids, not .logout-btn)
            if (target.matches('#logout-button, #logout-button-feedback, #logout-button-support, #logout-button-success')) {
                e.preventDefault();
                auth.signOut();
                return;
            }
        });

        // --- FEEDBACK FORM: go to success page on submit ---
        const feedbackForm = document.getElementById('feedback-form');
        if (feedbackForm) {
            feedbackForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // TODO: save to Firestore if you want; for now just route to success UI
                showPage('feedback-success-page');
            });
        }

        // --- LOGIC FOR BOOKING TABS ---
        // --- Replacement for the booking section tab click listener ---
        const bookingSection = document.querySelector('.booking-section');
        if (bookingSection) {
            bookingSection.addEventListener('click', (e) => {
                const clickedTab = e.target.closest('.tab-link');
                if (!clickedTab) return;
                const targetId = clickedTab.dataset.target;

                bookingSection.querySelectorAll('.tabs .tab-link').forEach(link => link.classList.toggle('active', link === clickedTab));
                bookingSection.querySelectorAll('.tab-pane').forEach(pane => pane.classList.toggle('active', pane.id === targetId));

                // **THE NEW LOGIC IS HERE**: Check if the "Upcoming" tab was clicked
                if (targetId === 'upcoming-content') {
                    const currentUser = auth.currentUser;
                    if (currentUser) {
                        // Refresh the bookings list
                        renderLearnerUpcomingBookings(currentUser.uid);
                    }
                }
            });
        }

        // --- AUTHENTICATION & USER DATA ---
        // --- AUTHENTICATION & ROLE-BASED ROUTING ---
        // --- Replacement for the auth.onAuthStateChanged function ---
        // --- REPLACE your existing auth.onAuthStateChanged function with this ---
        auth.onAuthStateChanged(user => {
            if (user) {
                // *** NEW: SUPER ADMIN CHECK ***
                if (user.email === 'aditya@gmail.com') {
                    showPage('super-admin-page');
                    renderSuperAdminDashboard();
                    // Function to load pending instructors
                    // --- START: ADD FOR SUPER ADMIN NAVIGATION ---
                    // --- START: Replace existing adminSidebar listener with this ---
                    const adminSidebar = document.querySelector('#super-admin-page .sidebar-nav');
                    const verificationView = document.getElementById('pending-instructors-list').closest('.main-content');
                    const controlsView = document.getElementById('super-admin-controls-view');
                    const pastBookingsView = document.getElementById('super-admin-past-bookings-view'); // Get reference to new view

                    if (adminSidebar && verificationView && controlsView && pastBookingsView) { // Check if all views exist
                        adminSidebar.addEventListener('click', (e) => {
                            const link = e.target.closest('a');
                            if (!link) return;
                            e.preventDefault();

                            // Update active link in sidebar
                            adminSidebar.querySelectorAll('li').forEach(li => li.classList.remove('active'));
                            link.parentElement.classList.add('active');

                            // Hide all main content views first
                            verificationView.style.display = 'none';
                            controlsView.style.display = 'none';
                            pastBookingsView.style.display = 'none';

                            const targetView = link.dataset.view;

                            // Show the selected view and load its data
                            // Show the selected view and load its data
                            if (targetView === 'super-admin-controls') {
                                controlsView.style.display = 'block';
                                renderControlsView();
                            } else if (targetView === 'super-admin-past-bookings') { // Handle new view
                                pastBookingsView.style.display = 'block';
                                renderAdminBookingsView(); // <<< CHANGE THIS FUNCTION CALL
                            } else { // Default to verifications
                                verificationView.style.display = 'block';
                                renderSuperAdminDashboard();
                            }
                        });
                    } else {
                        console.error("Super Admin sidebar or one of its main content views not found!");
                    }
                    // --- END: Replacement adminSidebar listener ---      // --- END: ADD FOR SUPER ADMIN NAVIGATION ---
                    return; // Stop further execution for the admin
                }

                // --- Existing logic for instructors and learners ---
                // --- Existing logic for instructors and learners ---
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();

                        // --- ADD THIS CHECK TO BLOCK DISABLED USERS ---
                        if (userData.accountStatus === 'disabled') {
                            alert("Your account has been disabled by an administrator.");
                            auth.signOut(); // Immediately log them out
                            return;         // Stop the rest of the function
                        }
                        // --- END OF CHECK ---
                        const displayName = userData.firstName || user.email.split('@')[0];

                        if (userData.role === 'instructor') {
                            document.getElementById('instructor-user-name').textContent = displayName;
                            showPage('instructor-dashboard-page');
                            renderInstructorDashboardView(user.uid); // Use the helper function
                        } else {
                            document.querySelectorAll('[id^="user-name"]').forEach(el => el.textContent = displayName);
                            document.getElementById('welcome-message').textContent = `Welcome back, ${displayName}!`;
                            renderLearnerDashboard(user.uid);
                            renderLearnerUpcomingBookings(user.uid);
                            showPage('dashboard-page');
                            showView('dashboard-main-content');
                        }
                    } else {
                        showPage('login-page');
                    }
                }).catch(error => {
                    console.error("Error fetching user data:", error);
                    showPage('login-page');
                });
            } else {
                showPage('landing-page');
            }
        });

        // Also, make the new "Find an Instructor" button work
        document.addEventListener('click', (e) => {
            if (e.target.matches('#find-instructor-btn')) {
                e.preventDefault();
                showView('switch-instructor-content');
            }
        });

        function fetchUserData(user) {
            db.collection('users').doc(user.uid).get().then(doc => {
                const displayName = (doc.exists && doc.data().firstName) ? doc.data().firstName : user.email.split('@')[0];
                document.querySelectorAll('[id^="user-name"]').forEach(el => el.textContent = displayName);
                if (document.getElementById('welcome-message')) {
                    document.getElementById('welcome-message').textContent = `Welcome back, ${displayName}!`;
                }
            }).catch(error => console.error("Error fetching user data:", error));
        }

        // --- LOGIN & SIGNUP FORMS ---
        const loginForm = document.getElementById('login-form');
        if (loginForm) {
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const [email, password] = [loginForm.email.value, loginForm.password.value];
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = ''; // Clear previous errors

                auth.signInWithEmailAndPassword(email, password)
                    .catch(err => {
                        console.error("Login Error:", err.code); // Keep this for debugging

                        // Check for common authentication error codes and show a friendly message
                        switch (err.code) {
                            case 'auth/user-not-found':
                            case 'auth/wrong-password':
                            case 'auth/invalid-credential':
                                errorMessage.textContent = 'Invalid email or password. Please try again.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage.textContent = 'Please enter a valid email address.';
                                break;
                            default:
                                errorMessage.textContent = 'Invalid email or password. Please try again.';
                                break;
                        }
                    });
            });
        }
        const signupForm = document.getElementById('signup-form');
        if (signupForm) {
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // Get all values from the form fields
                const firstName = signupForm.firstName.value;
                const surname = signupForm.surname.value;
                const email = signupForm.email.value;
                const password = signupForm.password.value;
                const mobile = signupForm.mobile.value;
                const dob = signupForm.dob.value; // Date is in "YYYY-MM-DD" format
                const gender = signupForm.gender.value;

                const signupErrorMessage = document.getElementById('signup-error-message');
                signupErrorMessage.textContent = '';

                auth.createUserWithEmailAndPassword(email, password)
                    .then(cred => {
                        // **THE FIX IS HERE**: Save all collected data to the new user's document
                        return db.collection('users').doc(cred.user.uid).set({
                            firstName: firstName,
                            surname: surname,
                            email: email,
                            role: 'learner',
                            mobile: mobile, // Saves the mobile number
                            dob: dob,       // Saves the date of birth
                            gender: gender
                        });
                    })
                    .catch(err => signupErrorMessage.textContent = err.message);
            });

            // This part remains the same
            document.getElementById('go-to-login').addEventListener('click', (e) => {
                e.preventDefault();
                setupLoginPage('learner');
            });
        }


        // --- AVAILABILITY MODAL ---
        const availabilityModal = document.getElementById('availability-modal');
        const checkAvailabilityBtn = document.getElementById('check-availability-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        let calendarInstance = null;
        function openModal() {
            if (availabilityModal) availabilityModal.classList.add('active');
            if (!calendarInstance) {
                // Flatpickr library is needed for this to work
                if (typeof flatpickr !== 'undefined') {
                    calendarInstance = flatpickr("#calendar-container", { inline: true, mode: "multiple" });
                }
            }
        }
        function closeModal() { if (availabilityModal) availabilityModal.classList.remove('active'); }
        document.body.addEventListener('click', function (e) {
            if (e.target.id === 'check-availability-btn') {
                e.preventDefault();
                const instructorId = e.target.dataset.id;
                if (instructorId) {
                    showAvailabilityForInstructor(instructorId);
                } else {
                    alert("Could not find instructor ID.");
                }
            }
            document.getElementById('start-verification-btn')?.addEventListener('click', async (e) => {
                e.preventDefault();
                const user = auth.currentUser;
                if (!user) {
                    alert("Authentication error. Please log in again.");
                    return;
                }

                // --- THIS IS THE FIX ---
                // Before starting, reset all 'skipped' flags in the database.
                // This tells the app the user wants to re-attempt verification from the start.
                try {
                    await db.collection('users').doc(user.uid).update({
                        dlSkipped: false,
                        ilSkipped: false,
                        wwcSkipped: false,
                        vrSkipped: false
                    });

                    // Now that the flags are reset, the original function will work perfectly.
                    showVerificationPage();

                } catch (error) {
                    console.error("Error resetting verification status:", error);
                    alert("Could not start verification. Please try again.");
                }
            });
        });
        if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        if (availabilityModal) availabilityModal.addEventListener('click', (e) => { if (e.target === availabilityModal) closeModal(); });

        // --- RATING FORM LOGIC ---
        const ratingForm = document.getElementById('rating-form');
        if (ratingForm) {
            ratingForm.addEventListener('submit', async (e) => { // Make the handler async
                e.preventDefault();
                const formData = new FormData(ratingForm);
                const rating = parseInt(formData.get('rating')); // Ensure it's a number
                const feedbackText = formData.get('feedback').trim(); // Trim whitespace

                if (!rating || rating < 1 || rating > 5) {
                    alert('Please select a rating from 1 to 5.');
                    return;
                }
                if (!instructorIdToReview) {
                    alert('Error: Could not determine which instructor to review. Please go back to the dashboard.');
                    return;
                }
                const learner = auth.currentUser;
                if (!learner) {
                    alert('Error: You must be logged in to submit a review.');
                    return;
                }

                // Show loading state (optional)
                const submitButton = ratingForm.querySelector('button[type="submit"]');
                submitButton.textContent = 'Submitting...';
                submitButton.disabled = true;

                try {
                    // Fetch learner's name
                    const learnerDoc = await db.collection('users').doc(learner.uid).get();
                    const learnerName = learnerDoc.exists ? learnerDoc.data().firstName : 'Learner';

                    // Prepare review data
                    const reviewData = {
                        learnerId: learner.uid,
                        learnerName: learnerName,
                        instructorId: instructorIdToReview,
                        instructorName: instructorNameToReview || 'Instructor', // Use name stored earlier
                        rating: rating,
                        feedbackText: feedbackText, // Store even if empty, can filter later
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        // bookingId: null // You could add logic to link this to a specific booking if needed
                    };

                    // Save to Firestore
                    await db.collection('reviews').add(reviewData);

                    alert('Thank you for your feedback!');
                    ratingForm.reset();
                    instructorIdToReview = null; // Clear the state
                    instructorNameToReview = null;
                    goToDashboard(); // Navigate back

                } catch (error) {
                    console.error("Error submitting review:", error);
                    alert('Sorry, there was an error submitting your review. Please try again.');
                } finally {
                    // Restore button state
                    submitButton.textContent = 'Submit';
                    submitButton.disabled = false;
                }
            });
        }
        // --- INVITE PAGE "COPY LINK" BUTTON ---
        const copyLinkBtn = document.getElementById('copy-link-btn');
        if (copyLinkBtn) {
            copyLinkBtn.addEventListener('click', () => {
                const linkInput = document.getElementById('referral-link-input');
                navigator.clipboard.writeText(linkInput.value).then(() => {
                    copyLinkBtn.innerHTML = 'Copied!';
                    setTimeout(() => {
                        copyLinkBtn.innerHTML = '<i class="far fa-copy"></i> Copy Link';
                    }, 2000);
                });
            });
        }

        // --- INSTRUCTOR SIGNUP FORM ---
        // --- REPLACE WITH THIS CODE BLOCK ---
        const instructorSignupForm = document.getElementById('instructor-signup-form');
        if (instructorSignupForm) {
            instructorSignupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const firstName = instructorSignupForm.querySelector('[name="firstName"]').value;
                const surname = instructorSignupForm.querySelector('[name="surname"]').value;
                const email = instructorSignupForm.querySelector('[name="email"]').value;
                const password = instructorSignupForm.querySelector('[name="password"]').value;
                const signupErrorMessage = document.getElementById('instructor-signup-error-message');
                signupErrorMessage.textContent = '';

                auth.createUserWithEmailAndPassword(email, password)
                    .then(cred => {
                        // Set user data in Firestore with role 'instructor'
                        return db.collection('users').doc(cred.user.uid).set({
                            firstName: firstName,
                            surname: surname,
                            email: email,
                            role: 'instructor',
                            // *** CHANGE 1: Add the initial verification status ***
                            verificationStatus: 'not_submitted'
                        });
                    })

                    .catch(err => {
                        signupErrorMessage.textContent = err.message;
                    });
            });
        }

        // --- DYNAMIC LOGIN PAGE SETUP ---
        const loginTitle = document.getElementById('login-title');
        const loginSignupLink = document.getElementById('go-to-signup');

        function setupLoginPage(role) {
            if (role === 'instructor') {
                loginTitle.innerHTML = 'Instructor <span class="text-primary">Login</span>';
                loginSignupLink.textContent = "Signup as an Instructor";
                loginSignupLink.onclick = (e) => { e.preventDefault(); showPage('instructor-signup-page'); };
            } else {
                loginTitle.innerHTML = 'Learner <span class="text-primary">Login</span>';
                loginSignupLink.textContent = "Signup Now";
                loginSignupLink.onclick = (e) => { e.preventDefault(); showPage('signup-page'); };
            }
            showPage('login-page');
        }

        // --- EVENT LISTENERS FOR LANDING PAGE BUTTONS ---
        document.getElementById('learner-login-btn-1').addEventListener('click', () => setupLoginPage('learner'));
        document.getElementById('learner-login-btn-2').addEventListener('click', () => setupLoginPage('learner'));
        document.getElementById('instructor-login-btn-1').addEventListener('click', () => setupLoginPage('instructor'));
        document.getElementById('instructor-login-btn-2').addEventListener('click', () => setupLoginPage('instructor'));

        // --- GENERIC LOGOUT ---
        document.body.addEventListener('click', (e) => {

            // --- START: REPLACE THE DELETED BLOCK WITH THIS ---
            // --- START: DELETE THIS ENTIRE BLOCK ---
            const instructorNavLink = e.target.closest('#instructor-dashboard-page a[data-view]');
            if (instructorNavLink) {

                e.preventDefault(); // Stop the link from trying to navigate

                const targetViewId = instructorNavLink.dataset.view; // Get the target view ID

                // Update the active state in the sidebar
                const sidebar = instructorNavLink.closest('.sidebar-nav');
                if (sidebar) { // Check if the link is in the main sidebar
                    sidebar.querySelectorAll('li').forEach(li => li.classList.remove('active'));
                    instructorNavLink.closest('li').classList.add('active');
                }

                if (targetViewId === 'instructor-service-area-view') {
                    loadServiceAreaAndAvailability();
                }


                // Call the function to show the correct view
                showInstructorView(targetViewId);

                // --- START: ADDED LOGIC ---
                // If the view is Personal Details, load the user's data
                if (targetViewId === 'instructor-personal-details-view') {
                    loadPersonalDetails();
                }
                // --- END: ADDED LOGIC ---

                // If the view being opened is the calendar, render the events.
                if (targetViewId === 'instructor-calendar-view') {
                    if (auth.currentUser) {
                        renderInstructorCalendar(auth.currentUser.uid);
                        updateCalendarView(currentCalendarDate);
                    }
                }
                // This tells the app to fetch learners when the "Learners" tab is clicked
                if (targetViewId === 'instructor-learners-view') {
                    if (auth.currentUser) {
                        renderInstructorLearners(auth.currentUser.uid);
                    }
                }
            }
            // --- END: DELETE THIS BLOCK ---
            // --- END: REPLACEMENT BLOCK ---

            if (e.target.closest('#cancel-booking-link')) {
                e.preventDefault();
                const detailsView = document.getElementById('instructor-booking-details-view');
                const bookingId = detailsView.dataset.bookingId;
                if (bookingId) {
                    cancelBooking(bookingId);
                } else {
                    alert('Error: Could not find booking ID.');
                }
            }
            // Handle the "Reschedule Booking" link click
            if (e.target.closest('#reschedule-booking-link')) {
                e.preventDefault();
                const detailsView = document.getElementById('instructor-booking-details-view');
                const bookingId = detailsView.dataset.bookingId;
                if (bookingId) {
                    renderReschedulePage(bookingId); // Call the new function
                } else {
                    alert('Error: Could not find booking ID to reschedule.');
                }
            }

            // Add a listener for the new "Discard Changes" button
            if (e.target.closest('#discard-reschedule-btn')) {
                e.preventDefault();
                const detailsView = document.getElementById('instructor-booking-details-view');
                // Go back to the booking details view
                showInstructorView('instructor-booking-details-view');
            }
            // --- START: Added for Learner Details View ---
            if (e.target.closest('.view-learner-details-btn')) {
                e.preventDefault();
                const learnerRow = e.target.closest('.learners-list-row');
                if (learnerRow && learnerRow.dataset.learnerId) {
                    const learnerId = learnerRow.dataset.learnerId;
                    renderLearnerDetailsPage(learnerId); // Call the new function with the specific ID
                }
            }
            if (e.target.closest('#upcoming-booking-content [data-booking-id]')) {
                e.preventDefault();
                const button = e.target.closest('[data-booking-id]');
                const bookingId = button.dataset.bookingId;
                renderInstructorBookingDetails(bookingId); // Call our new function
            }

            if (e.target.closest('.instructor-back-to-learners-btn')) {
                e.preventDefault();
                document.querySelectorAll('#instructor-dashboard-page .instructor-view').forEach(view => view.classList.remove('active'));
                const learnersView = document.getElementById('instructor-learners-view');
                if (learnersView) learnersView.classList.add('active');
            }
            // --- END: Added for Learner Details View ---


            if (e.target.matches('.logout-btn, .instructor-logout-btn, #logout-button, #logout-button-wallet, #logout-button-booking, #logout-button-details, #logout-button-profile, #logout-button-invite, #logout-button-feedback, #logout-button-success, #logout-button-support')) {
                auth.signOut();
            }


        });


        // --- END: ADDED FOR INVITE FRIENDS PAGE ---
        // --- START: ADDED FOR INSTRUCTOR DASHBOARD NAVIGATION ---
        const instructorDashboardPage = document.getElementById('instructor-dashboard-page');
        if (instructorDashboardPage) {
            const instructorSidebar = instructorDashboardPage.querySelector('.sidebar');

            instructorDashboardPage.addEventListener('click', (e) => {
                const link = e.target.closest('a[data-view], button[data-view]');
                if (!link) return;

                e.preventDefault();
                const targetViewId = link.dataset.view;

                // Update active class on main nav items only
                const mainNav = instructorSidebar.querySelector('.sidebar-nav');
                mainNav.querySelectorAll('li').forEach(li => li.classList.remove('active'));
                if (link.closest('li')) {
                    link.closest('li').classList.add('active');
                }

                // Show the correct content view
                instructorDashboardPage.querySelectorAll('.instructor-view').forEach(view => {
                    view.classList.toggle('active', view.id === targetViewId);
                });
            });
            // ... (rest of the code for tabs, etc.)

            // Also handle the tabs on the learners page
            const learnersView = document.getElementById('instructor-learners-view');
            if (learnersView) {
                const learnerTabs = learnersView.querySelector('.tabs');
                learnerTabs.addEventListener('click', (e) => {
                    const clickedTab = e.target.closest('.tab-link');
                    if (!clickedTab) return;

                    const targetPaneId = clickedTab.dataset.target;
                    learnerTabs.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
                    clickedTab.classList.add('active');

                    learnersView.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.style.display = pane.id === targetPaneId ? 'block' : 'none';
                        // also add active class for potential future styling
                        pane.classList.toggle('active', pane.id === targetPaneId);
                    });
                });
            }
        }
        // --- END: ADDED FOR INSTRUCTOR DASHBOARD NAVIGATION ---
        // --- START: ADDED FOR INSTRUCTOR BOOKING DETAILS PAGE ---


        // This handles the navigation FROM the new booking details page
        const navDashboardIBD = document.getElementById('nav-dashboard-ibd');
        const navWalletIBD = document.getElementById('nav-wallet-ibd');
        const logoutButtonIBD = document.getElementById('logout-button-ibd');

        if (navDashboardIBD) navDashboardIBD.addEventListener('click', goToDashboard);
        if (navWalletIBD) navWalletIBD.addEventListener('click', goToWallet);
        if (logoutButtonIBD) logoutButtonIBD.addEventListener('click', () => auth.signOut());

        // --- END: ADDED FOR INSTRUCTOR BOOKING DETAILS PAGE ---

        // --- START: INVITE LEARNER MODAL LOGIC ---
        const inviteLearnerModal = document.getElementById('invite-learner-modal');
        if (inviteLearnerModal) {
            const inviteLearnerBtns = document.querySelectorAll('.invite-learner-btn');
            const closeInviteModalBtn = inviteLearnerModal.querySelector('.modal-close-btn');

            const openInviteModal = (e) => {
                e.preventDefault();
                inviteLearnerModal.classList.add('active');
            };
            const closeInviteModal = () => {
                inviteLearnerModal.classList.remove('active');
            };

            inviteLearnerBtns.forEach(btn => btn.addEventListener('click', openInviteModal));

            if (closeInviteModalBtn) {
                closeInviteModalBtn.addEventListener('click', closeInviteModal);
            }

            inviteLearnerModal.addEventListener('click', (e) => {
                if (e.target === inviteLearnerModal) {
                    closeInviteModal();
                }
            });

            const inviteForm = document.getElementById('invite-learner-form');
            if (inviteForm) {
                inviteForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // In a real application, you would send the form data to a server here.
                    alert('SMS Invite Sent!');
                    closeInviteModal();
                    inviteForm.reset();
                });
            }
        }
        // --- END: INVITE LEARNER MODAL LOGIC ---

        // --- START: PROPOSE BOOKING PAGE NAVIGATION ---
        // --- START: REPLACE THIS ENTIRE CLICK LISTENER BLOCK ---
        document.addEventListener('click', function (e) {
            // Handle "Propose Booking" button on the learner details page
            if (e.target.closest('#instructor-learner-details-view .propose-booking-btn')) {
                e.preventDefault();
                const detailsView = e.target.closest('#instructor-learner-details-view');
                // We need to get the learner's ID, which we'll store on the view when we render it.
                const learnerId = detailsView.dataset.learnerId;
                const learnerName = detailsView.querySelector('.learner-info h3').innerText.split(' Age')[0]; // Get name

                if (learnerId && learnerName) {
                    // Set the global context
                    proposalContext = { learnerId, learnerName, status: 'active' };

                    // Navigate to the calendar
                    showInstructorView('instructor-calendar-view');

                    // Give the instructor a hint
                    alert(`Proposal mode activated for ${learnerName}. Please click an empty time slot on the calendar to create a booking.`);
                } else {
                    alert('Error: Could not identify the learner.');
                }
            }

            // Handle "Learner Details" link on the main learner list
            if (e.target.closest('.view-learner-details-btn')) {
                e.preventDefault();
                const learnerRow = e.target.closest('.learners-list-row');
                if (learnerRow && learnerRow.dataset.learnerId) {
                    const learnerId = learnerRow.dataset.learnerId;
                    renderLearnerDetailsPage(learnerId);
                }
            }
        });
        // --- END: REPLACEMENT BLOCK ---

        // --- START: INSTRUCTOR FEEDBACK FLOW ---
        // --- START: INSTRUCTOR FEEDBACK FLOW (Reversed Logic as Requested) ---
        document.addEventListener('click', (e) => {
            // 1. When "Give Feedback" is clicked in the sidebar, show the SUCCESS page first.
            if (e.target.matches('#instructor-nav-feedback')) {
                e.preventDefault();
                showPage('instructor-feedback-success-page');
            }


            // --- ADD THIS NEW BLOCK ---
            // When "Support" is clicked in the sidebar, show the new support index page
            if (e.target.matches('#instructor-nav-support')) {
                e.preventDefault();
                showPage('support-index-page');
            }
            // --- END OF NEW BLOCK ---

            // --- ADD THIS NEW BLOCK ---
            // When an article link is clicked on the support index page
            if (e.target.matches('.support-article-link')) {
                e.preventDefault();
                showPage('support-page'); // This is the ID of the article page
            }
            // --- END OF NEW BLOCK ---
            // 2. When "Share Feedback" is clicked on the success page, show the FORM page.
            if (e.target.matches('#instructor-share-feedback-btn')) {
                e.preventDefault();
                showPage('instructor-feedback-page');
            }

            // This part handles clicking "Dashboard" etc. from the feedback pages
            if (e.target.closest('#instructor-feedback-page a[data-view], #instructor-feedback-success-page a[data-view]')) {
                e.preventDefault();
                showPage('instructor-dashboard-page');
            }
        });

        const instructorFeedbackForm = document.getElementById('instructor-feedback-form');
        if (instructorFeedbackForm) {
            instructorFeedbackForm.addEventListener('submit', (e) => {
                e.preventDefault(); // Prevent the page from reloading

                // 1. Show the alert message with the "OK" button
                alert('Thank you for your feedback');

                // 2. Go back to the main instructor dashboard
                showPage('instructor-dashboard-page');

                // 3. Reset the form for the next time it's opened
                instructorFeedbackForm.reset();
            });
        }
        // --- END: INSTRUCTOR FEEDBACK FLOW ---
        // --- END: INSTRUCTOR FEEDBACK FLOW ---
        // --- END: PROPOSE BOOKING PAGE NAVIGATION ---
        // --- START: CONTACT MODAL LOGIC ---
        const contactModal = document.getElementById('contact-modal');
        if (contactModal) {
            const openContactModalBtn = document.getElementById('instructor-nav-contact');
            const closeContactModalBtn = contactModal.querySelector('.modal-close-btn');

            const openContactModal = (e) => {
                e.preventDefault();
                contactModal.classList.add('active');
            };
            const closeContactModal = () => {
                contactModal.classList.remove('active');
            };

            if (openContactModalBtn) {
                openContactModalBtn.addEventListener('click', openContactModal);
            }
            if (closeContactModalBtn) {
                closeContactModalBtn.addEventListener('click', closeContactModal);
            }
            contactModal.addEventListener('click', (e) => {
                if (e.target === contactModal) {
                    closeContactModal();
                }
            });
        }
        // --- END: CONTACT MODAL LOGIC ---
        // --- START: REVIEWS MODAL LOGIC ---
        const reviewsModal = document.getElementById('reviews-modal');
        if (reviewsModal) {
            const openReviewsModalBtn = document.getElementById('open-reviews-modal');
            const closeReviewsModalBtn = reviewsModal.querySelector('.modal-close-btn');

            openReviewsModalBtn?.addEventListener('click', (e) => {
                e.preventDefault();
                reviewsModal.classList.add('active');
            });

            closeReviewsModalBtn?.addEventListener('click', () => {
                reviewsModal.classList.remove('active');
            });

            reviewsModal.addEventListener('click', (e) => {
                if (e.target === reviewsModal) {
                    reviewsModal.classList.remove('active');
                }
            });
        }
        // --- END: REVIEWS MODAL LOGIC ---
        // --- START: CALENDAR CLICK FIX ---
        // --- START: EDIT PRICING LOGIC ---
        // --- START: EDIT PRICING LOGIC (Corrected) ---
        const pricingPage = document.getElementById('instructor-pricing-view');
        let priceElementToUpdate = null; // Variable to remember which price to update

        if (pricingPage) {
            pricingPage.addEventListener('click', (e) => {
                const editButton = e.target.closest('.pricing-value .btn');
                if (editButton) {
                    e.preventDefault();
                    // Remember the specific price span (e.g., $75.00) that corresponds to the clicked edit button
                    priceElementToUpdate = editButton.parentElement.querySelector('span');
                    showView('instructor-edit-price-view');
                }
            });
        }

        // --- START: REPLACEMENT FOR PRICING SAVE LOGIC ---
        const savePriceBtn = document.getElementById('save-price-changes-btn');
        if (savePriceBtn) {
            savePriceBtn.addEventListener('click', async (e) => {
                e.preventDefault();

                if (!auth.currentUser) {
                    alert("Authentication error. Please log in again.");
                    return;
                }

                const uid = auth.currentUser.uid;
                const newPrice = parseFloat(document.getElementById('hourly-lesson-price').value);

                if (isNaN(newPrice) || newPrice <= 0) {
                    alert("Please enter a valid price.");
                    return;
                }

                try {
                    // Update the pricing object in the instructor's user document
                    await db.collection('users').doc(uid).set({
                        pricing: {
                            lesson: newPrice,
                            // Assuming a test package is 3x the hourly rate for this example
                            testPackage: newPrice * 3
                        }
                    }, { merge: true }); // Use merge: true to avoid overwriting other user data

                    // --- The rest of this is the same as before ---
                    if (priceElementToUpdate) {
                        priceElementToUpdate.textContent = `$${newPrice.toFixed(2)}`;
                    }
                    showView('instructor-pricing-view');
                    const successMsg = document.getElementById('price-update-success-msg');
                    if (successMsg) {
                        successMsg.style.display = 'flex';
                        setTimeout(() => { successMsg.style.display = 'none'; }, 5000);
                        successMsg.querySelector('.close-btn').onclick = () => { successMsg.style.display = 'none'; };
                    }

                } catch (error) {
                    console.error("Error saving price: ", error);
                    alert("Could not save the new price. Please try again.");
                }
            });
        }
        // --- END: REPLACEMENT FOR PRICING SAVE LOGIC ---
        // --- END: EDIT PRICING LOGIC ---
        // --- START: CREATE EVENT DROPDOWN LOGIC ---
        const createEventBtn = document.getElementById('create-event-btn');
        const createEventDropdown = document.getElementById('create-event-dropdown');

        if (createEventBtn && createEventDropdown) {
            createEventBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevents the window click listener from immediately closing it
                createEventDropdown.classList.toggle('active');
            });

            // Close the dropdown if the user clicks anywhere else
            window.addEventListener('click', (e) => {
                if (!createEventBtn.contains(e.target) && !createEventDropdown.contains(e.target)) {
                    createEventDropdown.classList.remove('active');
                }
            });
        }
        // --- END: CREATE EVENT DROPDOWN LOGIC ---

        // --- START: NEW EVENT MODAL LOGIC ---
        const newEventModal = document.getElementById('new-event-modal');
        if (newEventModal) {
            // Find the "Other Event" link in the dropdown
            const openNewEventBtn = document.querySelector('#create-event-dropdown a:last-child');
            const closeNewEventBtn = newEventModal.querySelector('.modal-close-btn');

            openNewEventBtn?.addEventListener('click', (e) => {
                e.preventDefault();
                newEventModal.classList.add('active');
                document.getElementById('create-event-dropdown').classList.remove('active'); // Close the small dropdown
            });

            closeNewEventBtn?.addEventListener('click', () => {
                newEventModal.classList.remove('active');
            });

            newEventModal.addEventListener('click', (e) => {
                if (e.target === newEventModal) {
                    newEventModal.classList.remove('active');
                }
            });

            // Handle form submission
            document.getElementById('new-event-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Event Created!'); // Placeholder for actual logic
                newEventModal.classList.remove('active');
            });
        }
        // --- END: NEW EVENT MODAL LOGIC ---

        // --- START: CALENDAR EVENT & BOOKING DETAILS LOGIC ---
        const instructorCalendar = document.getElementById('instructor-calendar-view');
        if (instructorCalendar) {
            // 1. Listen for clicks on any calendar event block
            instructorCalendar.addEventListener('click', (e) => {
                const eventElement = e.target.closest('.calendar-event'); // Find the event element
                if (eventElement) {
                    e.preventDefault();
                    const bookingId = eventElement.dataset.bookingId; // Get the ID from the element
                    if (bookingId) {
                        // Call the function that renders the details, passing the correct ID
                        renderInstructorBookingDetails(bookingId);
                    } else {
                        console.error("Calendar event is missing a booking ID.");
                    }
                }
            });
        }

        const bookingDetailsPage = document.getElementById('instructor-booking-details-view');
        if (bookingDetailsPage) {
            // 2. Handle the "Modify Booking" dropdown
            const modifyBtn = document.getElementById('modify-booking-btn');
            const modifyDropdown = document.getElementById('modify-booking-dropdown');

            modifyBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                modifyDropdown.classList.toggle('active');
            });

            // Close dropdown if clicking anywhere else on the window
            window.addEventListener('click', (e) => {
                if (modifyBtn && !modifyBtn.contains(e.target) && !modifyDropdown.contains(e.target)) {
                    modifyDropdown.classList.remove('active');
                }
            });
        }
        // --- END: CALENDAR EVENT & BOOKING DETAILS LOGIC ---

        // --- START: OFFER BANNER TOGGLE LOGIC ---
        const offerBannerHeader = document.getElementById('offer-banner-header');
        if (offerBannerHeader) {
            offerBannerHeader.addEventListener('click', () => {
                const promotionDetails = document.getElementById('promotion-details');
                const arrow = offerBannerHeader.querySelector('.banner-arrow');

                promotionDetails.classList.toggle('expanded');
                arrow.classList.toggle('rotated');
            });
        }
        // --- END: OFFER BANNER TOGGLE LOGIC ---

        // --- START: CORRECTED AND COMPLETE REPORTS PAGE LOGIC ---
        const reportsPage = document.getElementById('instructor-reports-view');
        if (reportsPage) {
            const reportTabs = reportsPage.querySelector('.reports-header .tabs');

            // Get all content sections for the tabs
            const summaryContents = reportsPage.querySelectorAll('.summary-content');
            const financialYearContent = document.getElementById('financial-year-content');
            const fy2324Content = document.getElementById('fy-23-24-content');

            // Get all elements needed for the payout accordion
            const payoutToggle = reportsPage.querySelector('.next-payout-item');
            const payoutDetails = document.getElementById('payout-details-content');
            const pendingPayoutCard = reportsPage.querySelector('.pending-payout-card');
            const triggerPayoutLink = document.getElementById('trigger-payout-details');
            const financialYearTab = reportTabs.querySelector('button:nth-child(2)');

            // 1. LOGIC FOR SWITCHING TABS
            reportTabs.addEventListener('click', (e) => {
                const clickedTab = e.target.closest('.tab-link');
                if (!clickedTab) return;

                // Update active tab style
                reportTabs.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
                clickedTab.classList.add('active');

                // Hide all content panes first
                summaryContents.forEach(el => el.style.display = 'none');
                if (financialYearContent) financialYearContent.style.display = 'none';
                if (fy2324Content) fy2324Content.style.display = 'none';

                // Show the correct content pane based on the tab clicked
                if (clickedTab.textContent.includes('Summary')) {
                    summaryContents.forEach(el => {
                        el.style.display = el.classList.contains('stats-grid') ? 'grid' : 'block';
                    });
                } else if (clickedTab.textContent.includes('This Financial Year')) {
                    if (financialYearContent) financialYearContent.style.display = 'block';
                } else if (clickedTab.textContent.includes('FY 2023/24')) {
                    if (fy2324Content) fy2324Content.style.display = 'block';
                }
            });

            // 2. LOGIC FOR THE PAYOUT ACCORDION on the "Financial Year" tab
            if (payoutToggle && payoutDetails && pendingPayoutCard) {
                payoutToggle.addEventListener('click', () => {
                    [payoutDetails, payoutToggle, pendingPayoutCard].forEach(el => el.classList.toggle('expanded'));
                });
            }

            // 3. LOGIC FOR THE TRIGGER LINK ON THE SUMMARY PAGE
            if (triggerPayoutLink && financialYearTab) {
                triggerPayoutLink.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Activate the "This Financial Year" tab
                    financialYearTab.click();

                    // Expand the accordion if it's not already open
                    if (payoutDetails && !payoutDetails.classList.contains('expanded')) {
                        [payoutDetails, payoutToggle, pendingPayoutCard].forEach(el => el.classList.add('expanded'));
                    }
                });
            }
        }
        // --- END: CORRECTED AND COMPLETE REPORTS PAGE LOGIC ---
        // --- END: REPORTS PAGE TABS LOGIC ---
        // --- START: TRANSACTION REPORT LOGIC ---
        document.getElementById('instructor-reports-view')?.addEventListener('click', (e) => {
            // Check if a "Transaction Report" link was clicked
            if (e.target.matches('.report-links a') && e.target.textContent.includes('Transaction Report')) {
                e.preventDefault();
                // In a real app, you would load the specific report data here.
                // For now, we just show the transaction report view.
                const allViews = document.querySelectorAll('#instructor-dashboard-page .instructor-view');
                allViews.forEach(view => view.classList.remove('active'));
                document.getElementById('instructor-transaction-report-view')?.classList.add('active');
            }
        });

        // PDF Download Logic
        const downloadPdfBtn = document.getElementById('download-pdf-btn');
        if (downloadPdfBtn) {
            downloadPdfBtn.addEventListener('click', () => {
                const reportContent = document.getElementById('report-content');
                const options = {
                    margin: 10,
                    filename: 'transaction-report-5102348.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                // Use html2pdf library to generate and save the PDF
                html2pdf().from(reportContent).set(options).save();
            });
        }

        async function renderInstructors() {
            const instructorGrid = document.querySelector('#switch-instructor-content .instructor-grid');
            if (!instructorGrid) {
                console.error('Instructor grid container not found!');
                return;
            }

            instructorGrid.innerHTML = '<p>Loading instructors...</p>';

            try {
                const querySnapshot = await db.collection('users').where('role', '==', 'instructor').get();

                if (querySnapshot.empty) {
                    instructorGrid.innerHTML = '<p>No instructors are available at the moment.</p>';
                    return;
                }

                instructorGrid.innerHTML = '';

                querySnapshot.forEach(doc => {
                    const instructor = doc.data();
                    const instructorId = doc.id;

                    // Use the uploaded photos, or fall back to a placeholder
                    const instructorPhoto = instructor.instructorPhotoUrl || "https://t4.ftcdn.net/jpg/00/88/53/89/360_F_88538986_5Bi4eJ667pocsO3BIlbN4fHKz8yUFSuA.jpg";
                    const vehiclePhoto = instructor.vehiclePhotoUrl || "https://placehold.co/100x100?text=Car";

                    const instructorCardHTML = `
                <div class="instructor-card-new" data-id="${instructorId}">
                    <div class="instructor-photo-new">
                        <img src="${instructorPhoto}" alt="Instructor ${instructor.firstName}">
                    </div>
                    <div class="instructor-details-new">
                        <h4>${instructor.firstName || 'Instructor'}</h4>
                        <p class="instructor-meta price">$${(instructor.pricing?.lesson || 70).toFixed(2)} / hr</p>

                        <p class="instructor-meta"><i class="fas fa-star"></i> New Instructor</p> 
                        <p class="instructor-meta"><i class="fas fa-check-circle"></i> Verified Instructor</p>
                        <a href="#" class="availability-link" data-id="${instructorId}"><strong>Check Availability ></strong></a>
                    </div>
                    <div class="instructor-actions-new">
                        <div class="vehicle-info-display" style="display: flex; gap: 10px; align-items: center;">
                            <img src="${vehiclePhoto}" style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover;">
                            <div>
                                <p style="font-size: 14px; font-weight: 600; margin: 0;">${instructor.vehicleMake || 'Vehicle'} ${instructor.vehicleModel || ''}</p>
                                <p style="font-size: 12px; color: var(--gray-color); margin: 0;">${instructor.transmission || 'Auto'}</p>
                            </div>
                        </div>
                        <div class="buttons-row" style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px; width: 100%;">
                            <button class="btn btn-secondary btn-full view-profile-btn">View Profile</button>
                            <button class="btn btn-primary btn-full open-booking-btn">Book Online Now</button>
                        </div>
                    </div>
                </div>
            `;
                    instructorGrid.insertAdjacentHTML('beforeend', instructorCardHTML);
                });

            } catch (error) {
                console.error("Error fetching instructors: ", error);
                instructorGrid.innerHTML = '<p>Sorry, there was an error loading instructors. Please try again later.</p>';
            }
        }

        // Add these new functions and listeners inside your main <script> tag

        // --- START: INSTRUCTOR PROFILE EDIT LOGIC ---

        // Function to load existing data into the form
        async function loadInstructorProfileData() {
            if (!auth.currentUser) return;
            const uid = auth.currentUser.uid;
            const profileForm = document.getElementById('instructor-profile-form');

            try {
                const docRef = db.collection('users').doc(uid);
                const doc = await docRef.get();

                if (doc.exists) {
                    const data = doc.data();
                    // Populate form fields with data from Firestore, using '' as a fallback
                    profileForm.querySelector('#instructor-bio').value = data.bio || '';
                    profileForm.querySelector('#languages-spoken').value = data.languages || '';
                    profileForm.querySelector('#instructor-start-year').value = data.startYear || '2024';
                    profileForm.querySelector('#instructor-transmission').value = data.transmission || 'Auto';
                    profileForm.querySelector('#vehicle-make').value = data.vehicleMake || '';
                    profileForm.querySelector('#vehicle-model').value = data.vehicleModel || '';
                    profileForm.querySelector('#vehicle-ancap').value = data.ancap || '5 Star';
                    profileForm.querySelector('#vehicle-dual-controls').value = data.dualControls || 'Yes';
                } else {
                    console.log("No profile document found for instructor!");
                }
            } catch (error) {
                console.error("Error loading instructor profile: ", error);
            }
        }

        // Event listener for the "My Profile" link in the dropdown
        document.addEventListener('click', (e) => {
            if (e.target.closest('#edit-profile-link')) {
                e.preventDefault();
                // Hide all other instructor views
                document.querySelectorAll('#instructor-dashboard-page .instructor-view').forEach(view => {
                    view.classList.remove('active');
                });
                // Show the profile edit view
                const profileView = document.getElementById('instructor-profile-edit-view');
                if (profileView) {
                    profileView.classList.add('active');
                    loadInstructorProfileData(); // Load data when the page is shown
                }
            }
        });


        const storage = firebase.storage();

        // Function to handle the file upload and save profile data
        async function saveInstructorProfile(e) {
            e.preventDefault();
            if (!auth.currentUser) {
                alert("You must be logged in to save your profile.");
                return;
            }
            const uid = auth.currentUser.uid;
            const profileForm = document.getElementById('instructor-profile-form');

            const instructorPhotoFile = profileForm.querySelector('#instructor-photo').files[0];
            const vehiclePhotoFile = profileForm.querySelector('#vehicle-photo').files[0];

            // Start with a base data object
            const profileData = {
                bio: profileForm.querySelector('#instructor-bio').value,
                languages: profileForm.querySelector('#languages-spoken').value,
                startYear: profileForm.querySelector('#instructor-start-year').value,
                transmission: profileForm.querySelector('#instructor-transmission').value,
                vehicleMake: profileForm.querySelector('#vehicle-make').value,
                vehicleModel: profileForm.querySelector('#vehicle-model').value,
                ancap: profileForm.querySelector('#vehicle-ancap').value,
                dualControls: profileForm.querySelector('#vehicle-dual-controls').value,
            };

            try {
                // Handle instructor photo upload if a file is selected
                if (instructorPhotoFile) {
                    const instructorPhotoRef = storage.ref(`instructor-photos/${uid}/${instructorPhotoFile.name}`);
                    await instructorPhotoRef.put(instructorPhotoFile);
                    profileData.instructorPhotoUrl = await instructorPhotoRef.getDownloadURL();
                }

                // Handle vehicle photo upload if a file is selected
                if (vehiclePhotoFile) {
                    const vehiclePhotoRef = storage.ref(`vehicle-photos/${uid}/${vehiclePhotoFile.name}`);
                    await vehiclePhotoRef.put(vehiclePhotoFile);
                    profileData.vehiclePhotoUrl = await vehiclePhotoRef.getDownloadURL();
                }

                // Update the document in Firestore with the data and new photo URLs
                await db.collection('users').doc(uid).update(profileData);
                alert("Profile updated successfully! ✅");
            } catch (error) {
                console.error("Error updating profile: ", error);
                alert("There was an error saving your profile. Please try again.");
            }
        }

        // Event listener to SAVE the form data
        const instructorProfileForm = document.getElementById('instructor-profile-form');
        if (instructorProfileForm) {
            instructorProfileForm.addEventListener('submit', saveInstructorProfile);
        }

        // --- START: DYNAMIC LEARNER-FACING PROFILE PAGE ---
        // Find and replace your existing displayInstructorProfile function with this corrected version

        async function displayInstructorProfile(instructorId) {
            const page = document.getElementById('instructor-profile-page');
            if (!page) return;

            try {
                const doc = await db.collection('users').doc(instructorId).get();
                if (!doc.exists) {
                    console.error("Instructor not found!");
                    return;
                }

                const data = doc.data();

                // --- START OF THE FIX ---
                // Store the instructor's ID on the check availability button
                const checkAvailabilityBtn = page.querySelector('#check-availability-btn');
                if (checkAvailabilityBtn) {
                    checkAvailabilityBtn.dataset.id = instructorId;
                }
                // --- END OF THE FIX ---


                // (The rest of your existing function code for populating the profile page remains here...)
                const instructorPhoto = data.instructorPhotoUrl || "https://media.istockphoto.com/id/509481682/photo/close-up-portrait-of-arabic-nice-man.jpg?s=612x612&w=0&k=20&c=5wx2Qf0J3oXzTiSBRTR3Xjm6ANzLOMhPOboOZZnU6fw=";
                const vehiclePhoto = data.vehiclePhotoUrl || "https://stimg.cardekho.com/images/carexteriorimages/930x620/Toyota/Urban-Cruiser/12237/1735368926257/front-left-side-47.jpg";

                page.querySelector('.profile-photo').src = instructorPhoto;
                page.querySelector('.profile-car-photo').src = vehiclePhoto;
                page.querySelector('.profile-header-info h2').textContent = data.firstName || 'Instructor';
                page.querySelector('.profile-section p').textContent = data.bio || 'Bio not provided.';
                page.querySelector('.language-tag').textContent = data.languages || 'English';

                const checkmarkList = page.querySelector('.checkmark-list');
                checkmarkList.innerHTML = `
            <li><i class="fas fa-check"></i> ${data.transmission || 'Auto'} Lessons & Test Packages</li>
            <li><i class="fas fa-check"></i> Verified Working with Children Check</li>
            <li><i class="fas fa-check"></i> Driving Instructor's Licence</li>
            <li><i class="fas fa-check"></i> Instructing since ${data.startYear || '2024'}</li>
        `;

                showPage('instructor-profile-page');

            } catch (error) {
                console.error("Error fetching instructor details: ", error);
            }
        }
        // --- END: DYNAMIC LEARNER-FACING PROFILE PAGE ---
        // --- END: INSTRUCTOR PROFILE EDIT LOGIC ---
        // --- END: TRANSACTION REPORT LOGIC ---
        // --- DYNAMICALLY POPULATE BOOKING PAGE WITH INSTRUCTOR DATA ---
        // --- DYNAMICALLY POPULATE BOOKING PAGE WITH INSTRUCTOR DATA ---
        async function renderBookingPageInstructor(instructorId) {
            const bookingPage = document.getElementById('booking-page');
            if (!bookingPage) return;

            const instructorInfoCard = bookingPage.querySelector('.instructor-details');
            const pickupLocationSelect = document.getElementById('pickup-location-select');

            // Clear previous data
            instructorInfoCard.querySelector('.instructor-info h5').textContent = 'Loading...';
            pickupLocationSelect.innerHTML = '<option value="">Loading locations...</option>';

            if (!instructorId) {
                // This part remains the same, handling default instructor logic
                try {
                    const learnerDoc = await db.collection('users').doc(auth.currentUser.uid).get();
                    instructorId = learnerDoc.data().instructorId;
                    if (!instructorId) {
                        alert('Please select an instructor first.');
                        showView('switch-instructor-content');
                        return;
                    }
                } catch (error) {
                    console.error("Could not fetch default instructor ID.", error);
                    return;
                }
            }

            try {
                const doc = await db.collection('users').doc(instructorId).get();
                if (doc.exists) {
                    const instructor = doc.data();
                    currentInstructorAvailability = instructor.operatingHours || {};


                    // --- START: NEW LOGIC ---
                    const suburbs = instructor.servicedSuburbs || [];
                    pickupLocationSelect.innerHTML = '<option value="">Select a pickup location...</option>'; // Reset

                    if (suburbs.length > 0) {
                        suburbs.forEach(suburb => {
                            const option = document.createElement('option');
                            option.value = suburb;
                            option.textContent = suburb;
                            pickupLocationSelect.appendChild(option);
                        });
                    } else {
                        pickupLocationSelect.innerHTML = '<option value="">Instructor has not set service areas.</option>';
                    }
                    // --- END: NEW LOGIC ---

                    // The rest of the function remains mostly the same
                    const instructorPhoto = instructor.instructorPhotoUrl || "https://placehold.co/100x100?text=I";
                    currentInstructorPricing = instructor.pricing || { lesson: 70, testPackage: 225 };

                    instructorInfoCard.querySelector('.instructor-info img').src = instructorPhoto;
                    instructorInfoCard.querySelector('.instructor-info h5').textContent = instructor.firstName || 'Instructor';

                    updateOrderSummary();
                    populateAvailableDates();
                } else {
                    console.error('Instructor not found in Firestore.');
                }
            } catch (error) {
                console.error('Error rendering booking page instructor:', error);
            }
        }


        // --- NEW BOOKING PAGE LOGIC ---


        // --- FUNCTION TO HANDLE BOOKING CONFIRMATION AND SAVE TO FIRESTORE ---
        async function confirmBooking(bookingData) {
            if (!auth.currentUser) {
                alert("You must be logged in to confirm a booking.");
                return;
            }

            const learnerId = auth.currentUser.uid;
            const instructorId = bookingData.instructorId;

            try {
                await db.runTransaction(async (transaction) => {
                    const bookingRef = db.collection('bookings').doc(); // Create a new document reference
                    const learnerRef = db.collection('users').doc(learnerId);
                    const instructorRef = db.collection('users').doc(instructorId);

                    // Fetch the documents to ensure they exist before writing
                    const learnerDoc = await transaction.get(learnerRef);
                    const instructorDoc = await transaction.get(instructorRef);

                    if (!learnerDoc.exists || !instructorDoc.exists) {
                        throw "User or Instructor not found!";
                    }

                    // Create the new booking document with the booking data
                    const newBooking = {
                        ...bookingData,
                        learnerId: learnerId,
                        instructorId: instructorId,
                        status: 'CONFIRMED', // Set initial status
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        learnerName: learnerDoc.data().firstName,
                        instructorName: instructorDoc.data().firstName
                    };

                    transaction.set(bookingRef, newBooking);
                });

                alert("Booking confirmed successfully!");
                // Redirect to a success page or the dashboard
                showView('dashboard-main-content');

            } catch (error) {
                console.error("Transaction failed: ", error);
                alert("Booking failed. Please try again.");
            }
        }

        // --- FETCH AND RENDER UPCOMING BOOKINGS FOR INSTRUCTOR DASHBOARD ---
        function renderUpcomingBookings(uid) {
            const container = document.getElementById('upcoming-booking-content');
            if (!container) return;
            container.innerHTML = '<p>Loading upcoming bookings...</p>';

            db.collection('bookings').where('instructorId', '==', uid).where('status', '==', 'CONFIRMED')
                .onSnapshot(querySnapshot => {
                    const today = moment().startOf('day'); // Get the start of today's date

                    // ✅ **THE FIX IS HERE:** Filter the documents before displaying them
                    const upcomingDocs = querySnapshot.docs.filter(doc => {
                        const booking = doc.data();
                        if (!booking.date) return false; // Skip bookings with no date
                        const bookingDate = moment(booking.date, 'ddd, D MMM YYYY');
                        // Keep the booking only if its date is on or after today
                        return bookingDate.isSameOrAfter(today);
                    });

                    if (upcomingDocs.length === 0) {
                        container.innerHTML = '<p>You have no upcoming bookings.</p>';
                        return;
                    }

                    // Now, map only the filtered (upcoming) documents to HTML
                    container.innerHTML = upcomingDocs.map(doc => {
                        const booking = doc.data();
                        const bookingId = doc.id;
                        return `
                <div class="card">
                    <div class="booking-item">
                        <div class="booking-item-main">
                            <div class="booking-item-section">
                                <p>Booking Details</p>
                                <span><i class="fas fa-calendar-alt"></i> ${moment(booking.date, 'ddd, D MMM YYYY').format('ddd, D MMM YYYY')}</span><br>
                                <span><i class="fas fa-clock"></i> ${booking.startTime} - ${booking.endTime}</span>
                            </div>
                            <div class="booking-item-section">
                                <p>Learner Details</p>
                                <div class="learner-details">
                                    <img src="https://placehold.co/100x100?text=${booking.learnerName ? booking.learnerName.charAt(0) : 'L'}" alt="Learner">
                                    <h5>${booking.learnerName || 'Learner'}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="booking-item-actions">
                            <a href="#" class="btn btn-secondary btn-small" data-booking-id="${bookingId}">See more / Manage</a>
                        </div>
                    </div>
                    <div class="booking-item-location">
                        <span><i class="fas fa-map-marker-alt"></i> ${booking.pickupLocation}</span>
                    </div>
                </div>`;
                    }).join('');

                }, error => {
                    console.error("Error fetching upcoming bookings:", error);
                    container.innerHTML = '<p style="color:red;">Could not load bookings.</p>';
                });
        }

        // --- BOOKING PAGE LOGIC ---
        const bookingPage = document.getElementById('booking-page');
        if (bookingPage) {
            const bookingForm = document.getElementById('booking-form');
            const bookingTypeTabs = document.getElementById('booking-type-tabs');
            const testLocationGroup = document.getElementById('test-location-group');
            const testWarning = document.getElementById('test-package-warning');
            const pickupTimeNote = document.getElementById('pickup-time-note');
            const dateDropdown = document.getElementById('available-dates');
            const timeDropdown = document.getElementById('available-times');
            const confirmBookingBtn = document.getElementById('confirm-booking-btn');
            const sidebarContinueBtn = document.getElementById('sidebar-continue-btn');
            const summaryLessonType = document.getElementById('summary-lesson-type');
            const summaryDateTime = document.getElementById('summary-date-time');
            const summaryPrice = document.getElementById('summary-price');
            const summaryTotalPrice = document.getElementById('summary-total-price');
            const pickupDisplay = document.getElementById('pickup-location-display');
            const dropoffDisplay = document.getElementById('dropoff-location-display');

            let currentLessonType = '1-hour'; // Default to 1-hour lesson
            const prices = {
                '1-hour': 70,
                '2-hour': 140,
                'test-package': 225
            };

            // Helper function to update the order summary
            // --- FIND AND REPLACE this function ---
            function updateOrderSummary() {
                const selectedDate = dateDropdown.value;
                const selectedTime = timeDropdown.value;

                // Use the dynamic pricing object
                const dynamicPrices = {
                    '1-hour': currentInstructorPricing.lesson,
                    '2-hour': currentInstructorPricing.lesson * 2,
                    'test-package': currentInstructorPricing.testPackage
                };
                const price = dynamicPrices[currentLessonType];

                summaryLessonType.textContent = currentLessonType.replace('-', ' ') + (currentLessonType === 'test-package' ? '' : ' lesson');
                summaryDateTime.textContent = (selectedDate && selectedTime) ? `${selectedDate} at ${selectedTime}` : '-';
                summaryPrice.textContent = price ? `$${price.toFixed(2)}` : '-';
                summaryTotalPrice.textContent = price ? `$${price.toFixed(2)}` : '$0.00';
            }

            // A function to check if the form is valid and enable the buttons
            function validateForm() {
                const isFormValid = dateDropdown.value !== '' && timeDropdown.value !== '';
                confirmBookingBtn.disabled = !isFormValid;
                confirmBookingBtn.classList.toggle('btn-disabled', !isFormValid);
                sidebarContinueBtn.disabled = !isFormValid;
                sidebarContinueBtn.classList.toggle('btn-disabled', !isFormValid);
            }

            // Event listeners for the booking form dropdowns
            dateDropdown.addEventListener('change', () => {
                // When the date changes, populate the times for that date
                populateAvailableTimesForDate(dateDropdown.value);
                updateOrderSummary();
                validateForm();
            });

            timeDropdown.addEventListener('change', () => {
                updateOrderSummary();
                validateForm();
            });

            // Event listener for the booking type tabs
            bookingTypeTabs.addEventListener('click', (e) => {
                const clickedTab = e.target.closest('.tab-link');
                if (!clickedTab) return;

                bookingTypeTabs.querySelectorAll('.tab-link').forEach(link => link.classList.remove('active'));
                clickedTab.classList.add('active');

                // --- THIS IS THE KEY CHANGE ---
                // When the lesson type changes (e.g., from 1hr to 2hr), we must
                // re-calculate the available time slots.
                populateAvailableTimesForDate(dateDropdown.value);

                // (The rest of the tab logic remains the same)
                currentLessonType = clickedTab.dataset.lessonType;
                const isTestPackage = currentLessonType === 'test-package';
                testLocationGroup.style.display = isTestPackage ? 'block' : 'none';
                testWarning.style.display = isTestPackage ? 'block' : 'none';
                pickupTimeNote.style.display = isTestPackage ? 'block' : 'none';

                updateOrderSummary();
                validateForm();
            });

            // Function to populate the available dates dropdown
            function populateAvailableDates() {
                const now = moment();
                dateDropdown.innerHTML = `<option value="">Select a day</option>`;
                for (let i = 0; i < 7; i++) {
                    const date = now.clone().add(i, 'days');
                    const formattedDate = date.format('ddd, D MMM YYYY');
                    dateDropdown.innerHTML += `<option value="${formattedDate}">${formattedDate}</option>`;
                }
            }

            // Initial population when the page loads
            populateAvailableDates();
            pickupDisplay.textContent = currentUserLocation;
            dropoffDisplay.textContent = currentUserLocation;


            // Event listener for the booking form submission
            bookingForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Collect all form data
                const bookingData = {
                    instructorId: currentInstructorId,
                    lessonType: currentLessonType,
                    transmission: 'Auto', // You may want to fetch this from the instructor data
                    date: dateDropdown.value,
                    startTime: timeDropdown.value,
                    pickupLocation: pickupDisplay.textContent,
                    dropoffLocation: dropoffDisplay.textContent,
                    price: prices[currentLessonType]
                };

                // Call the confirmBooking function to save to Firestore
                confirmBooking(bookingData);
            });

        }

        // --- START: NEW FUNCTION FOR INSTRUCTOR BOOKING DETAILS ---
        // --- START: REPLACEMENT for renderInstructorBookingDetails function ---
        async function renderInstructorBookingDetails(bookingId) {
            const detailsView = document.getElementById('instructor-booking-details-view');
            if (detailsView) detailsView.dataset.bookingId = bookingId;

            if (!detailsView) {
                console.error("Instructor booking details view not found!");
                return;
            }

            try {
                // Fetch the specific booking document
                const bookingRef = db.collection('bookings').doc(bookingId);
                const doc = await bookingRef.get();

                if (!doc.exists) {
                    console.error('Booking document not found:', bookingId);
                    return;
                }

                const booking = doc.data();

                // --- DATA POPULATION ---

                // Update main header and breadcrumbs
                detailsView.querySelector('h2').textContent = `Booking #${bookingId.substring(0, 7)}`;
                detailsView.querySelector('.breadcrumbs').innerHTML = `<a href="#" class="back-link" data-view="instructor-dashboard-view">Upcoming Bookings</a> > Booking #${bookingId.substring(0, 7)}`;

                // Update the green confirmation banner
                const banner = detailsView.querySelector('.booking-confirmation-banner span');
                if (banner) banner.textContent = `This booking has been confirmed by ${booking.learnerName}.`;

                // Update the main booking details card
                detailsView.querySelector('.booking-main-details h4').innerHTML = `Booking #${bookingId.substring(0, 7)} <span class="status-badge status-confirmed">${booking.status || 'CONFIRMED'}</span>`;
                const infoGrid = detailsView.querySelector('.booking-info-grid');
                infoGrid.querySelector('.booking-info-item:nth-child(1)').innerHTML = `<i class="fas fa-calendar-alt"></i> ${moment(booking.date, 'ddd, D MMM YYYY').format('ddd, D MMM YYYY')}`;
                infoGrid.querySelector('.booking-info-item:nth-child(2)').innerHTML = `<i class="fas fa-clock"></i> ${booking.startTime} - ${booking.endTime || 'N/A'}`;
                infoGrid.querySelector('.booking-info-item:nth-child(3)').innerHTML = `<i class="fas fa-car"></i> ${booking.lessonType} (${booking.transmission})`;
                infoGrid.querySelector('.booking-info-item:nth-child(4)').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${booking.pickupLocation}`;

                // Update the learner details card
                const learnerDetailsCard = detailsView.querySelector('.booking-learner-details');
                learnerDetailsCard.querySelector('img').src = `https://placehold.co/100x100?text=${booking.learnerName.charAt(0)}`;
                learnerDetailsCard.querySelector('strong').textContent = booking.learnerName;
                // You can fetch the learner's phone from their user doc if needed, or leave it blank
                // learnerDetailsCard.querySelector('a').textContent = '04XX XXX XXX'; 

                // Update the payment card
                // [inside async function renderInstructorBookingDetails(bookingId)]

                // --- START: REPLACEMENT BLOCK ---
                const paymentCard = detailsView.querySelector('#payment-details-card');
                if (paymentCard) {
                    // 1. Fetch the instructor's data to get their pricing
                    const instructorDoc = await db.collection('users').doc(booking.instructorId).get();
                    if (instructorDoc.exists) {
                        const instructor = instructorDoc.data();
                        // Use instructor's pricing, or fall back to defaults if not set
                        const pricing = instructor.pricing || { lesson: 70, testPackage: 225 };

                        // 2. Determine the gross price based on the booking type
                        let grossPrice = 0;
                        const lessonType = booking.lessonType || '';
                        if (lessonType.toLowerCase().includes('test')) {
                            grossPrice = pricing.testPackage;
                        } else if (lessonType.includes('2')) { // Assumes "2 hour"
                            grossPrice = pricing.lesson * 2;
                        } else {
                            grossPrice = pricing.lesson; // Default to 1-hour lesson price
                        }

                        // 3. Calculate the net payment (e.g., after a 15% service fee)
                        //    IMPORTANT: Adjust the 0.85 multiplier to match your service fee!
                        //    (e.g., for a 20% fee, use 0.80)
                        const netPayment = grossPrice * 0.85;

                        // 4. Update the payment amount on the page
                        paymentCard.querySelector('.payment-amount h2').textContent = `$${netPayment.toFixed(2)}`;
                    }

                    // This part remains the same
                    const bookingMadeOn = booking.createdAt ? moment(booking.createdAt.toDate()).format('D MMM YYYY, h:mm A') : 'N/A';
                    paymentCard.querySelector('.payment-details-body p').innerHTML = `Booking Made On<br>${bookingMadeOn}`;
                }
                // --- END: REPLACEMENT BLOCK ---

                // Update the "Your Notes" card placeholder
                const notesCard = detailsView.querySelector('.notes-body p');
                if (notesCard) notesCard.innerHTML = `Write your first note about ${booking.learnerName}.<br><small>(These notes are only visible by you.)</small>`;

                // Update the booking history
                const historyRow = detailsView.querySelector('.history-table-row.wide-grid');
                if (historyRow) historyRow.querySelector('div:nth-child(2)').innerHTML = `<i class="fas fa-user" style="margin-right: 10px;"></i> <strong>${booking.learnerName}</strong> confirmed this booking`;

                // --- END OF DATA POPULATION ---

                showView('instructor-booking-details-view');

            } catch (error) {
                console.error("Error rendering instructor booking details:", error);
            }
        }
        // --- END: REPLACEMENT for renderInstructorBookingDetails function ---
        // --- END: NEW FUNCTION FOR INSTRUCTOR BOOKING DETAILS ---
        // --- START: NEW FUNCTION TO CANCEL A BOOKING ---
        async function cancelBooking(bookingId) {
            // Ask for confirmation before proceeding
            if (!confirm("Are you sure you want to cancel this booking? This action cannot be undone.")) {
                return; // Stop if the user clicks "Cancel"
            }

            try {
                // Find the booking in Firestore and update its status
                await db.collection('bookings').doc(bookingId).update({
                    status: 'CANCELLED'
                });

                alert("Booking has been successfully cancelled.");

                // Go back to the main instructor dashboard view
                showInstructorView('instructor-dashboard-view');

            } catch (error) {
                console.error("Error cancelling booking: ", error);
                alert("There was an error cancelling the booking. Please try again.");
            }
        }
        // --- END: NEW FUNCTION TO CANCEL A BOOKING ---
        // --- ADD THIS MISSING FUNCTION ---
        // This function handles switching between different views (Dashboard, Calendar, etc.)
        // inside the instructor's main page.
        function showInstructorView(viewId) {
            // First, hide all views within the instructor dashboard
            document.querySelectorAll('#instructor-dashboard-page .instructor-view').forEach(view => {
                view.classList.remove('active');
            });

            // Then, show the specific view that was requested
            const viewToShow = document.getElementById(viewId);
            if (viewToShow) {
                viewToShow.classList.add('active');
            } else {
                console.error("Instructor view with ID '" + viewId + "' not found.");
            }
        }

        // --- START: NEW FUNCTION TO RENDER INSTRUCTOR CALENDAR ---
        // --- START: REPLACE THE EXISTING 'renderInstructorCalendar' FUNCTION ---
        // --- START: REPLACE THE EXISTING 'renderInstructorCalendar' FUNCTION ---
        // --- START: REPLACE THE EXISTING 'renderInstructorCalendar' FUNCTION ---
        // --- START: FULLY CORRECTED RENDERINSTRUCTORCALENDAR FUNCTION ---
        async function renderInstructorCalendar(uid, viewDate = moment()) {
            const calendarGrid = document.querySelector('#instructor-calendar-view .calendar-grid');
            if (!calendarGrid) return;

            calendarGrid.querySelectorAll('.calendar-event').forEach(eventEl => eventEl.remove());

            const startOfWeek = viewDate.clone().startOf('isoWeek');
            const endOfWeek = viewDate.clone().endOf('isoWeek');

            const gridContentWidth = calendarGrid.clientWidth - 60;
            const dayColumnWidth = gridContentWidth / 7;

            try {
                const snapshot = await db.collection('bookings')
                    .where('instructorId', '==', uid)
                    .where('status', 'in', ['CONFIRMED', 'PROPOSED'])
                    .get();

                if (snapshot.empty) return;

                snapshot.forEach(doc => {
                    const booking = doc.data();
                    const bookingMoment = moment(booking.date, 'ddd, D MMM YYYY');

                    if (bookingMoment.isBetween(startOfWeek, endOfWeek, 'day', '[]')) {
                        const bookingDay = bookingMoment.day();
                        const gridColumnIndex = (bookingDay === 0) ? 6 : bookingDay - 1;

                        const startTime = moment(booking.startTime, 'h:mm a');
                        let endTime;
                        if (booking.endTime && moment(booking.endTime, 'h:mm a').isValid()) {
                            endTime = moment(booking.endTime, 'h:mm a');
                        } else {
                            endTime = startTime.clone().add(1, 'hour');
                        }

                        const minutesFrom6am = (startTime.hours() - 6) * 60 + startTime.minutes();
                        const durationInMinutes = endTime.diff(startTime, 'minutes');

                        // --- THIS IS THE FIX ---
                        // Before: if (durationInMinutes <= 0) continue;
                        // After: 'return' correctly skips this iteration of the .forEach loop.
                        if (durationInMinutes <= 0) return;

                        const eventDiv = document.createElement('div');
                        const eventClass = booking.status === 'PROPOSED' ? 'event-proposed' : 'event-lesson';
                        eventDiv.className = `calendar-event ${eventClass}`;
                        eventDiv.dataset.bookingId = doc.id;

                        const leftPosition = 60 + (gridColumnIndex * dayColumnWidth);

                        eventDiv.style.top = `${minutesFrom6am}px`;
                        eventDiv.style.height = `${durationInMinutes}px`;
                        eventDiv.style.left = `${leftPosition + 5}px`;
                        eventDiv.style.width = `${dayColumnWidth - 10}px`;
                        eventDiv.style.right = 'auto';

                        eventDiv.innerHTML = `
                    <strong>${booking.startTime} - ${endTime.format('h:mm a')}</strong>
                    <p>${booking.learnerName} (${booking.transmission.charAt(0)})<br>${(booking.pickupLocation || '').split(',')[0]}</p>
                `;
                        calendarGrid.appendChild(eventDiv);
                    }
                });
            } catch (error) {
                console.error("Error fetching calendar bookings:", error);
            }
        }
        // --- END: FULLY CORRECTED RENDERINSTRUCTORCALENDAR FUNCTION ---
        // --- END: REPLACEMENT FUNCTION ---
        // --- END: REPLACEMENT FUNCTION ---
        // --- END: REPLACEMENT FUNCTION ---
        // Add this new function with your other helper functions
        async function updateCalendarView(date) {
            // 1. Build the basic grid structure
            buildCalendarGrid(date);

            // 2. Fetch user's availability and apply background colors
            if (auth.currentUser) {
                try {
                    const doc = await db.collection('users').doc(auth.currentUser.uid).get();
                    if (doc.exists) {
                        renderCalendarAvailability(doc.data().operatingHours);
                    }
                } catch (error) {
                    console.error("Could not load operating hours for calendar.", error);
                }
            }

            // 3. Render the actual booked events on top of the availability
            renderInstructorCalendar(auth.currentUser.uid, date);
        }
        // --- START: CALENDAR NAVIGATION LISTENERS ---
        // --- START: CALENDAR NAVIGATION LISTENERS (CORRECTED) ---
        document.addEventListener('DOMContentLoaded', () => {
            const nextWeekBtn = document.getElementById('cal-next-week-btn');
            const prevWeekBtn = document.getElementById('cal-prev-week-btn');
            const todayBtn = document.getElementById('cal-today-btn');

            if (nextWeekBtn) {
                nextWeekBtn.addEventListener('click', () => {
                    currentCalendarDate.add(1, 'week');
                    updateCalendarView(currentCalendarDate);
                });
            }

            if (prevWeekBtn) {
                prevWeekBtn.addEventListener('click', () => {
                    currentCalendarDate.subtract(1, 'week');
                    updateCalendarView(currentCalendarDate);
                });
            }

            if (todayBtn) {
                todayBtn.addEventListener('click', () => {
                    currentCalendarDate = moment();
                    updateCalendarView(currentCalendarDate);
                });
            }
        });
        // --- END: CALENDAR NAVIGATION LISTENERS (CORRECTED) ---
        // --- END: CALENDAR NAVIGATION LISTENERS ---
        // --- END: NEW FUNCTION TO RENDER INSTRUCTOR CALENDAR ---

        // --- START: NEW DYNAMIC LEARNER FUNCTIONS ---

        /**
         * Fetches and displays the list of learners associated with an instructor.
         * @param {string} instructorId - The UID of the logged-in instructor.
         */
        async function renderInstructorLearners(instructorId) {
            const learnersListContainer = document.querySelector('#my-learners-content .learners-list');
            if (!learnersListContainer) return;

            // Show a loading state
            learnersListContainer.innerHTML = `
        <div class="learners-list-header">
            <div>Learner Details</div><div>Guardian Details</div><div>Booking Hours Completed</div><div>Upcoming Bookings</div><div></div>
        </div>
        <div class="learners-list-row"><p style="grid-column: 1 / -1; text-align: center; padding: 20px;">Loading learners...</p></div>`;

            try {
                // 1. Find all unique learners from the instructor's bookings
                const bookingsSnapshot = await db.collection('bookings').where('instructorId', '==', instructorId).get();
                if (bookingsSnapshot.empty) {
                    learnersListContainer.innerHTML = `
                <div class="learners-list-header">
                     <div>Learner Details</div><div>Guardian Details</div><div>Booking Hours Completed</div><div>Upcoming Bookings</div><div></div>
                </div>
                <div class="learners-list-row"><p style="grid-column: 1 / -1; text-align: center; padding: 20px;">No learners found.</p></div>`;
                    return;
                }

                const learnerIds = [...new Set(bookingsSnapshot.docs.map(doc => doc.data().learnerId))];

                // 2. Fetch details and stats for each unique learner
                const learnerDataPromises = learnerIds.map(async (learnerId) => {
                    const userDoc = await db.collection('users').doc(learnerId).get();
                    const completedBookings = bookingsSnapshot.docs.filter(doc => doc.data().learnerId === learnerId && doc.data().status === 'COMPLETED');
                    const upcomingBookings = bookingsSnapshot.docs.filter(doc => doc.data().learnerId === learnerId && doc.data().status === 'CONFIRMED');

                    // Simple hour calculation (assumes '1-hour' or '2-hour' in lessonType)
                    const hoursCompleted = completedBookings.reduce((total, booking) => {
                        const type = booking.data().lessonType || '';
                        if (type.includes('2-hour')) return total + 2;
                        if (type.includes('1-hour')) return total + 1;
                        return total;
                    }, 0);

                    return {
                        id: learnerId,
                        data: userDoc.data(),
                        hours: hoursCompleted,
                        upcomingCount: upcomingBookings.length
                    };
                });

                const learners = await Promise.all(learnerDataPromises);

                // 3. Render the list
                learnersListContainer.innerHTML = `
            <div class="learners-list-header">
                <div>Learner Details</div><div>Guardian Details</div><div>Booking Hours Completed</div><div>Upcoming Bookings</div><div></div>
            </div>`; // Clear loading and add header

                learners.forEach(learner => {
                    const learnerRow = `
                <div class="learners-list-row" data-learner-id="${learner.id}">
                    <div class="learner-cell-details">
                        <h5>${learner.data.firstName || 'N/A'} ${learner.data.surname || ''}</h5>
                        <span>${learner.data.mobile || 'No phone number'}</span>
                    </div>
                    <div>-</div>
                    <div>${learner.hours}</div>
                    <div>${learner.upcomingCount}</div>
                    <div class="learner-actions">
                        <a href="#" class="view-learner-details-btn">Learner Details</a>
                        <button class="btn btn-primary propose-booking-btn">Propose Booking</button>
                    </div>
                </div>`;
                    learnersListContainer.insertAdjacentHTML('beforeend', learnerRow);
                });

            } catch (error) {
                console.error("Error rendering instructor learners: ", error);
                learnersListContainer.innerHTML = `<div class="learners-list-row"><p style="grid-column: 1 / -1; text-align: center; padding: 20px; color: red;">Could not load learners.</p></div>`;
            }
        }


        /**
         * Fetches and displays the details for a single learner.
         * @param {string} learnerId - The UID of the learner to display.
         */
        // --- START: REPLACE THE EXISTING 'renderLearnerDetailsPage' FUNCTION ---
        async function renderLearnerDetailsPage(learnerId) {
            const detailsView = document.getElementById('instructor-learner-details-view');
            if (!detailsView) return;

            // Store the current learner's ID on the view for other functions to access
            detailsView.dataset.learnerId = learnerId;

            // Show the learner details view and display a loading state
            showInstructorView('instructor-learner-details-view');
            detailsView.querySelector('.learner-info h3').textContent = 'Loading...';
            detailsView.querySelector('.learner-info p').textContent = '';
            detailsView.querySelector('.learner-history-table').innerHTML = '<p style="text-align: center; padding: 20px;">Loading booking history...</p>';

            try {
                // Fetch the learner's document from the 'users' collection in Firestore
                const learnerDoc = await db.collection('users').doc(learnerId).get();
                if (!learnerDoc.exists) throw new Error("Learner not found");

                const learner = learnerDoc.data();
                const instructorId = auth.currentUser.uid;

                // **FIX 1: Calculate age from the 'dob' field**
                // It uses the moment.js library to find the difference in years.
                // If the 'dob' field doesn't exist, it gracefully defaults to 'N/A'.
                const age = learner.dob ? moment().diff(moment(learner.dob, "YYYY-MM-DD"), 'years') : 'N/A';

                // **FIX 2: Get the learner's initials for the avatar**
                const initials = `${(learner.firstName || ' ')[0]}${(learner.surname || ' ')[0]}`.toUpperCase();

                // **FIX 3: Populate the HTML with the fetched data**
                detailsView.querySelector('.learner-avatar').textContent = initials;
                detailsView.querySelector('.learner-info h3').innerHTML = `${learner.firstName} ${learner.surname || ''} <span class="age-tag">Age ${age}</span>`;
                detailsView.querySelector('.learner-info p').innerHTML = `<i class="fas fa-phone-alt"></i> ${learner.mobile || 'No phone number'}`;

                // Fetch the learner's booking history with the current instructor
                const bookingsSnapshot = await db.collection('bookings')
                    .where('learnerId', '==', learnerId)
                    .where('instructorId', '==', instructorId)
                    .where('status', 'in', ['COMPLETED', 'CANCELLED'])
                    .orderBy('createdAt', 'desc')
                    .get();

                const historyTable = detailsView.querySelector('.learner-history-table');
                // Clear loading state and add table header
                historyTable.innerHTML = `
                    <div class="learner-history-header">
                        <div>Booking</div><div>Date</div><div>Time</div><div>Location</div><div>Status</div><div>Payment</div>
                    </div>`;

                if (bookingsSnapshot.empty) {
                    historyTable.innerHTML += '<div class="learner-history-row" style="text-align: center; grid-column: 1 / -1; padding: 20px;">No past bookings found.</div>';
                } else {
                    // Populate the booking history table
                    bookingsSnapshot.forEach(doc => {
                        const booking = doc.data();
                        const statusClass = booking.status === 'COMPLETED' ? 'status-completed' : 'status-cancelled';
                        const historyRow = `
                            <div class="learner-history-row">
                                <div><a href="#" class="booking-id-link">#${doc.id.substring(0, 7)}</a></div>
                                <div>${booking.date}</div>
                                <div>${booking.startTime} - ${booking.endTime}</div>
                                <div>${booking.pickupLocation}</div>
                                <div><span class="status-badge ${statusClass}">${booking.status}</span></div>
                                <div><span class="status-badge status-processed">PROCESSED</span></div>
                            </div>`;
                        historyTable.insertAdjacentHTML('beforeend', historyRow);
                    });
                }
            } catch (error) {
                console.error("Error rendering learner details: ", error);
                detailsView.querySelector('.learner-info h3').textContent = 'Error loading details.';
            }
        }
        // --- END: REPLACEMENT FUNCTION ---

        // --- END: NEW DYNAMIC LEARNER FUNCTIONS ---
        // --- START: Add this JavaScript for the notification bell ---
        const notificationBell = document.getElementById('notification-bell-icon');
        if (notificationBell) {
            notificationBell.addEventListener('click', function (e) {
                e.preventDefault();
                // This function is already in your code, it switches the visible content
                showInstructorView('instructor-notifications-view');
            });
        }
        // --- END: Notification Bell JavaScript ---
        // --- START: Add this JavaScript for the notification modal ---

        // 1. Get references to the modal and the main notification list
        const bookingNotificationModal = document.getElementById('booking-notification-modal');
        const notificationsList = document.querySelector('.notifications-list');

        if (bookingNotificationModal && notificationsList) {
            const closeModalBtn = bookingNotificationModal.querySelector('.modal-close-btn');

            // 2. Listen for clicks on the entire list of notifications
            notificationsList.addEventListener('click', function (e) {
                // Find the specific notification item that was clicked
                const clickedItem = e.target.closest('.notification-item');

                if (clickedItem) {
                    // 2a. If the item was unread, remove the 'unread' class to make it white
                    if (clickedItem.classList.contains('unread')) {
                        clickedItem.classList.remove('unread');
                    }

                    // 2b. Open the modal
                    bookingNotificationModal.classList.add('active');

                    // Note: In a real application, you would pass the specific booking data
                    // from the clicked notification into the modal here.
                }
            });

            // 3. Logic to close the modal
            const closeBookingModal = () => {
                bookingNotificationModal.classList.remove('active');
            };

            closeModalBtn.addEventListener('click', closeBookingModal);

            bookingNotificationModal.addEventListener('click', (e) => {
                // Close if the dark overlay is clicked, but not the content inside it
                if (e.target === bookingNotificationModal) {
                    closeBookingModal();
                }
            });
        }

        // --- START: ADD NOTE FUNCTIONALITY ---
        const addNoteBtn = document.getElementById('add-note-btn');
        const addNoteFormContainer = document.getElementById('add-note-form-container');
        const notesPlaceholder = document.getElementById('notes-placeholder');
        const cancelNoteBtn = document.getElementById('cancel-note-btn');
        const addNoteForm = document.getElementById('add-note-form');
        const noteDateInput = document.getElementById('note-date');

        if (addNoteBtn) {
            addNoteBtn.addEventListener('click', () => {
                // Hide placeholder and show form
                notesPlaceholder.style.display = 'none';
                addNoteFormContainer.style.display = 'block';

                // Set current date using moment.js
                noteDateInput.value = moment().format('DD-MM-YYYY');
            });
        }

        if (cancelNoteBtn) {
            cancelNoteBtn.addEventListener('click', () => {
                // Hide form and show placeholder
                addNoteFormContainer.style.display = 'none';
                notesPlaceholder.style.display = 'block';
                addNoteForm.reset(); // Clear the textarea
            });
        }

        if (addNoteForm) {
            addNoteForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // For this demo, just show an alert and close the form.
                // In a real app, you would save the data here.
                alert('Note saved!');
                addNoteFormContainer.style.display = 'none';
                notesPlaceholder.style.display = 'block';
                addNoteForm.reset();
            });
        }
        // --- END: ADD NOTE FUNCTIONALITY ---
        // --- END: Notification Modal JavaScript ---
        // --- START: NEW FUNCTION TO RENDER RESCHEDULE PAGE ---
        async function renderReschedulePage(bookingId) {
            const rescheduleView = document.getElementById('instructor-reschedule-booking-view');
            if (!rescheduleView) return;

            try {
                const doc = await db.collection('bookings').doc(bookingId).get();
                if (!doc.exists) {
                    alert('Booking not found.');
                    return;
                }
                const booking = doc.data();

                // Populate breadcrumbs
                rescheduleView.querySelector('#reschedule-breadcrumbs').innerHTML = `
            <a href="#" data-view="instructor-dashboard-view">Upcoming Bookings</a> > 
            <a href="#" data-view="instructor-booking-details-view" onclick="showInstructorView('instructor-booking-details-view')">Booking #${bookingId.substring(0, 7)}</a> > 
            Modify Booking
        `;

                // Populate warning box
                rescheduleView.querySelector('#reschedule-warning-box p').textContent = `${booking.learnerName} will be notified that the current booking is cancelled and can either accept or decline the new booking proposal.`;

                // Populate current booking summary
                rescheduleView.querySelector('#reschedule-current-booking-id').innerHTML = `Booking #${bookingId.substring(0, 7)} <span class="status-badge status-confirmed">CONFIRMED</span>`;
                rescheduleView.querySelector('#reschedule-current-date span').textContent = moment(booking.date, 'ddd, D MMM YYYY').format('ddd, D MMM YYYY');
                rescheduleView.querySelector('#reschedule-current-time span').textContent = `${booking.startTime} - ${booking.endTime}`;
                rescheduleView.querySelector('#reschedule-current-type span').textContent = `${booking.lessonType} (${booking.transmission})`;
                rescheduleView.querySelector('#reschedule-current-location span').textContent = booking.pickupLocation;
                rescheduleView.querySelector('#reschedule-current-learner img').src = `https://placehold.co/100x100?text=${booking.learnerName.charAt(0)}`;
                rescheduleView.querySelector('#reschedule-current-learner p').innerHTML = `${booking.learnerName}<br>0478922109`; // Placeholder phone

                // Pre-fill new booking form
                rescheduleView.querySelector('#reschedule-learner option').textContent = `${booking.learnerName} - 0478922109`;
                rescheduleView.querySelector('#reschedule-new-location').textContent = booking.pickupLocation;

                // Finally, show the page
                showInstructorView('instructor-reschedule-booking-view');

            } catch (error) {
                console.error("Error rendering reschedule page: ", error);
                alert('Could not load reschedule page data.');
            }
        }
        // --- START: ADD THIS ENTIRE NEW BLOCK ---
        // --- CALENDAR CLICK LISTENER FOR PROPOSING BOOKINGS ---
        const calendarGrid = document.querySelector('#instructor-calendar-view .calendar-grid');
        if (calendarGrid) {
            calendarGrid.addEventListener('click', (e) => {
                // Only proceed if we are in proposal mode
                if (proposalContext.status !== 'active') {
                    return;
                }

                // Make sure the click is on a slot, not an existing event
                if (e.target.classList.contains('time-slot') && !e.target.classList.contains('with-event')) {
                    const slot = e.target;

                    // Calculate which day column was clicked (1=Mon, 7=Sun)
                    const dayIndex = Array.from(slot.parentNode.children).indexOf(slot) - 1;

                    // Calculate which hour row was clicked
                    const timeSlotIndex = Array.from(slot.parentElement.children).indexOf(slot.parentNode);
                    const hour = 6 + Math.floor(timeSlotIndex); // Assuming calendar starts at 6am

                    // Get the date from the calendar's current state
                    const clickedDate = currentCalendarDate.clone().startOf('isoWeek').add(dayIndex, 'days');
                    const clickedTime = moment().hour(hour).minute(0);

                    // Open the modal with the calculated info
                    openProposeBookingModal(clickedDate, clickedTime);
                }
            });
        }

        // --- START: ADD THIS ENTIRE NEW BLOCK OF FUNCTIONS ---
        // --- PROPOSE BOOKING MODAL LOGIC ---
        const proposeBookingModal = document.getElementById('propose-booking-modal');
        const proposeBookingForm = document.getElementById('propose-booking-form');
        let proposalData = {}; // To store temporary data for submission

        function openProposeBookingModal(date, time) {
            if (!proposeBookingModal) return;

            // Store data for submission
            proposalData = { date, time };

            // Populate the modal with context
            proposeBookingModal.querySelector('#propose-modal-title').textContent = `Propose Booking - ${proposalContext.learnerName}`;
            proposeBookingModal.querySelector('#propose-modal-warning').textContent = `Booking(s) will be on hold for ${proposalContext.learnerName} until 5:30 PM, ${date.clone().add(1, 'day').format('D MMM YYYY')}.`;
            proposeBookingModal.querySelector('#propose-lesson-date').value = date.format('dddd, D MMM YYYY');
            proposeBookingModal.querySelector('#propose-lesson-time').value = time.format('h:mm A');
            proposeBookingModal.querySelector('#propose-test-date').value = date.format('dddd, D MMM YYYY');

            proposeBookingModal.classList.add('active');
        }

        function closeProposeBookingModal() {
            if (!proposeBookingModal) return;
            proposeBookingModal.classList.remove('active');
            proposeBookingForm.reset();
            // Reset proposal context to exit "proposal mode"
            proposalContext = { learnerId: null, learnerName: null, status: 'inactive' };
        }

        // Handle switching between lesson/test package in the modal
        proposeBookingModal.querySelector('#propose-booking-type-select').addEventListener('change', (e) => {
            const isLesson = e.target.value === 'lesson';
            proposeBookingModal.querySelector('#propose-lesson-fields').style.display = isLesson ? 'block' : 'none';
            proposeBookingModal.querySelector('#propose-test-fields').style.display = isLesson ? 'none' : 'block';
        });

        // Handle form submission
        proposeBookingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const duration = parseInt(proposeBookingForm.querySelector('input[name="lesson-duration"]:checked').value);
            const startTime = proposalData.time;
            const endTime = startTime.clone().add(duration, 'hours');

            const newBookingData = {
                instructorId: auth.currentUser.uid,
                learnerId: proposalContext.learnerId,
                learnerName: proposalContext.learnerName,
                date: proposalData.date.format('ddd, D MMM YYYY'),
                startTime: startTime.format('h:mm a'),
                endTime: endTime.format('h:mm a'),
                lessonType: `${duration}-hour Driving Lesson`,
                transmission: 'Auto', // Assuming auto for now
                pickupLocation: proposeBookingModal.querySelector('#propose-pickup-location').textContent,
                status: 'PROPOSED', // The crucial new status
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('bookings').add(newBookingData);
                alert('Booking proposal sent successfully!');
                closeProposeBookingModal();
                // Refresh the calendar to show the new yellow event
                renderInstructorCalendar(auth.currentUser.uid, currentCalendarDate);
            } catch (error) {
                console.error("Error creating proposal: ", error);
                alert('Failed to send proposal. Please try again.');
            }
        });

        // Add listeners to close buttons
        proposeBookingModal.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', closeProposeBookingModal);
        });
        // --- END: ADDED BLOCK OF FUNCTIONS ---
        // --- END: ADDED BLOCK ---
        // --- END: NEW FUNCTION TO RENDER RESCHEDULE PAGE ---

        // --- START: ADD THIS NEW SCRIPT FOR THE PAYOUT LINK ---
        document.getElementById('trigger-payout-details').addEventListener('click', (e) => {
            e.preventDefault();

            // Switch to the new payout view you just added
            showInstructorView('instructor-payout-details-view');

            // Update the sidebar to highlight 'Reports' as active
            document.querySelectorAll('.sidebar-nav li').forEach(li => li.classList.remove('active'));
            const reportsLink = document.querySelector('.sidebar-nav a[data-view="instructor-reports-view"]');
            if (reportsLink) {
                reportsLink.closest('li').classList.add('active');
            }
        });
        // --- START: ADD THIS SCRIPT FOR PAYOUT LINK & ACCORDION ---
        document.addEventListener('click', (e) => {
            // Logic for the link on the main dashboard
            if (e.target.closest('#trigger-payout-details')) {
                e.preventDefault();
                showInstructorView('instructor-payout-details-view');

                // Ensure sidebar is highlighted correctly
                document.querySelectorAll('.sidebar-nav li').forEach(li => li.classList.remove('active'));
                const reportsLink = document.querySelector('.sidebar-nav a[data-view="instructor-reports-view"]');
                if (reportsLink) {
                    reportsLink.closest('li').classList.add('active');
                }
            }

            // Logic for the accordion toggle on the reports page
            if (e.target.closest('.next-payout-item')) {
                e.preventDefault();
                const payoutView = e.target.closest('#instructor-payout-details-view');
                if (payoutView) {
                    payoutView.querySelector('.pending-payout-card').classList.toggle('expanded');
                    payoutView.querySelector('.next-payout-item').classList.toggle('expanded');
                    payoutView.querySelector('#payout-details-content').classList.toggle('expanded');
                }
            }
        });
        // --- END: ADD THIS SCRIPT ---

        // --- START: FINAL SCRIPT FOR ALL RESPONSIVE MENUS ---
        document.addEventListener('DOMContentLoaded', () => {

            // Get references for ALL necessary elements for BOTH dashboards
            const instructorHamburgerBtn = document.getElementById('instructor-hamburger-btn');
            const learnerHamburgerBtn = document.getElementById('learner-hamburger-btn');

            const instructorSidebar = document.querySelector('#instructor-dashboard-page .sidebar');
            const learnerSidebar = document.querySelector('#dashboard-page .sidebar');

            const pageOverlay = document.getElementById('page-overlay');

            // Universal function to open a specific menu
            const openMenu = (sidebar) => {
                if (sidebar && pageOverlay) {
                    sidebar.classList.add('open');
                    pageOverlay.classList.add('active');
                } else {
                    console.error("Sidebar or Page Overlay not found!");
                }
            };

            // Universal function to close ANY open menu
            const closeMenu = () => {
                if (instructorSidebar) instructorSidebar.classList.remove('open');
                if (learnerSidebar) learnerSidebar.classList.remove('open');
                if (pageOverlay) pageOverlay.classList.remove('active');
            };

            // Attach click listeners to each button
            if (instructorHamburgerBtn) {
                instructorHamburgerBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevents other clicks from firing
                    openMenu(instructorSidebar);
                });
            }

            if (learnerHamburgerBtn) {
                learnerHamburgerBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openMenu(learnerSidebar);
                });
            }

            // Attach a single click listener to the overlay to close any menu
            if (pageOverlay) {
                pageOverlay.addEventListener('click', closeMenu);
            }
        });


        async function loadPersonalDetails() {
            if (!auth.currentUser) return;
            const uid = auth.currentUser.uid;
            const form = document.getElementById('personal-details-form');

            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    form.querySelector('#pd-first-name').value = data.firstName || '';
                    form.querySelector('#pd-surname').value = data.surname || '';
                    form.querySelector('#pd-email').value = data.email || '';
                    form.querySelector('#pd-mobile').value = data.mobile || '';
                    form.querySelector('#pd-dob').value = data.dob || ''; // Assumes DD-MM-YYYY format
                    form.querySelector('#pd-gender').value = data.gender || '';
                    // Note: Pincode loading might be more complex if it's a dynamic list
                }
            } catch (error) {
                console.error("Error loading personal details: ", error);
                alert("Could not load your details.");
            }
        }

        // Function to save instructor personal details
        // --- START: REPLACE THE OLD savePersonalDetails FUNCTION WITH THIS ---

        // Function to save instructor personal details AND handle password changes
        // --- START: REPLACEMENT FOR savePersonalDetails FUNCTION and LISTENER ---

        /**
         * Saves instructor personal details AND handles password changes.
         * @param {Event} e - The form submission event.
         */
        // --- START: REPLACEMENT FOR savePersonalDetails FUNCTION and LISTENER (v2) ---


        /**
         * Saves instructor personal details AND handles password changes.
         * @param {Event} e - The form submission event.
         */
        async function savePersonalDetails(e) {
            console.log("--- savePersonalDetails started ---");
            try {
                e.preventDefault();
                console.log("event.preventDefault() called successfully.");
            } catch (preventError) {
                console.error("CRITICAL: Failed to call preventDefault!", preventError);
                alert("CRITICAL ERROR: Could not prevent form submission. Check console!");
                return;
            }

            const user = auth.currentUser;
            // ... (user check) ...
            const form = document.getElementById('personal-details-form');
            // ... (form check) ...

            // --- Part 1: Update Profile Details (Firestore) ---
            const updatedProfileData = {
                firstName: form.querySelector('#pd-first-name').value.trim(),
                surname: form.querySelector('#pd-surname').value.trim(),
                mobile: form.querySelector('#pd-mobile').value.trim(),
                dob: form.querySelector('#pd-dob').value.trim(),
                gender: form.querySelector('#pd-gender').value
            };
            console.log("Profile data to save:", updatedProfileData);

            let profileUpdateSuccess = false;
            try {
                console.log("Attempting Firestore update...");
                await db.collection('users').doc(user.uid).update(updatedProfileData);
                console.log("Firestore profile update successful.");
                profileUpdateSuccess = true;
                const userNameElement = document.getElementById('instructor-user-name');
                if (userNameElement) {
                    userNameElement.textContent = updatedProfileData.firstName;
                    console.log("Updated header display name.");
                } else {
                    console.warn("Could not find element to update header display name.");
                }
            } catch (error) {
                console.error("Firestore update FAILED:", error);
                alert("❌ Could not update your profile details. Please check the console (F12) for Firestore errors (permissions?).");
                // return; // Keep this commented for now
            }

            /* --- START: TEMPORARILY COMMENT OUT PASSWORD CHANGE ---
            // --- Part 2: Handle Password Change (Firebase Auth) ---
            const newPassword = form.querySelector('#pd-new-password').value;
            const confirmPassword = form.querySelector('#pd-confirm-password').value;
            const currentPassword = form.querySelector('#pd-current-password').value;
            // ... (rest of Part 2 code down to the next comment) ...
            console.log("No new password entered, skipping password change.");
            --- END: TEMPORARILY COMMENT OUT PASSWORD CHANGE --- */

            const newPassword = ''; // Force password change to be skipped

            // --- Part 3: Final Success Message ---
            if (profileUpdateSuccess && !newPassword) { // This condition will now always be true if profile update succeeds
                alert("✅ Profile details updated successfully!");
            }
            /* // This part is unreachable now
            else if (profileUpdateSuccess && newPassword) {
                console.log("Profile and password updated successfully.");
            }
            */
            console.log("--- savePersonalDetails finished (Password Change Skipped) ---");

        } // End of savePersonalDetails function

        // --- The listener attachment code remains the same ---
        let isPersonalDetailsListenerAttached = false;
        document.addEventListener('DOMContentLoaded', () => {
            if (isPersonalDetailsListenerAttached) {
                console.warn("Personal details listener already attached. Skipping.");
                return;
            }
            const personalDetailsForm = document.getElementById('personal-details-form');
            if (personalDetailsForm) {
                console.log("Attaching submit listener to personal details form FOR THE FIRST TIME.");
                personalDetailsForm.addEventListener('submit', savePersonalDetails);
                isPersonalDetailsListenerAttached = true;
            } else {
                console.error("Could not find personal details form ON DOMContentLoaded.");
            }
        }); // End of savePersonalDetails function

        // --- Attach the event listener ONCE ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check the flag BEFORE doing anything
            if (isPersonalDetailsListenerAttached) {
                console.warn("Personal details listener already attached. Skipping.");
                return;
            }

            const personalDetailsForm = document.getElementById('personal-details-form');
            if (personalDetailsForm) {
                console.log("Attaching submit listener to personal details form FOR THE FIRST TIME.");
                personalDetailsForm.addEventListener('submit', savePersonalDetails);
                isPersonalDetailsListenerAttached = true; // Set the flag
            } else {
                console.error("Could not find personal details form ON DOMContentLoaded.");
            }
        });

        // --- END: REPLACEMENT FOR savePersonalDetails FUNCTION and LISTENER (v2) ---

        // --- END: REPLACEMENT FOR savePersonalDetails FUNCTION and LISTENER ---

        // --- END: REPLACEMENT FUNCTION ---

        // Attach listener to the form


        // --- START: ADD THIS SCRIPT FOR SERVICE AREA PAGE INTERACTIVITY ---
        const operatingHoursContainer = document.getElementById('operating-hours-container');
        if (operatingHoursContainer) {

            // Handle clicking "Add More" or "Remove"
            operatingHoursContainer.addEventListener('click', (e) => {
                e.preventDefault();
                const target = e.target;
                const timeSlotsWrapper = target.closest('.day-row')?.querySelector('.time-slots-wrapper');

                if (!timeSlotsWrapper) return;

                if (target.classList.contains('add-more-link')) {
                    const newTimeSlot = document.createElement('div');
                    newTimeSlot.className = 'time-slot-group';
                    newTimeSlot.innerHTML = `<select><option>09</option></select> : <select><option>00</option></select> - <select><option>09</option></select> : <select><option>00</option></select>`;
                    timeSlotsWrapper.appendChild(newTimeSlot);
                }

                if (target.classList.contains('remove-link')) {
                    if (timeSlotsWrapper.children.length > 1) {
                        timeSlotsWrapper.removeChild(timeSlotsWrapper.lastElementChild);
                    }
                }
            });

            // Handle enabling/disabling time slots with the checkbox
            operatingHoursContainer.addEventListener('change', (e) => {
                const target = e.target;
                if (target.type === 'checkbox') {
                    const dayRow = target.closest('.day-row');
                    const selects = dayRow.querySelectorAll('select');
                    selects.forEach(select => select.disabled = !target.checked);
                }
            });
        }

        // --- START: ADD THESE NEW FUNCTIONS FOR SERVICE AREA MAP & TAGS ---


        /**
       * Initializes the Google Places Autocomplete on the input field.
       */
        function initSuburbAutocomplete() {
            const input = document.getElementById('suburb-autocomplete-input');
            if (!input || typeof google === 'undefined') return;

            const options = {
                types: ['(regions)'], // Restricts search to geographical regions like suburbs
                componentRestrictions: { country: 'au' } // Restricts search to Australia
            };

            const autocomplete = new google.maps.places.Autocomplete(input, options);

            // Listen for when a user selects a suburb from the dropdown
            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                if (place && place.name) {
                    addSuburb(place.name); // Add the selected suburb to Firestore
                    input.value = ''; // Clear the input field
                }
            });
        }

        /**
         * Adds a new suburb to the instructor's list in Firestore.
         * @param {string} suburbName - The name of the suburb to add.
         */
        async function addSuburb(suburbName) {
            if (!auth.currentUser) return;
            const uid = auth.currentUser.uid;
            const userRef = db.collection('users').doc(uid);

            try {
                // arrayUnion adds the element only if it's not already present.
                await userRef.update({
                    servicedSuburbs: firebase.firestore.FieldValue.arrayUnion(suburbName)
                });
                // After successfully adding, reload the whole section to reflect the change
                loadServiceAreaAndAvailability();
            } catch (error) {
                console.error("Error adding suburb: ", error);
            }
        }

        /**
         * Removes a suburb from the instructor's list in Firestore.
         * @param {string} suburbName - The name of the suburb to remove.
         */
        async function removeSuburb(suburbName) {
            if (!auth.currentUser) return;
            const uid = auth.currentUser.uid;
            const userRef = db.collection('users').doc(uid);

            try {
                // arrayRemove removes all instances of the element from the array.
                await userRef.update({
                    servicedSuburbs: firebase.firestore.FieldValue.arrayRemove(suburbName)
                });
                // After successfully removing, reload the section
                loadServiceAreaAndAvailability();
            } catch (error) {
                console.error("Error removing suburb: ", error);
            }
        }

        /**
         * Renders the suburb names as clickable tags with remove buttons.
         * @param {string[]} suburbs - An array of suburb names.
         */
        function renderSuburbTags(suburbs) {
            const tagsContainer = document.getElementById('location-tags-container');
            if (!tagsContainer) return;

            if (!suburbs || suburbs.length === 0) {
                tagsContainer.innerHTML = `<p style="color: var(--gray-color);">No suburbs added yet. Use the search box above to add one.</p>`;
                return;
            }

            tagsContainer.innerHTML = ''; // Clear previous tags
            suburbs.forEach(suburb => {
                // Add data-suburb attribute to the button for easy identification
                const tagHTML = `
                    <span class="location-tag">
                        ${suburb} 
                        <button class="remove-suburb-btn" data-suburb="${suburb}">&times;</button>
                    </span>`;
                tagsContainer.insertAdjacentHTML('beforeend', tagHTML);
            });
        }

        /**
         * Initializes the map, geocodes suburbs, and places markers and circles.
         * @param {string[]} suburbs - An array of suburb names to display on the map.
         */

        /**
         * Fetches instructor data and triggers the rendering of the map and tags.
         */
        // --- START: REPLACEMENT FOR THE loadServiceAreaAndAvailability FUNCTION ---

        // REPLACE your old loadServiceAreaAndAvailability function with this
        async function loadServiceAreaAndAvailability() {
            if (!auth.currentUser) return;
            const uid = auth.currentUser.uid;

            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    const suburbs = data.servicedSuburbs || [];

                    // Render the text summary, tags, and availability calendar (this is unchanged)
                    document.getElementById('service-area-summary').innerHTML = `You are servicing <strong>${suburbs.length} suburbs</strong> around Sydney...`;
                    renderSuburbTags(suburbs);
                    initSuburbAutocomplete();
                    loadNewAvailability(data.operatingHours);

                    // This now calls the new, separate function to UPDATE the map
                    updateMapWithObjects(suburbs);

                } else {
                    document.getElementById('new-availability-container').innerHTML = '<p>Could not find user profile data.</p>';
                }
            } catch (error) {
                console.error("Error loading service area and availability data: ", error);
                document.getElementById('new-availability-container').innerHTML = '<p style="color: red;">Could not load availability.</p>';
            }
        }

        // --- END: REPLACEMENT FUNCTION ---

        // Add a single, delegated event listener to handle all remove button clicks
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('remove-suburb-btn')) {
                const suburbToRemove = e.target.dataset.suburb;
                if (suburbToRemove) {
                    removeSuburb(suburbToRemove);
                }
            }
        });
        // --- END: REPLACEMENT JAVASCRIPT BLOCK ---
        /**
         * Renders the suburb names as clickable tags.
         * @param {string[]} suburbs - An array of suburb names.
         */


        /**
         * Initializes the map, geocodes suburbs, and places markers and circles.
         * @param {string[]} suburbs - An array of suburb names to display on the map.
         */


        /**
         * Fetches instructor data and triggers the rendering of the map and tags.
         */

        // --- END: ADDED FUNCTIONS ---
        // --- END: ADDED SCRIPT ---
        // --- END: FINAL SCRIPT ---

        // --- START: REPLACEMENT SCRIPT FOR OPERATING HOURS ---



        /**
         * Reads the current state of the 7-day availability form and saves it to Firestore.
         */
        async function saveAvailability() {
            if (!auth.currentUser) return alert('You must be logged in to save changes.');

            const uid = auth.currentUser.uid;
            const container = document.getElementById('new-availability-container');
            const newHoursData = {};

            // Loop through each day row to build the data object to save
            container.querySelectorAll('.availability-day-row').forEach(row => {
                const day = row.dataset.day;
                const checkbox = row.querySelector('.day-toggle');

                if (checkbox.checked) {
                    // If the day is toggled ON, save the start and end times
                    const start = row.querySelector('.start-time').value;
                    const end = row.querySelector('.end-time').value;
                    newHoursData[day] = [{ start, end }];
                } else {
                    // If the day is toggled OFF, save an empty array to indicate no availability
                    newHoursData[day] = [];
                }
            });

            try {
                // Update the 'operatingHours' field in the user's document
                await db.collection('users').doc(uid).update({ operatingHours: newHoursData });
                alert('✅ Availability updated successfully!');

                // If the main calendar view is currently active, refresh it to show new availability
                if (document.getElementById('instructor-calendar-view').classList.contains('active')) {
                    updateCalendarView(currentCalendarDate);
                }
            } catch (error) {
                console.error("Error saving availability: ", error);
                alert('❌ Failed to save changes. Please try again.');
            }
        }

        // This ensures the code runs only after the entire page is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const saveBtn = document.getElementById('save-availability-btn');
            const availabilityContainer = document.getElementById('new-availability-container');

            // Attach listener to the main "Save and Change" button
            if (saveBtn) {
                saveBtn.addEventListener('click', saveAvailability);
            }

            // Attach a single listener to the container to handle all toggle switches
            if (availabilityContainer) {
                availabilityContainer.addEventListener('change', (e) => {
                    const target = e.target;
                    // Check if the changed element was one of our day toggles
                    if (target.classList.contains('day-toggle')) {
                        const dayRow = target.closest('.availability-day-row');
                        const isEnabled = target.checked;

                        // Enable or disable the time inputs in the same row
                        dayRow.querySelector('.start-time').disabled = !isEnabled;
                        dayRow.querySelector('.end-time').disabled = !isEnabled;

                        // Add or remove the visual greyed-out style
                        dayRow.classList.toggle('day-disabled', !isEnabled);
                    }
                });
            }
        });

        // --- END: NEW AND IMPROVED AVAILABILITY SCRIPT ---




        /**
         * Dynamically builds the HTML for the calendar grid for a given week.
         * This replaces the static HTML.
         */
        function buildCalendarGrid(date) {
            const grid = document.getElementById('dynamic-calendar-grid');
            if (!grid) return;
            document.getElementById('cal-month-display').textContent = date.format('MMMM YYYY');

            grid.innerHTML = ''; // Clear old grid
            const startOfWeek = date.clone().startOf('isoWeek'); // Starts on Monday

            // 1. Create Headers
            grid.insertAdjacentHTML('beforeend', '<div class="day-header-spacer"></div>');
            for (let i = 0; i < 7; i++) {
                const day = startOfWeek.clone().add(i, 'days');
                const isToday = day.isSame(moment(), 'day');
                const dayName = day.format('ddd');
                const dayNum = day.format('D');
                const todayClass = isToday ? 'today' : '';
                const headerHTML = `
            <div class="day-header ${todayClass}" data-day="${dayName.toLowerCase()}">
                <strong>${dayName}</strong>
                ${isToday ? `<span>${dayNum}</span>` : dayNum}
            </div>`;
                grid.insertAdjacentHTML('beforeend', headerHTML);
            }

            // 2. Create Time Slots (from 6 AM to 8 PM for example)
            for (let hour = 6; hour <= 20; hour++) {
                const timeLabel = moment({ hour }).format('ha');
                grid.insertAdjacentHTML('beforeend', `<div class="time-label">${timeLabel}</div>`);
                for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                    const day = startOfWeek.clone().add(dayIndex, 'days').format('dddd').toLowerCase();
                    const slotHTML = `<div class="time-slot" data-day="${day}" data-hour="${hour}"></div>`;
                    grid.insertAdjacentHTML('beforeend', slotHTML);
                }
            }
        }

        /**
         * Applies 'available' or 'unavailable' styles to the calendar time slots.
         * @param {object} operatingHours - The instructor's operating hours object from Firestore.
         */
        function renderCalendarAvailability(operatingHours = {}) {
            // First, set all slots to unavailable by default
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.add('slot-unavailable');
                slot.classList.remove('slot-available');
            });

            // Now, loop through the operating hours and mark available slots
            for (const day in operatingHours) {
                const slots = operatingHours[day];
                if (slots && slots.length > 0) {
                    const startHour = parseInt(slots[0].start.split(':')[0]);
                    const endHour = parseInt(slots[0].end.split(':')[0]);

                    // Apply the 'available' class to the slots within the time range
                    for (let hour = startHour; hour < endHour; hour++) {
                        const daySlot = document.querySelector(`.time-slot[data-day="${day}"][data-hour="${hour}"]`);
                        if (daySlot) {
                            daySlot.classList.remove('slot-unavailable');
                            daySlot.classList.add('slot-available');
                        }
                    }
                }
            }
        }

        // ADD THIS NEW FUNCTION
        /**
         * Clears old markers/circles and adds new ones based on the suburb list.
         * It assumes the global 'map' object has already been created.
         * @param {string[]} suburbs - An array of suburb names to display on the map.
         */
        function updateMapWithObjects(suburbs) {
            if (!map || typeof google === 'undefined') return;

            // This part is new: We'd need to keep track of old markers to remove them.
            // For simplicity now, we'll just recenter and redraw.
            // In a more complex app, you'd loop through an array of old markers and setMap(null).

            const defaultCenter = { lat: -33.8688, lng: 151.2093 };
            map.setCenter(defaultCenter);
            map.setZoom(10);

            if (!suburbs || suburbs.length === 0) return;

            const geocoder = new google.maps.Geocoder();
            const bounds = new google.maps.LatLngBounds();

            suburbs.forEach(suburb => {
                geocoder.geocode({ 'address': `${suburb}, NSW, Australia` }, (results, status) => {
                    if (status === 'OK') {
                        const location = results[0].geometry.location;
                        // Note: We are not creating a new map, just new markers and circles on the existing one.
                        new google.maps.Marker({ map: map, position: location, title: suburb });
                        new google.maps.Circle({
                            strokeColor: '#FFC700', strokeOpacity: 0.8, strokeWeight: 2,
                            fillColor: '#FFC700', fillOpacity: 0.25,
                            map: map, center: location, radius: 2000
                        });
                        bounds.extend(location);
                        map.fitBounds(bounds);
                    }
                });
            });
        }


        // --- START: FINAL AVAILABILITY SCRIPT ---

        /**
         * Loads the user's operating hours and populates the 7-day availability form.
         * @param {object} [hoursData={}] - The operatingHours map from the user's Firestore document.
         */
        function loadNewAvailability(hoursData = {}) {
            const container = document.getElementById('new-availability-container');
            if (!container) return;

            container.querySelectorAll('.availability-day-row').forEach(row => {
                const day = row.dataset.day;
                const daySlots = hoursData[day] || [];
                const isEnabled = daySlots.length > 0;

                const toggle = row.querySelector('.day-toggle');
                const startTimeInput = row.querySelector('.start-time');
                const endTimeInput = row.querySelector('.end-time');

                toggle.checked = isEnabled;
                startTimeInput.disabled = !isEnabled;
                endTimeInput.disabled = !isEnabled;
                row.classList.toggle('day-disabled', !isEnabled);

                if (isEnabled) {
                    startTimeInput.value = daySlots[0].start;
                    endTimeInput.value = daySlots[0].end;
                } else {
                    startTimeInput.value = '09:00';
                    endTimeInput.value = '17:00';
                }
            });
        }

        /**
         * Reads the current state of the 7-day availability form and saves it to Firestore.
         */
        async function saveAvailability() {
            if (!auth.currentUser) return alert('You must be logged in to save changes.');

            const uid = auth.currentUser.uid;
            const container = document.getElementById('new-availability-container');
            const newHoursData = {};

            container.querySelectorAll('.availability-day-row').forEach(row => {
                const day = row.dataset.day;
                const checkbox = row.querySelector('.day-toggle');

                if (checkbox.checked) {
                    const start = row.querySelector('.start-time').value;
                    const end = row.querySelector('.end-time').value;
                    newHoursData[day] = [{ start, end }];
                } else {
                    newHoursData[day] = [];
                }
            });

            try {
                await db.collection('users').doc(uid).update({ operatingHours: newHoursData });
                alert('✅ Availability updated successfully!');

                if (document.getElementById('instructor-calendar-view').classList.contains('active')) {
                    updateCalendarView(currentCalendarDate);
                }
            } catch (error) {
                console.error("Error saving availability: ", error);
                alert('❌ Failed to save changes. Please try again.');
            }
        }

        // This event listener ensures the HTML is fully loaded before attaching our controls.
        document.addEventListener('DOMContentLoaded', () => {
            const saveBtn = document.getElementById('save-availability-btn');
            const availabilityContainer = document.getElementById('new-availability-container');

            if (saveBtn) {
                saveBtn.addEventListener('click', saveAvailability);
            }

            if (availabilityContainer) {
                availabilityContainer.addEventListener('change', (e) => {
                    const target = e.target;
                    // This is the logic that fixes your problem: it listens for a change on the toggle.
                    if (target.classList.contains('day-toggle')) {
                        const dayRow = target.closest('.availability-day-row');
                        const isEnabled = target.checked;

                        // It then correctly enables or disables the time inputs in the same row.
                        dayRow.querySelector('.start-time').disabled = !isEnabled;
                        dayRow.querySelector('.end-time').disabled = !isEnabled;

                        dayRow.classList.toggle('day-disabled', !isEnabled);
                    }
                });
            }
        });


        /**
         * Fetches data and dynamically renders the learner's main dashboard.
         * @param {string} uid - The UID of the logged-in learner.
         */
        // --- START: REPLACE existing renderLearnerDashboard function ---
        /**
         * Fetches data and dynamically renders the learner's main dashboard,
         * including updating the review notification.
         * @param {string} uid - The UID of the logged-in learner.
         */
        async function renderLearnerDashboard(uid) {
            const instructorCard = document.getElementById('my-instructor-card');
            const detailsContent = document.getElementById('instructor-details-content');
            const noInstructorContent = document.getElementById('no-instructor-content');
            const dynamicBookingBtns = document.querySelectorAll('.dynamic-booking-btn');
            const notificationPopup = document.querySelector('.notification-popup'); // Get the notification popup

            if (!instructorCard) return;

            try {
                const learnerDoc = await db.collection('users').doc(uid).get();
                if (!learnerDoc.exists) return;

                const learnerData = learnerDoc.data();
                const instructorId = learnerData.instructorId;

                // --- Notification Update Logic ---
                const reviewLink = notificationPopup ? notificationPopup.querySelector('#leave-rating-link') : null;
                const reviewText = notificationPopup ? notificationPopup.querySelector('.popup-text p') : null;
                // --- End Notification Update Logic ---


                if (instructorId) {
                    const instructorDoc = await db.collection('users').doc(instructorId).get();
                    if (instructorDoc.exists) {
                        const instructor = instructorDoc.data();
                        const instructorName = instructor.firstName || 'Your Instructor';

                        dynamicBookingBtns.forEach(btn => {
                            btn.textContent = `Book with ${instructorName}`;
                            btn.dataset.id = instructorId;
                        });

                        document.getElementById('my-instructor-photo').src = instructor.instructorPhotoUrl || 'https://placehold.co/100x100?text=I';
                        document.getElementById('my-instructor-name').textContent = instructorName;
                        document.getElementById('my-instructor-price').textContent = `$${(instructor.pricing?.lesson || 70).toFixed(2)}/Hr`;
                        document.getElementById('my-vehicle-photo').src = instructor.vehiclePhotoUrl || 'https://placehold.co/100x100?text=Car';
                        document.getElementById('my-vehicle-name').textContent = `${instructor.vehicleMake || 'Vehicle'} ${instructor.vehicleModel || ''}`;

                        detailsContent.style.display = 'block';
                        noInstructorContent.style.display = 'none';

                        // --- Notification Update Logic ---
                        if (reviewLink && reviewText) {
                            reviewText.textContent = `How was your learning experience with ${instructorName}?`;
                            reviewLink.dataset.instructorId = instructorId; // Store ID on the link
                            reviewLink.dataset.instructorName = instructorName; // Store Name for rating page
                            notificationPopup.style.display = 'flex'; // Make sure it's visible if hidden
                        }
                        // --- End Notification Update Logic ---

                    } else {
                        // Instructor ID exists but document not found (edge case)
                        detailsContent.style.display = 'none';
                        noInstructorContent.style.display = 'block';
                        if (notificationPopup) notificationPopup.style.display = 'none'; // Hide notification
                    }
                } else {
                    dynamicBookingBtns.forEach(btn => {
                        btn.textContent = 'Find an Instructor to Book';
                        btn.removeAttribute('data-id');
                        btn.onclick = () => showView('switch-instructor-content');
                    });

                    detailsContent.style.display = 'none';
                    noInstructorContent.style.display = 'block';

                    // --- Notification Update Logic ---
                    // Hide the notification if no instructor is assigned
                    if (notificationPopup) notificationPopup.style.display = 'none';
                    // --- End Notification Update Logic ---
                }

            } catch (error) {
                console.error("Error rendering learner dashboard:", error);
                if (notificationPopup) notificationPopup.style.display = 'none'; // Hide on error
            }
        }
        // --- END: REPLACEMENT for renderLearnerDashboard function ---

        /**
         * Fetches and renders the current learner's upcoming bookings.
         * @param {string} uid - The UID of the logged-in learner.
         */


        // --- END: FINAL AVAILABILITY SCRIPT ---

        // Add these two new functions to your JavaScript

        /**
         * Takes an instructor's operating hours and applies styles to the availability modal.
         * @param {object} operatingHours - The instructor's operating hours object from Firestore.
         */
        function paintModalAvailability(operatingHours = {}) {
            const modalGrid = document.querySelector('#availability-modal .schedule-grid');
            if (!modalGrid) return;

            // Reset all slots to unavailable first
            modalGrid.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('slot-available'); // Use a new class for modal
                slot.classList.add('unavailable');
            });

            // Loop through the fetched hours and mark available slots
            for (const day in operatingHours) {
                const slotsForDay = operatingHours[day];
                if (slotsForDay && slotsForDay.length > 0) {
                    const startHour = parseInt(slotsForDay[0].start.split(':')[0]);
                    const endHour = parseInt(slotsForDay[0].end.split(':')[0]);

                    const dayIndex = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'].indexOf(day.substring(0, 3));

                    // This logic is specific to your modal's HTML structure
                    const dayColumn = modalGrid.querySelectorAll('.day-column')[dayIndex];
                    if (dayColumn) {
                        for (let hour = startHour; hour < endHour; hour++) {
                            // Calculate the correct time slot div to color (5am is the 1st, 6am is the 2nd, etc.)
                            const slotIndex = hour - 5;
                            if (slotIndex >= 0 && dayColumn.children[slotIndex + 1]) { // +1 to skip the header
                                const timeSlotDiv = dayColumn.children[slotIndex + 1];
                                timeSlotDiv.classList.remove('unavailable');
                                timeSlotDiv.classList.add('slot-available'); // Apply the green background
                            }
                        }
                    }
                }
            }
        }

        /**
         * Fetches data for a specific instructor and displays their availability in the modal.
         * @param {string} instructorId - The UID of the instructor to look up.
         */
        async function showAvailabilityForInstructor(instructorId) {
            const modal = document.getElementById('availability-modal');
            const modalTitle = modal.querySelector('h4');

            // Show a loading state and open the modal immediately
            modalTitle.textContent = 'Loading availability...';
            openModal(); // This is your existing function to make the modal visible

            try {
                const doc = await db.collection('users').doc(instructorId).get();
                if (!doc.exists) {
                    modalTitle.textContent = 'Instructor not found.';
                    return;
                }

                const instructor = doc.data();
                modalTitle.textContent = `To begin the booking process please select "Book with ${instructor.firstName}".`;

                // Call the helper function to color the grid
                paintModalAvailability(instructor.operatingHours);

            } catch (error) {
                console.error("Error fetching availability:", error);
                modalTitle.textContent = 'Could not load availability.';
            }
        }

        // --- START: ADD THIS NEW FUNCTION FOR LEARNER BOOKING HISTORY ---
        /**
         * Fetches and renders the current learner's past (completed or cancelled) bookings.
         * @param {string} uid - The UID of the logged-in learner.
         */
        async function renderLearnerBookingHistory(uid) {
            const historyContent = document.getElementById('history-content');
            if (!historyContent) return;

            // The container where the rows will be injected
            const historyTable = historyContent.querySelector('.booking-history-table');

            // 1. Show a loading state
            historyTable.innerHTML = `
        <div class="history-header">
            <div>Booking</div><div>Instructor</div><div>Date</div><div>Time</div><div>Location</div><div>Status</div><div>Payment</div>
        </div>
        <div class="history-row" style="text-align: center; display: block; padding: 20px;">
            Loading your past bookings...
        </div>
    `;

            try {
                // 2. Fetch all completed or cancelled bookings for this learner, newest first
                const snapshot = await db.collection('bookings')
                    .where('learnerId', '==', uid)
                    .where('status', 'in', ['COMPLETED', 'CANCELLED'])
                    .orderBy('createdAt', 'desc')
                    .get();

                // 3. Clear the loading message and prepare to build the list
                historyTable.innerHTML = `
            <div class="history-header">
                <div>Booking</div><div>Instructor</div><div>Date</div><div>Time</div><div>Location</div><div>Status</div><div>Payment</div>
            </div>
        `;

                if (snapshot.empty) {
                    historyTable.innerHTML += `<div class="history-row" style="text-align: center; display: block; padding: 20px;">You have no past bookings.</div>`;
                    return;
                }

                // 4. Loop through the results and create an HTML row for each one
                for (const doc of snapshot.docs) {
                    const booking = doc.data();
                    const bookingId = doc.id;

                    // Fetch the instructor's photo for a nicer display
                    const instructorDoc = await db.collection('users').doc(booking.instructorId).get();
                    const photoUrl = instructorDoc.exists ? instructorDoc.data().instructorPhotoUrl : 'https://placehold.co/100x100?text=I';

                    // Determine the CSS class for the status badge
                    const statusClass = booking.status.toLowerCase() === 'completed' ? 'status-completed' : 'status-cancelled';

                    const rowHtml = `
                <div class="history-row">
                    <div class="history-cell" data-label="Booking"><a href="#" class="booking-id-link">#${bookingId.substring(0, 7)}</a></div>
                    <div class="history-cell instructor-cell" data-label="Instructor">
                        <img src="${photoUrl}" alt="${booking.instructorName}">
                        <span>${booking.instructorName || 'Instructor'}</span>
                    </div>
                    <div class="history-cell" data-label="Date">${booking.date}</div>
                    <div class="history-cell" data-label="Time">${booking.startTime}</div>
                    <div class="history-cell" data-label="Location">${booking.pickupLocation}</div>
                    <div class="history-cell" data-label="Status"><span class="status-badge ${statusClass}">${booking.status}</span></div>
                    <div class="history-cell" data-label="Payment"><span class="status-badge status-processed">PROCESSED</span></div>
                </div>
            `;
                    historyTable.insertAdjacentHTML('beforeend', rowHtml);
                }

            } catch (error) {
                console.error("Error fetching learner booking history:", error);
                historyTable.innerHTML += `<div class="history-row" style="text-align: center; display: block; padding: 20px; color: red;">Could not load booking history.</div>`;
            }
        }
        // --- END: NEW FUNCTION FOR LEARNER BOOKING HISTORY ---
        // --- END: OPERATING HOURS SCRIPT BLOCK ---
        // Add this block to attach the listener correctly
        document.addEventListener('DOMContentLoaded', () => {
            const personalDetailsForm = document.getElementById('personal-details-form');
            if (personalDetailsForm) {
                // This is a safe way to remove any old, conflicting listeners
                const newForm = personalDetailsForm.cloneNode(true);
                personalDetailsForm.parentNode.replaceChild(newForm, personalDetailsForm);

                // Now, add our single, correct listener
                newForm.addEventListener('submit', savePersonalDetails);
            }
        });
    </script>

    <script>
        // --- START: OVERRIDE SCRIPT FOR AVAILABILITY ---
        window.onload = function () {
            const availabilityContainer = document.getElementById('new-availability-container');

            if (availabilityContainer) {
                console.log("Fix script is running!");

                // 1. Force-correct the initial state of the inputs on page load
                availabilityContainer.querySelectorAll('.availability-day-row').forEach(row => {
                    const toggle = row.querySelector('.day-toggle');
                    const isEnabled = toggle.checked;

                    // This fixes the visual bug where inputs are greyed out even if the toggle is on
                    row.querySelector('.start-time').disabled = !isEnabled;
                    row.querySelector('.end-time').disabled = !isEnabled;
                });

                // 2. Add a new, reliable event listener to handle clicks
                // This will take priority because it's loaded last.
                availabilityContainer.addEventListener('change', (e) => {
                    if (e.target.classList.contains('day-toggle')) {
                        const dayRow = e.target.closest('.availability-day-row');
                        const isEnabled = e.target.checked;

                        // This makes the toggles work when you click them
                        dayRow.querySelector('.start-time').disabled = !isEnabled;
                        dayRow.querySelector('.end-time').disabled = !isEnabled;
                        dayRow.classList.toggle('day-disabled', !isEnabled);
                    }
                });
            }
        };

    // --- END: OVERRIDE SCRIPT ---
    </script>
    <script>
        // --- START: OVERRIDE SCRIPT FOR SAVE BUTTON ---
        window.addEventListener('load', function () {
            const saveButton = document.getElementById('save-availability-btn');

            if (saveButton) {
                console.log("Save button fix script is running!");

                // 1. We define the correct save function here, inside a protected scope
                //    so the other broken scripts can't interfere with it.
                const correctSaveFunction = async function () {
                    if (!auth.currentUser) {
                        return alert('You must be logged in to save changes.');
                    }

                    const uid = auth.currentUser.uid;
                    const container = document.getElementById('new-availability-container');
                    const newHoursData = {};

                    container.querySelectorAll('.availability-day-row').forEach(row => {
                        const day = row.dataset.day;
                        const checkbox = row.querySelector('.day-toggle');

                        if (checkbox.checked) {
                            const start = row.querySelector('.start-time').value;
                            const end = row.querySelector('.end-time').value;
                            newHoursData[day] = [{ start: start, end: end }];
                        } else {
                            newHoursData[day] = [];
                        }
                    });

                    try {
                        await db.collection('users').doc(uid).update({ operatingHours: newHoursData });
                        alert('✅ Availability updated successfully!');
                    } catch (error) {
                        console.error("Error saving availability: ", error);
                        alert('❌ Failed to save changes. Please try again.');
                    }
                };

                // 2. This is a trick to remove all old, broken event listeners from the button.
                // We create a clean copy of the button.
                const cleanSaveButton = saveButton.cloneNode(true);
                saveButton.parentNode.replaceChild(cleanSaveButton, saveButton);

                // 3. Finally, we attach our single, correct function to the clean button.
                cleanSaveButton.addEventListener('click', correctSaveFunction);
            }
        });


    // --- END: OVERRIDE SCRIPT FOR SAVE BUTTON ---
    </script>

    <script>
        // --- START: UPDATED OVERRIDE SCRIPT FOR REMOVING SUBURBS ---
        window.addEventListener('load', function () {
            const tagsContainer = document.getElementById('location-tags-container');

            if (tagsContainer) {
                console.log("UPDATED Remove suburb fix script is running!");

                tagsContainer.addEventListener('click', async function (event) {
                    if (event.target.classList.contains('remove-suburb-btn')) {
                        const suburbToRemove = event.target.dataset.suburb;
                        if (!suburbToRemove || !auth.currentUser) return;

                        const uid = auth.currentUser.uid;
                        const userRef = db.collection('users').doc(uid);

                        if (confirm(`Are you sure you want to remove "${suburbToRemove}"?`)) {
                            try {
                                // Step 1: Remove the suburb from the database (Same as before)
                                await userRef.update({
                                    servicedSuburbs: firebase.firestore.FieldValue.arrayRemove(suburbToRemove)
                                });

                                // Step 2: Remove the tag from the list (Same as before)
                                event.target.closest('.location-tag').remove();

                                // Step 3: **THE NEW FIX**
                                // After removing, get the fresh list of suburbs from the database.
                                const updatedDoc = await userRef.get();
                                const updatedSuburbs = updatedDoc.data().servicedSuburbs || [];

                                // Now, tell the existing map function to redraw with the new list.
                                updateMapWithObjects(updatedSuburbs);

                            } catch (error) {
                                console.error("Error removing suburb: ", error);
                                alert(`Failed to remove ${suburbToRemove}. Please try again.`);
                            }
                        }
                    }
                });
            }
        });



    // --- END: UPDATED OVERRIDE SCRIPT FOR REMOVING SUBURBS ---
    </script>

    <script>
        // --- START: INSTRUCTOR FILTERING LOGIC (FINAL CORRECTED FIX) ---
        window.addEventListener('load', function () {

            let allFetchedInstructors = [];
            const instructorGrid = document.querySelector('#switch-instructor-content .instructor-grid');
            const instructorCounter = document.querySelector('#switch-instructor-content h3');

            const transmissionFilter = document.getElementById('transmission-filter');
            const languageFilter = document.getElementById('language-filter');
            const regionInput = document.getElementById('region-input');
            const regionSearchBtn = document.getElementById('region-search-btn');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const timeFilterBtns = document.querySelectorAll('[data-time-filter]');


            function initFilterAutocomplete() {
                if (!regionInput || typeof google === 'undefined') return;
                const options = { types: ['(regions)'], componentRestrictions: { country: 'au' } };
                const autocomplete = new google.maps.places.Autocomplete(regionInput, options);
                autocomplete.addListener('place_changed', applyAllFilters);
            }

            function renderFilteredInstructors(instructors) {
                if (!instructorGrid || !instructorCounter) return;
                instructorGrid.innerHTML = '';
                instructorCounter.textContent = `${instructors.length} Auto instructors available in the next 7 days`;
                if (instructors.length === 0) {
                    instructorGrid.innerHTML = '<p>No instructors match your criteria.</p>';
                    return;
                }
                instructors.forEach(instructor => {
                    const data = instructor.data;
                    const id = instructor.id;
                    // **THE FIX IS HERE**: The 'open-booking-btn' now has a data-id attribute
                    const instructorCardHTML = `
                <div class="instructor-card-new" data-id="${id}">
                    <div class="instructor-photo-new"><img src="${data.instructorPhotoUrl || 'https://placehold.co/100x100?text=I'}" alt="Instructor ${data.firstName}"></div>
                    <div class="instructor-details-new">
                        <h4>${data.firstName || 'Instructor'}</h4>
                        <p class="instructor-meta price">$${(data.pricing?.lesson || 70).toFixed(2)} / hr</p>
                        <p class="instructor-meta"><i class="fas fa-star"></i> New Instructor</p> 
                        <p class="instructor-meta"><i class="fas fa-check-circle"></i> Verified Instructor</p>
                        <a href="#" class="availability-link" data-id="${id}"><strong>Check Availability ></strong></a>
                    </div>
                    <div class="instructor-actions-new" style="flex-direction: row; align-items: center; justify-content: space-between;">
                        <button class="btn btn-secondary view-profile-btn" data-id="${id}">View Profile</button>
                        <button class="btn btn-primary open-booking-btn" data-id="${id}">Book Online Now</button>
                    </div>
                </div>
            `;
                    instructorGrid.insertAdjacentHTML('beforeend', instructorCardHTML);
                });
            }

            function applyAllFilters() {
                let filteredList = [...allFetchedInstructors];

                // Region/Suburb Filter
                const regionQuery = regionInput.value.trim().toLowerCase();
                if (regionQuery) {
                    const searchTermSimple = regionQuery.split(',')[0].trim();

                    filteredList = filteredList.filter(inst => {
                        if (!inst.data.servicedSuburbs) return false;

                        return inst.data.servicedSuburbs.some(suburb => {
                            const instructorSuburbSimple = suburb.toLowerCase().split(',')[0].trim();

                            // **THIS IS THE CORRECTED LOGIC**
                            // It checks if the user's (potentially long) search term starts with
                            // the instructor's (potentially short) suburb.
                            return searchTermSimple.startsWith(instructorSuburbSimple);
                        });
                    });
                }

                // Other filters
                const transmission = transmissionFilter.value;
                if (transmission && transmission !== 'any') {
                    filteredList = filteredList.filter(inst => inst.data.transmission === transmission);
                }
                const language = languageFilter.value;
                if (language && language !== 'any') {
                    filteredList = filteredList.filter(inst => inst.data.languages && inst.data.languages.includes(language));
                }

                renderFilteredInstructors(filteredList);
            }

            // --- REPLACE your existing initializeFilters function with this ---
            async function initializeFilters() {
                try {
                    // *** CHANGE: Added .where('verificationStatus', '==', 'verified') ***
                    // REPLACE IT WITH THIS:
                    const querySnapshot = await db.collection('users')
                        .where('role', '==', 'instructor')
                        .where('verificationStatus', '==', 'verified') // <-- This is the only change
                        .get();

                    allFetchedInstructors = querySnapshot.docs.map(doc => ({ id: doc.id, data: doc.data() }));
                    renderFilteredInstructors(allFetchedInstructors);
                    initFilterAutocomplete();
                    transmissionFilter.addEventListener('change', applyAllFilters);
                    languageFilter.addEventListener('change', applyAllFilters);
                    regionSearchBtn.addEventListener('click', applyAllFilters);
                    clearFiltersBtn.addEventListener('click', () => {
                        transmissionFilter.value = 'any';
                        languageFilter.value = 'any';
                        regionInput.value = '';
                        timeFilterBtns.forEach(btn => btn.classList.remove('active'));
                        document.querySelector('[data-time-filter="any"]').classList.add('active');
                        applyAllFilters();
                    });
                    timeFilterBtns.forEach(btn => {
                        btn.addEventListener('click', () => {
                            timeFilterBtns.forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            applyAllFilters();
                        });
                    });
                } catch (error) {
                    console.error("Error initializing instructor filters: ", error);
                }
            }

            const observer = new MutationObserver((mutationsList) => {
                for (const mutation of mutationsList) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const targetElement = mutation.target;
                        if (targetElement.id === 'switch-instructor-content' && targetElement.classList.contains('active')) {
                            if (allFetchedInstructors.length === 0) {
                                initializeFilters();
                            }
                        }
                    }
                }
            });
            const switchInstructorView = document.getElementById('switch-instructor-content');
            if (switchInstructorView) {
                observer.observe(switchInstructorView, { attributes: true });
            }
        });
// --- END: INSTRUCTOR FILTERING LOGIC (FINAL CORRECTED FIX) ---
    </script>
    <script>

        // --- START: FINAL, STABLE BOOKING FLOW (CORRECTED) ---
        document.addEventListener('DOMContentLoaded', () => {

            let instructorIdForBooking = null; // Stores the instructor ID for the current booking flow

            // This listener handles clicking "Book Now" on an instructor card
            document.body.addEventListener('click', function (e) {
                const bookingBtn = e.target.closest('.open-booking-btn');
                if (bookingBtn) {
                    e.preventDefault();
                    instructorIdForBooking = bookingBtn.dataset.id;
                    if (instructorIdForBooking) {
                        showPage('booking-page');
                        // Pre-fill the booking page with the selected instructor's details
                        renderBookingPageInstructor(instructorIdForBooking);
                    } else {
                        alert("Could not identify the instructor. Please try again.");
                    }
                }
            });

            // This listener handles the final confirmation on the booking page form
            const bookingForm = document.getElementById('booking-form');
            if (bookingForm) {
                bookingForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const currentUser = auth.currentUser;

                    if (!currentUser || !instructorIdForBooking) {
                        alert("Error: You must be logged in and have selected an instructor.");
                        return;
                    }

                    // 1. Gather all the data from the booking form
                    const dateDropdown = document.getElementById('available-dates');
                    const timeDropdown = document.getElementById('available-times');
                    const pickupLocationSelect = document.getElementById('pickup-location-select');

                    // This determines the end time based on the lesson type
                    const lessonType = document.querySelector('#booking-type-tabs .tab-link.active').dataset.lessonType;
                    let durationHours = 1;
                    if (lessonType.includes('2-hour')) {
                        durationHours = 2;
                    } else if (lessonType.includes('test-package')) {
                        durationHours = 2.5;
                    }
                    const startTime = moment(timeDropdown.value, 'h:mm a');
                    const endTime = startTime.clone().add(durationHours, 'hours').format('h:mm a');

                    // 2. Create the booking data object
                    const bookingData = {
                        instructorId: instructorIdForBooking,
                        learnerId: currentUser.uid,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        date: dateDropdown.value,
                        startTime: timeDropdown.value,
                        endTime: endTime,
                        pickupLocation: pickupLocationSelect.value,
                        lessonType: lessonType.replace('-', ' '),
                        status: 'CONFIRMED',
                        transmission: 'Auto' // This can be made dynamic later
                    };

                    // Fetch instructor and learner names to store in the booking for easier display later
                    try {
                        const instructorDoc = await db.collection('users').doc(instructorIdForBooking).get();
                        const learnerDoc = await db.collection('users').doc(currentUser.uid).get();
                        if (instructorDoc.exists) bookingData.instructorName = instructorDoc.data().firstName;
                        if (learnerDoc.exists) bookingData.learnerName = learnerDoc.data().firstName;
                    } catch (error) {
                        console.warn("Could not fetch user names for booking document.", error);
                    }


                    try {
                        // 3. **THE FIX**: Add the new booking document to the 'bookings' collection
                        await db.collection('bookings').add(bookingData);

                        // 4. Update the learner's profile with their chosen instructor
                        await db.collection('users').doc(currentUser.uid).update({
                            instructorId: instructorIdForBooking
                        });

                        alert('✅ Booking Confirmed! Your appointment has been saved.');

                        // 5. Reset and navigate back to the dashboard
                        await renderLearnerDashboard(currentUser.uid); // Refresh the dashboard
                        showPage('dashboard-page');
                        showView('dashboard-main-content');
                        instructorIdForBooking = null; // Clear the temporary ID

                    } catch (error) {
                        console.error("Error confirming booking:", error);
                        alert("❌ There was a problem confirming your booking. Please try again.");
                    }
                });
            }
        });
// --- END: FINAL, STABLE BOOKING FLOW (CORRECTED) ---
    </script>

    <script>
// --- START: CORRECTED LEARNER BOOKING TABS SCRIPT ---

// --- END: CORRECTED LEARNER BOOKING TABS SCRIPT ---
    </script>
    <script>
        // --- START: FINAL LEARNER BOOKING SCRIPT ---

        /**
         * Correctly fetches and renders ONLY the logged-in learner's upcoming bookings.
         * @param {string} uid - The UID of the logged-in learner.
         */
        async function renderLearnerUpcomingBookings(uid) {
            const upcomingContent = document.getElementById('upcoming-content');
            if (!upcomingContent) return;

            upcomingContent.innerHTML = '<p>Loading your bookings...</p>';

            try {
                const today = moment().startOf('day');
                // This query correctly filters for the specific learner's confirmed bookings.
                const bookingsSnapshot = await db.collection('bookings')
                    .where('learnerId', '==', uid)
                    .where('status', '==', 'CONFIRMED')
                    .get();

                let upcomingBookingsHTML = '';
                let hasUpcomingBookings = false;

                for (const doc of bookingsSnapshot.docs) {
                    const booking = doc.data();
                    const bookingDate = moment(booking.date, 'ddd, D MMM YYYY');

                    if (bookingDate.isSameOrAfter(today)) {
                        hasUpcomingBookings = true;
                        const instructorDoc = await db.collection('users').doc(booking.instructorId).get();
                        const instructorPhoto = instructorDoc.exists ? instructorDoc.data().instructorPhotoUrl : 'https://placehold.co/100x100?text=I';

                        upcomingBookingsHTML += `
                    <div class="card" style="margin-bottom: 15px; text-align: left;">
                        <div class="booking-item">
                            <div class="booking-item-main">
                                <div class="booking-item-section">
                                    <p>Instructor</p>
                                    <div class="instructor-cell">
                                        <img src="${instructorPhoto}" alt="Instructor">
                                        <span>${booking.instructorName || 'Instructor'}</span>
                                    </div>
                                </div>
                                <div class="booking-item-section">
                                    <p>Date & Time</p>
                                    <span>${booking.date}</span><br>
                                    <span style="font-weight: 400;">${booking.startTime}</span>
                                </div>
                                <div class="booking-item-section">
                                    <p>Lesson</p>
                                    <span>${booking.lessonType || 'Driving Lesson'}</span>
                                </div>
                            </div>
                            <div class="booking-item-actions">
                                <a href="#" class="btn btn-secondary btn-small" data-booking-id="${doc.id}">Manage</a>
                            </div>
                        </div>
                    </div>`;
                    }
                }
                upcomingContent.innerHTML = hasUpcomingBookings ? upcomingBookingsHTML : '<p>You have no upcoming bookings to view at this time.</p>';
            } catch (error) {
                console.error("Error fetching learner bookings:", error);
                upcomingContent.innerHTML = '<p style="color:red;">Could not load your bookings.</p>';
            }
        }

        // This is the corrected controller for the learner dashboard tabs.
        document.addEventListener('DOMContentLoaded', () => {
            const bookingSection = document.querySelector('#dashboard-page .booking-section');
            if (bookingSection) {
                const tabs = bookingSection.querySelector('.tabs');
                tabs.addEventListener('click', (e) => {
                    const clickedTab = e.target.closest('.tab-link');
                    if (!clickedTab) return;

                    const targetId = clickedTab.dataset.target;
                    bookingSection.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
                    clickedTab.classList.add('active');
                    bookingSection.querySelectorAll('.tab-pane').forEach(pane => pane.classList.toggle('active', pane.id === targetId));

                    if (targetId === 'upcoming-content') {
                        const currentUser = firebase.auth().currentUser;
                        if (currentUser) {
                            renderLearnerUpcomingBookings(currentUser.uid);
                        }
                    }
                    if (targetId === 'history-content') {
                        const currentUser = firebase.auth().currentUser;
                        if (currentUser) {
                            renderLearnerBookingHistory(currentUser.uid);
                        }
                    }

                });

            
            }
        });
// --- END: FINAL LEARNER BOOKING SCRIPT ---
    </script>

    <script>
        // --- START: FINAL OVERRIDE SCRIPT FOR BOOKING TABS ---
        window.addEventListener('load', function () {
            const bookingSection = document.querySelector('#dashboard-page .booking-section');
            if (!bookingSection) return;

            // This is the ONE AND ONLY correct function to get your bookings.
            // By defining it here, we make sure no other broken version is ever called.
            const getCorrectUpcomingBookings = async function (uid) {

                const upcomingContent = document.getElementById('upcoming-content');
                if (!upcomingContent) {
                    console.error("Debug: 'upcoming-content' div not found.");
                    return;
                }

                // --- Start of Debugging ---
                console.log(`%cDEBUGGING UPCOMING BOOKINGS`, 'color: blue; font-weight: bold;');
                console.log(`Step 1: Fetching bookings for learner UID: ${uid}`);

                upcomingContent.innerHTML = '<p>Loading upcoming bookings...</p>';

                try {
                    const today = moment().startOf('day');
                    console.log(`Step 2: Current date for comparison is: ${today.format('YYYY-MM-DD')}`);

                    // This is the Firestore query
                    const snapshot = await firebase.firestore().collection('bookings')
                        .where('learnerId', '==', uid)
                        .where('status', '==', 'CONFIRMED')
                        .get();

                    console.log(`Step 3: Firestore query completed. Found ${snapshot.size} confirmed booking(s) for this learner (before date filtering).`);

                    if (snapshot.empty) {
                        upcomingContent.innerHTML = '<p>You have no upcoming bookings to view at this time.</p>';
                        return;
                    }

                    let html = '';
                    let upcomingBookingCount = 0;

                    const bookingPromises = snapshot.docs.map(async (doc) => {
                        const booking = doc.data();
                        console.log(`- - - - \nProcessing booking ID: ${doc.id}`, booking);

                        // This part now handles different date types from Firestore
                        let bookingDate;
                        if (booking.date && typeof booking.date.toDate === 'function') { // Handles Firestore Timestamp
                            bookingDate = moment(booking.date.toDate());
                            console.log(`   > Date format is Timestamp. Parsed date: ${bookingDate.format('YYYY-MM-DD')}`);
                        } else if (typeof booking.date === 'string') { // Handles String date
                            bookingDate = moment(booking.date, 'ddd, D MMM YYYY');
                            console.log(`   > Date format is String. Parsed date: ${bookingDate.format('YYYY-MM-DD')}`);
                        } else {
                            console.warn(`   > SKIPPING: Booking ${doc.id} has an invalid or missing date field.`);
                            return null;
                        }

                        // Compares the booking date to today's date
                        const isUpcoming = bookingDate.isSameOrAfter(today);
                        console.log(`   > Is this booking upcoming? ${isUpcoming}`);

                        if (isUpcoming) {
                            upcomingBookingCount++;
                            const instructorDoc = await firebase.firestore().collection('users').doc(booking.instructorId).get();
                            const instructorPhoto = instructorDoc.exists && instructorDoc.data().instructorPhotoUrl ? instructorDoc.data().instructorPhotoUrl : 'https://placehold.co/100x100?text=I';

                            // Uses the original date string/object for display to preserve formatting
                            const displayDate = booking.date.toDate ? moment(booking.date.toDate()).format('ddd, D MMM YYYY') : booking.date;

                            return `
                    <div class="card" style="margin-bottom: 15px; padding: 0;">
                        <div class="booking-item">
                            <div class="booking-item-main">
                                <div class="booking-item-section instructor-cell" style="flex: 1.5;"><img src="${instructorPhoto}" alt="Instructor"><span>${booking.instructorName || 'Instructor'}</span></div>
                                <div class="booking-item-section" style="flex: 1.5;"><span>${displayDate}<br>${booking.startTime}</span></div>
                                <div class="booking-item-section" style="flex: 1;"><span>${booking.lessonType || 'Driving Lesson'}</span></div>
                            </div>
                            <div class="booking-item-actions"><a href="#" class="btn btn-secondary btn-small">Manage</a></div>
                        </div>
                    </div>`;
                        }
                        return null;
                    });

                    const results = (await Promise.all(bookingPromises)).filter(Boolean);
                    console.log(`Step 4: Finished processing. Found ${upcomingBookingCount} upcoming booking(s) to display.`);
                    html = results.join('');

                    upcomingContent.innerHTML = upcomingBookingCount > 0 ? html : '<p>You have no upcoming bookings to view at this time.</p>';

                } catch (error) {
                    console.error("FINAL DEBUG ERROR: An error occurred while fetching bookings.", error);
                    upcomingContent.innerHTML = `<p style="color:red;">Error loading bookings. Check the console (F12) for details.</p>`;
                }
            };

            // This part takes direct control of the tab buttons, overwriting any old scripts.
            const upcomingTab = bookingSection.querySelector('[data-target="upcoming-content"]');
            const servicesTab = bookingSection.querySelector('[data-target="services-content"]');
            const historyTab = bookingSection.querySelector('[data-target="history-content"]');

            const allTabs = [upcomingTab, servicesTab, historyTab];
            const allPanes = bookingSection.querySelectorAll('.tab-pane');

            if (upcomingTab) {
                upcomingTab.onclick = function (e) {
                    e.preventDefault(); e.stopPropagation(); // Stop all other scripts from running
                    allTabs.forEach(t => t.classList.remove('active'));
                    allPanes.forEach(p => p.classList.remove('active'));
                    upcomingTab.classList.add('active');
                    document.getElementById('upcoming-content').classList.add('active');

                    const user = firebase.auth().currentUser;
                    if (user) {
                        getCorrectUpcomingBookings(user.uid); // Call OUR correct function
                    }
                };
            }
            // We also take control of the other tabs to make sure they still work.
            if (servicesTab) {
                servicesTab.onclick = function (e) {
                    e.preventDefault(); e.stopPropagation();
                    allTabs.forEach(t => t.classList.remove('active'));
                    allPanes.forEach(p => p.classList.remove('active'));
                    servicesTab.classList.add('active');
                    document.getElementById('services-content').classList.add('active');
                };
            }
            if (historyTab) {
                historyTab.onclick = function (e) {
                    e.preventDefault(); e.stopPropagation();
                    allTabs.forEach(t => t.classList.remove('active'));
                    allPanes.forEach(p => p.classList.remove('active'));
                    historyTab.classList.add('active');
                    document.getElementById('history-content').classList.add('active');
                    const user = firebase.auth().currentUser;
                    if (user) {
                        renderLearnerBookingHistory(user.uid);
                    }
                };

            }
        });

        // --- ADD THIS NEW FUNCTION to your main script ---
        /**
         * Populates the 'Available Times' dropdown based on the instructor's schedule
         * for the selected date.
         * @param {string} selectedDateString - The date selected by the user (e.g., "Sat, 27 Sep 2025").
         */
        function populateAvailableTimesForDate(selectedDateString) {
            const timeDropdown = document.getElementById('available-times');
            timeDropdown.innerHTML = '<option value="">-</option>'; // Clear previous options and add a placeholder

            if (!selectedDateString) {
                timeDropdown.innerHTML = '<option value="">Select a date first</option>';
                return;
            }

            // 1. Figure out which day of the week was selected (e.g., "saturday")
            const selectedMoment = moment(selectedDateString, 'ddd, D MMM YYYY');
            const dayOfWeek = selectedMoment.format('dddd').toLowerCase();

            // 2. Get the instructor's hours for that specific day
            const availabilityForDay = currentInstructorAvailability[dayOfWeek];

            // 3. Check if the instructor works on that day
            if (!availabilityForDay || availabilityForDay.length === 0) {
                timeDropdown.innerHTML = '<option value="">No availability on this day</option>';
                return; // Stop the function
            }

            // 4. Generate the time slots
            const lessonType = document.querySelector('#booking-type-tabs .tab-link.active').dataset.lessonType;
            const lessonDurationHours = lessonType.includes('2-hour') ? 2 : 1;

            const startTime = moment(availabilityForDay[0].start, 'HH:mm');
            const endTime = moment(availabilityForDay[0].end, 'HH:mm');

            let timeSlot = startTime.clone();
            let slotsAdded = 0;

            while (timeSlot.clone().add(lessonDurationHours, 'hours').isSameOrBefore(endTime)) {
                const timeString = timeSlot.format('h:mm a');
                const option = document.createElement('option');
                option.value = timeString;
                option.textContent = timeString;
                timeDropdown.appendChild(option);

                slotsAdded++;
                timeSlot.add(30, 'minutes'); // Check for a new slot every 30 minutes
            }

            if (slotsAdded === 0) {
                timeDropdown.innerHTML = '<option value="">No availability on this day</option>';
            }
        }
// --- END: FINAL OVERRIDE SCRIPT ---
    </script>

    <script>
        function goToNextWeek() {
            currentCalendarDate.add(1, 'week');
            updateCalendarView(currentCalendarDate);
        }

        function goToPrevWeek() {
            currentCalendarDate.subtract(1, 'week');
            updateCalendarView(currentCalendarDate);
        }

        function goToToday() {
            currentCalendarDate = moment();
            updateCalendarView(currentCalendarDate);
        }

        // In your main <script> tag

        // You'll need to call this function after a new instructor successfully signs up
        // In your main <script> tag

        // You'll need to call this function after a new instructor successfully signs up
        // In your main <script> tag

        function showVerificationPage() {
            showPage('verification-page');
        }

        // --- START: NEW MULTI-STEP VERIFICATION LOGIC ---
        // --- START: NEW MANUAL-INPUT VERIFICATION LOGIC ---
        // --- START: AUTOMATIC VERIFICATION LOGIC (WITH TIMEOUTS) ---

        // --- START: REPLACEMENT FOR VERIFICATION LOGIC ---

        // --- START: REPLACEMENT FOR VERIFICATION LOGIC ---

        let firestoreListener = null;
        const uploadStatus = document.getElementById('upload-status');

        // --- Helper Functions ---

        function showVerificationStep(stepId) {
            document.querySelectorAll('.verification-step').forEach(step => step.classList.remove('active'));

            const stepElement = document.getElementById(stepId);
            if (stepElement) {
                stepElement.classList.add('active');

                // **FIX 1**: Re-enable all buttons within the newly shown step.
                // This ensures the "Upload" button works again after a "Retake".
                stepElement.querySelectorAll('button').forEach(btn => btn.disabled = false);
            }

            uploadStatus.textContent = ''; // Clear status messages

            const steps = ['dl', 'il', 'wwc', 'vr'];
            const currentStepIndex = steps.indexOf(stepId.split('-')[1]);

            steps.forEach((index, step) => {
                const indicator = document.getElementById(`progress-${steps[index]}`);
                if (!indicator) return;
                indicator.classList.remove('active', 'complete');
                if (index < currentStepIndex) {
                    indicator.classList.add('complete');
                } else if (index === currentStepIndex) {
                    indicator.classList.add('active');
                }
            });
        }

        // --- START: REPLACEMENT FOR handleFileUpload ---
        /**
         * Handles file upload, gets the URL, and saves it to Firestore.
         * @param {File} file The file to upload.
         * @param {string} path The path in Firebase Storage.
         * @param {HTMLElement} button The button that was clicked.
         * @param {string} urlFieldName The name of the field to save the URL to in Firestore (e.g., 'driverLicenseUrl').
         */
        async function handleFileUpload(file, path, button, urlFieldName) {
            const user = auth.currentUser;
            if (!user) return;

            uploadStatus.style.color = 'var(--dark-color)';
            uploadStatus.textContent = 'Uploading...';
            button.disabled = true;
            if (button.nextElementSibling) button.nextElementSibling.disabled = true; // Disable skip button

            const storageRef = firebase.storage().ref(path);
            try {
                // Step 1: Upload the file
                await storageRef.put(file);

                // Step 2: Get the public URL of the uploaded file
                const downloadURL = await storageRef.getDownloadURL();

                // Step 3: Save that URL to the user's document in Firestore
                await db.collection('users').doc(user.uid).update({
                    [urlFieldName]: downloadURL
                });

                uploadStatus.textContent = '✅ Upload complete! Reading document... This can take up to 20 seconds.';
                return true; // Indicate success

            } catch (error) {
                console.error("Upload or URL save failed:", error);
                uploadStatus.textContent = 'Upload failed. Please try again.';
                button.disabled = false;
                if (button.nextElementSibling) button.nextElementSibling.disabled = false;
                return false; // Indicate failure
            }
        }
        // --- END: REPLACEMENT FOR handleFileUpload ---

        function showConfirmation(docData, fieldsToConfirm, nextStep, verificationFlagName, previousStepId) {
            const confirmFieldsContainer = document.getElementById('confirmation-fields');
            confirmFieldsContainer.innerHTML = '';

            fieldsToConfirm.forEach(field => {
                const label = field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                const value = docData[field] || 'Not found';
                confirmFieldsContainer.innerHTML += `
            <div class="input-group">
                <label>${label}</label>
                <input type="text" value="${value}" readonly style="background-color: #f1f1f1;">
            </div>`;
            });

            showVerificationStep('confirm-step-container');

            const confirmBtn = document.getElementById('confirm-details-btn');
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

            newConfirmBtn.onclick = async () => {
                const user = auth.currentUser;
                if (!user) return;

                const dataToSave = { [verificationFlagName]: true };
                fieldsToConfirm.forEach(field => { dataToSave[field] = docData[field]; });

                await db.collection('users').doc(user.uid).update(dataToSave);
                initializeVerificationFlow(); // Rerun flow to find next step
            };

            const retakeBtn = document.getElementById('retake-image-btn');
            const newRetakeBtn = retakeBtn.cloneNode(true);
            retakeBtn.parentNode.replaceChild(newRetakeBtn, retakeBtn);

            newRetakeBtn.onclick = (e) => {
                e.preventDefault();
                showVerificationStep(previousStepId);
            };
        }

        // --- FIX 1: NEW HELPER FUNCTION to show/hide dashboard content ---
        // This centralizes the logic for displaying the correct content after verification.
        function renderInstructorDashboardView(uid) {
            db.collection('users').doc(uid).get().then(doc => {
                if (!doc.exists) return;
                const userData = doc.data();
                const instructorMainDashboard = document.getElementById('instructor-main-dashboard');
                const verificationPrompt = document.getElementById('verification-prompt-card');

                if (userData.verificationStatus === 'verified') {
                    // If verified, show the normal dashboard content and hide the prompt
                    if (instructorMainDashboard) instructorMainDashboard.style.display = 'block';
                    if (verificationPrompt) verificationPrompt.style.display = 'none';
                    renderUpcomingBookings(uid); // Also render the bookings
                } else {
                    // If not verified, hide the normal dashboard and show the prompt
                    if (instructorMainDashboard) instructorMainDashboard.style.display = 'none';
                    if (verificationPrompt) verificationPrompt.style.display = 'block';
                }
            });
        }


        // --- FIX 2: REPLACEMENT for initializeVerificationFlow ---
        // This function is now async to handle the database update properly.
        // --- REPLACE your existing initializeVerificationFlow function with this ---
        async function initializeVerificationFlow() {
            const user = auth.currentUser;
            if (!user) return;

            const doc = await db.collection('users').doc(user.uid).get();
            const data = doc.data() || {};

            if (!data.dlVerified && !data.dlSkipped) {
                showVerificationStep('driver-license-step');
            } else if (!data.ilVerified && !data.ilSkipped) {
                showVerificationStep('instructor-license-step');
            } else if (!data.wwcVerified && !data.wwcSkipped) {
                showVerificationStep('wwc-step');
            } else if (!data.vrVerified && !data.vrSkipped) {
                showVerificationStep('vehicle-rego-step');
            } else {
                const allDocsAreVerified = data.dlVerified && data.ilVerified && data.wwcVerified && data.vrVerified;

                if (allDocsAreVerified) {
                    // *** CHANGE: Set status to 'pending_review' instead of 'verified' ***
                    await db.collection('users').doc(user.uid).update({ verificationStatus: 'pending_review' });

                    // Show a "pending review" message instead of "All Verified"
                    const allVerifiedStep = document.getElementById('all-verified-step');
                    allVerifiedStep.querySelector('h2').textContent = '📄 Documents Submitted for Review';
                    allVerifiedStep.querySelector('p').textContent = 'Thank you. Your documents have been submitted for review. You will be notified once your account is approved. You will now be redirected to your dashboard.';
                    showVerificationStep('all-verified-step');

                    setTimeout(() => {
                        showPage('instructor-dashboard-page');
                        showInstructorView('instructor-dashboard-view');
                        renderInstructorDashboardView(user.uid);
                    }, 3500); // Increased delay

                } else {
                    showPage('instructor-dashboard-page');
                    showInstructorView('instructor-dashboard-view');
                    renderInstructorDashboardView(user.uid);
                }
            }
        }

        function listenForDocChange(uid, verificationFlag, callback, button) {
            let listenerActive = true;

            const timeoutId = setTimeout(() => {
                if (listenerActive) {
                    listenerActive = false;
                    if (firestoreListener) firestoreListener();
                    uploadStatus.style.color = 'red';
                    uploadStatus.textContent = 'Error: Timed out. Please upload a clearer image or try again.';
                    button.disabled = false;
                    if (button.nextElementSibling) button.nextElementSibling.disabled = false;
                }
            }, 60000); // 60-second timeout

            firestoreListener = db.collection('users').doc(uid).onSnapshot(doc => {
                if (!listenerActive) return;
                const data = doc.data();

                // This now checks for a simple boolean flag, e.g., `dlVerified: true`
                if (data && data[verificationFlag] === true) {
                    listenerActive = false;
                    clearTimeout(timeoutId);
                    if (firestoreListener) firestoreListener();
                    callback(data);
                }
            });
        }

        // --- Event Listeners for Upload Buttons ---

        document.getElementById('submit-license-btn')?.addEventListener('click', async () => {
            const user = auth.currentUser;
            const file = document.getElementById('license-upload').files[0];
            const button = document.getElementById('submit-license-btn');
            if (!user || !file) return alert('Please select a file.');

            // Pass 'driverLicenseUrl' as the fourth argument
            const success = await handleFileUpload(file, `licenses/${user.uid}/driver_license.jpg`, button, 'driverLicenseUrl');

            if (success) {
                listenForDocChange(user.uid, 'dlVerified', (data) => {
                    showConfirmation(data, ['licenseExpiry'], 'instructor-license-step', 'dlVerified', 'driver-license-step');
                }, button);
            }
        });

        document.getElementById('submit-instructor-license-btn')?.addEventListener('click', async () => {
            const user = auth.currentUser;
            const file = document.getElementById('instructor-license-upload').files[0];
            const button = document.getElementById('submit-instructor-license-btn');
            if (!user || !file) return alert('Please select a file.');

            // Pass 'instructorLicenseUrl' as the fourth argument
            const success = await handleFileUpload(file, `licenses/${user.uid}/instructor_license.jpg`, button, 'instructorLicenseUrl');

            if (success) {
                listenForDocChange(user.uid, 'ilVerified', (data) => {
                    showConfirmation(data, ['instructorLicenseExpiry'], 'wwc-step', 'ilVerified', 'instructor-license-step');
                }, button);
            }
        });

        document.getElementById('submit-wwc-btn')?.addEventListener('click', async () => {
            const user = auth.currentUser;
            const file = document.getElementById('wwc-upload').files[0];
            const button = document.getElementById('submit-wwc-btn');
            if (!user || !file) return alert('Please select a file.');

            // Pass 'wwcCheckUrl' as the fourth argument
            const success = await handleFileUpload(file, `licenses/${user.uid}/wwc_check.jpg`, button, 'wwcCheckUrl');

            if (success) {
                listenForDocChange(user.uid, 'wwcVerified', (data) => {
                    showConfirmation(data, ['wwcNumber', 'wwcExpiry'], 'vehicle-rego-step', 'wwcVerified', 'wwc-step');
                }, button);
            }
        });

        document.getElementById('submit-rego-btn')?.addEventListener('click', async () => {
            const user = auth.currentUser;
            const file = document.getElementById('rego-upload').files[0];
            const button = document.getElementById('submit-rego-btn');
            if (!user || !file) return alert('Please select a file.');

            // Pass 'vehicleRegoUrl' as the fourth argument
            const success = await handleFileUpload(file, `licenses/${user.uid}/vehicle_rego.jpg`, button, 'vehicleRegoUrl');

            if (success) {
                listenForDocChange(user.uid, 'vrVerified', (data) => {
                    showConfirmation(data, ['plateNumber', 'regoExpiry'], 'finish', 'vrVerified', 'vehicle-rego-step');
                }, button);
            }
        });

        // Listener for all "Skip" buttons
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('skip-verification-btn')) {
                const user = auth.currentUser;
                if (!user) return;

                const currentStep = e.target.closest('.verification-step');
                let updateData = {};

                switch (currentStep.id) {
                    case 'driver-license-step':
                        updateData = { dlSkipped: true };
                        break;
                    case 'instructor-license-step':
                        updateData = { ilSkipped: true };
                        break;
                    case 'wwc-step':
                        updateData = { wwcSkipped: true };
                        break;
                    case 'vehicle-rego-step':
                        updateData = { vrSkipped: true };
                        break;
                }

                try {
                    await db.collection('users').doc(user.uid).update(updateData);
                    initializeVerificationFlow(); // Rerun the flow
                } catch (error) {
                    console.error("Error skipping step:", error);
                    alert("Could not skip this step. Please try again.");
                }
            }
        });

        function showVerificationPage() {
            showPage('verification-page');
            initializeVerificationFlow();
        }

        // --- END: REPLACEMENT FOR VERIFICATION LOGIC ---
        // --- END: NEW MANUAL-INPUT VERIFICATION LOGIC ---
        // --- END: NEW VERIFICATION FLOW LOGIC ---
        // --- START: ADD FOR SUPER ADMIN FUNCTIONALITY ---

        /**
         * Fetches and displays instructors pending verification on the super admin dashboard.
         */
        async function renderSuperAdminDashboard() {
            const listContainer = document.getElementById('pending-instructors-list');
            if (!listContainer) return;

            listContainer.innerHTML = '<div class="instructor-verification-row"><p>Loading...</p></div>';

            try {
                const snapshot = await db.collection('users')
                    .where('role', '==', 'instructor')
                    .where('verificationStatus', '==', 'pending_review')
                    .get();

                if (snapshot.empty) {
                    listContainer.innerHTML = '<div class="instructor-verification-row"><p>No instructors are currently pending verification.</p></div>';
                    return;
                }

                let listHtml = `
            <div class="instructor-verification-row instructor-verification-header">
                <div>Name</div>
                <div>Email</div>
                <div>Action</div>
            </div>`;

                snapshot.forEach(doc => {
                    const instructor = doc.data();
                    listHtml += `
                <div class="instructor-verification-row">
                    <div>${instructor.firstName || ''} ${instructor.surname || ''}</div>
                    <div>${instructor.email}</div>
                    <div>
                        <button class="btn btn-secondary btn-small view-verification-details" data-id="${doc.id}">View Details</button>
                    </div>
                </div>`;
                });
                listContainer.innerHTML = listHtml;

            } catch (error) {
                console.error("Error fetching pending instructors:", error);
                listContainer.innerHTML = '<div class="instructor-verification-row"><p style="color:red;">Could not load data.</p></div>';
            }
        }

        /**
         * Fetches a single instructor's details and shows them in the verification modal.
         * @param {string} instructorId The UID of the instructor to view.
         */
        async function showVerificationDetailsModal(instructorId) {
            const modal = document.getElementById('verification-details-modal');
            const modalBody = document.getElementById('verification-modal-body');
            const verifyBtn = document.getElementById('mark-verified-btn');
            if (!modal || !modalBody || !verifyBtn) return;

            modalBody.innerHTML = '<p>Loading details...</p>';
            modal.classList.add('active');

            try {
                const doc = await db.collection('users').doc(instructorId).get();
                if (!doc.exists) {
                    modalBody.innerHTML = '<p>Instructor not found.</p>';
                    return;
                }
                const data = doc.data();

                document.getElementById('verification-modal-title').textContent = `Verification for ${data.firstName} ${data.surname}`;

                modalBody.innerHTML = `
            <h4>Extracted Data</h4>
            <div class="form-row">
                <div class="input-group"><label>License Expiry</label><input type="text" readonly value="${data.licenseExpiry || 'N/A'}"></div>
                <div class="input-group"><label>Instructor License Expiry</label><input type="text" readonly value="${data.instructorLicenseExpiry || 'N/A'}"></div>
            </div>
            <div class="form-row">
                <div class="input-group"><label>WWC Number</label><input type="text" readonly value="${data.wwcNumber || 'N/A'}"></div>
                <div class="input-group"><label>WWC Expiry</label><input type="text" readonly value="${data.wwcExpiry || 'N/A'}"></div>
            </div>
            <div class="form-row">
                <div class="input-group"><label>Plate Number</label><input type="text" readonly value="${data.plateNumber || 'N/A'}"></div>
                <div class="input-group"><label>Rego Expiry</label><input type="text" readonly value="${data.regoExpiry || 'N/A'}"></div>
            </div>
            <hr style="margin: 20px 0;">
            <h4>Uploaded Documents</h4>
            <p>
                <a href="${data.driverLicenseUrl || '#'}" target="_blank" class="document-link"><i class="far fa-id-card"></i> View Driver's License</a> <br>
                <a href="${data.instructorLicenseUrl || '#'}" target="_blank" class="document-link"><i class="far fa-id-badge"></i> View Instructor License</a> <br>
                <a href="${data.wwcCheckUrl || '#'}" target="_blank" class="document-link"><i class="far fa-file-alt"></i> View WWC Document</a> <br>
                <a href="${data.vehicleRegoUrl || '#'}" target="_blank" class="document-link"><i class="far fa-file-image"></i> View Vehicle Registration</a>
            </p>
        `;

                // Set the instructor ID on the button to be used when clicked
                verifyBtn.dataset.id = instructorId;

            } catch (error) {
                console.error("Error fetching details for modal:", error);
                modalBody.innerHTML = '<p style="color:red;">Could not load details.</p>';
            }
        }

        /**
         * Updates an instructor's status to 'verified' in Firestore.
         * @param {string} instructorId The UID of the instructor to verify.
         */
        async function verifyInstructor(instructorId) {
            if (!instructorId) return;

            if (!confirm("Are you sure you want to verify this instructor? This will make their profile public to learners.")) {
                return;
            }

            try {
                await db.collection('users').doc(instructorId).update({
                    verificationStatus: 'verified'
                });
                alert('Instructor verified successfully!');
                document.getElementById('verification-details-modal').classList.remove('active');
                renderSuperAdminDashboard(); // Refresh the list
            } catch (error) {
                console.error("Error verifying instructor:", error);
                alert('Verification failed. Please try again.');
            }
        }

        // Event listener for the admin dashboard (delegated)
        document.getElementById('super-admin-page')?.addEventListener('click', (e) => {
            // Handle clicking the "View Details" button for an instructor
            if (e.target.classList.contains('view-verification-details')) {
                const instructorId = e.target.dataset.id;
                showVerificationDetailsModal(instructorId);
            }
        });

        // Event listener for the verification modal
        document.getElementById('verification-details-modal')?.addEventListener('click', (e) => {
            // Handle clicking the "Mark as Verified" button
            if (e.target.id === 'mark-verified-btn') {
                const instructorId = e.target.dataset.id;
                verifyInstructor(instructorId);
            }
            // Handle closing the modal
            if (e.target.classList.contains('modal-close-btn') || e.target.classList.contains('modal-overlay')) {
                e.currentTarget.classList.remove('active');
            }
        });
        // --- END: ADD FOR SUPER ADMIN FUNCTIONALITY ---

        // --- START: ADD FOR SUPER ADMIN CONTROLS ---

        /**
         * Main function to render the Controls view and handle its internal tabs.
         */
        function renderControlsView() {
            renderInstructorsControlList(); // Load instructors by default

            const controlsView = document.getElementById('super-admin-controls-view');
            const tabs = controlsView.querySelector('.tabs');

            // Use a flag to prevent adding the listener multiple times
            if (!tabs.dataset.listenerAttached) {
                tabs.addEventListener('click', (e) => {
                    const clickedTab = e.target.closest('.tab-link');
                    if (!clickedTab) return;

                    tabs.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
                    clickedTab.classList.add('active');

                    controlsView.querySelectorAll('.tab-pane').forEach(p => {
                        p.style.display = 'none';
                        p.classList.remove('active');
                    });
                    const targetPane = document.getElementById(clickedTab.dataset.target);
                    targetPane.style.display = 'block';
                    targetPane.classList.add('active');

                    if (clickedTab.dataset.target === 'instructor-controls-content') {
                        renderInstructorsControlList();
                    } else {
                        renderLearnersControlList();
                    }
                });
                tabs.dataset.listenerAttached = 'true';
            }
        }

        /**
 * Fetches and displays past completed bookings for all learners.
 *//**
        * Fetches and displays a list of all learners for the admin.
        */
        /**
 * Fetches and displays a list of all learners for the admin.
 */
async function renderAdminLearnerList() {
    const listContainer = document.getElementById('past-bookings-list');
    if (!listContainer) {
        console.error("Learner list container not found!");
        return;
    }

    // 1. Clear the container first, then show loading message
    listContainer.innerHTML = '<p style="padding: 20px; text-align: center;">Loading learners...</p>';

    try {
        // Query for all users with the role 'learner'
        const snapshot = await db.collection('users')
            .where('role', '==', 'learner')
            .orderBy('firstName') // Optional: Order alphabetically
            .get();

        if (snapshot.empty) {
            // 2. Clear container again before showing the 'empty' message
            listContainer.innerHTML = '<p style="padding: 20px; text-align: center;">No learners found in the system.</p>';
            return;
        }

        // 3. Build the HTML string starting ONLY with the header
        let listHtml = `
            <div class="user-control-header" style="grid-template-columns: 2fr 3fr 1fr;">
                <div>Name</div>
                <div>Email</div>
                <div>Action</div>
            </div>`;

        // 4. Loop through learners and append ONLY their row HTML
        snapshot.forEach(doc => {
            const learner = doc.data();
            const learnerId = doc.id;
            // Make sure to include data-learner-name for the modal title
            listHtml += `
                <div class="user-control-row" style="grid-template-columns: 2fr 3fr 1fr;">
                    <div>${learner.firstName || 'N/A'} ${learner.surname || ''}</div>
                    <div>${learner.email}</div>
                    <div>
                        <button class="btn btn-secondary btn-small view-learner-bookings-btn" data-learner-id="${learnerId}" data-learner-name="${learner.firstName || 'Learner'}">View Bookings</button>
                    </div>
                </div>`;
        });

        // 5. Replace the entire content of the container with the finished list HTML
        listContainer.innerHTML = listHtml;

    } catch (error) {
        console.error("Error fetching learners for admin:", error);
        // 6. Clear container before showing the error message
        listContainer.innerHTML = '<p style="padding: 20px; text-align: center; color: red;">Could not load learners.</p>';
    }
}

/**
 * Fetches and displays all bookings (past and upcoming) for a specific learner in a modal.
 * @param {string} learnerId - The UID of the learner whose bookings to show.
 * @param {string} learnerName - The name of the learner for the modal title.
 */
 async function showLearnerBookingsModal(learnerId, learnerName) {
    const modal = document.getElementById('learner-bookings-modal');
    const modalBody = document.getElementById('learner-bookings-modal-body');
    const modalTitle = document.getElementById('learner-bookings-modal-title');
    if (!modal || !modalBody || !modalTitle) {
        console.error("Learner bookings modal elements not found!"); // Added error log
        return;
    }

    modalTitle.textContent = `Bookings for ${learnerName}`;
    modalBody.innerHTML = '<p>Loading bookings...</p>';
    modal.classList.add('active'); // Show the modal

    try {
        const snapshot = await db.collection('bookings')
            .where('learnerId', '==', learnerId)
            .orderBy('createdAt', 'desc') // Order by creation time
            .get();

        if (snapshot.empty) {
            modalBody.innerHTML = '<p>No bookings found for this learner.</p>';
            return;
        }

        let bookingsHtml = `
             <div class="history-table-header" style="grid-template-columns: 1.5fr 1.5fr 1.2fr 1.2fr 1fr;">
                 <div>Instructor</div>
                 <div>Date</div>
                 <div>Time</div>
                 <div>Lesson Type</div>
                 <div>Status</div>
             </div>`;

        const today = moment().startOf('day');

        snapshot.forEach(doc => {
            const booking = doc.data();
            // Use createdAt for display date if available, otherwise fall back to booking.date
            const displayDate = booking.createdAt?.toDate ? moment(booking.createdAt.toDate()).format('ddd, D MMM YYYY') : (booking.date || 'N/A');

            let statusClass = 'status-pending'; // Default
            if (booking.status === 'COMPLETED') statusClass = 'status-completed';
            else if (booking.status === 'CONFIRMED') statusClass = 'status-confirmed';
            else if (booking.status === 'CANCELLED') statusClass = 'status-cancelled'; // Handle cancelled status

             // Determine if upcoming (Confirmed and on/after today)
             // Ensure booking.date exists and is a valid string for moment parsing
             let isUpcoming = false;
             if(booking.date && typeof booking.date === 'string'){
                 const bookingMoment = moment(booking.date, 'ddd, D MMM YYYY');
                 isUpcoming = booking.status === 'CONFIRMED' && bookingMoment.isValid() && bookingMoment.isSameOrAfter(today);
             } else if (booking.date && typeof booking.date.toDate === 'function') { // Handle Firestore Timestamp
                 const bookingMoment = moment(booking.date.toDate());
                  isUpcoming = booking.status === 'CONFIRMED' && bookingMoment.isSameOrAfter(today);
             }


            bookingsHtml += `
                 <div class="history-table-row" style="grid-template-columns: 1.5fr 1.5fr 1.2fr 1.2fr 1fr; ${isUpcoming ? 'background-color: #e8f5e9;' : ''}">
                     <div data-label="Instructor">${booking.instructorName || 'N/A'}</div>
                     <div data-label="Date">${displayDate}</div>
                     <div data-label="Time">${booking.startTime || 'N/A'}</div>
                     <div data-label="Lesson Type">${booking.lessonType || 'N/A'}</div>
                     <div data-label="Status"><span class="status-badge ${statusClass}">${booking.status || 'PENDING'}</span></div>
                 </div>`;
        });

        modalBody.innerHTML = bookingsHtml;

    } catch (error) {
        console.error(`Error fetching bookings for learner ${learnerId}:`, error);
        modalBody.innerHTML = '<p style="color: red;">Could not load bookings.</p>';
    }
}

/**
 * Fetches and displays all bookings (past and upcoming) for a specific instructor in a modal.
 * @param {string} instructorId - The UID of the instructor whose bookings to show.
 * @param {string} instructorName - The name of the instructor for the modal title.
 */
 async function showInstructorBookingsModal(instructorId, instructorName) {
    const modal = document.getElementById('instructor-bookings-modal');
    const modalBody = document.getElementById('instructor-bookings-modal-body');
    const modalTitle = document.getElementById('instructor-bookings-modal-title');
    if (!modal || !modalBody || !modalTitle) {
        console.error("Instructor bookings modal elements not found!");
        return;
    }

    modalTitle.textContent = `Bookings for ${instructorName}`;
    modalBody.innerHTML = '<p>Loading bookings...</p>';
    modal.classList.add('active'); // Show the modal

    try {
        // Query for all bookings associated with this instructor
        const snapshot = await db.collection('bookings')
            .where('instructorId', '==', instructorId)
            .orderBy('createdAt', 'desc') // Show newest first
            .get();

        if (snapshot.empty) {
            modalBody.innerHTML = '<p>No bookings found for this instructor.</p>';
            return;
        }

        let bookingsHtml = `
             <div class="history-table-header" style="grid-template-columns: 1.5fr 1.5fr 1.2fr 1.2fr 1fr;">
                 <div>Learner</div>
                 <div>Date</div>
                 <div>Time</div>
                 <div>Lesson Type</div>
                 <div>Status</div>
             </div>`;

        const today = moment().startOf('day');

        snapshot.forEach(doc => {
            const booking = doc.data();
            const displayDate = booking.createdAt?.toDate ? moment(booking.createdAt.toDate()).format('ddd, D MMM YYYY') : (booking.date || 'N/A');

            let statusClass = 'status-pending'; // Default
            if (booking.status === 'COMPLETED') statusClass = 'status-completed';
            else if (booking.status === 'CONFIRMED') statusClass = 'status-confirmed';
            else if (booking.status === 'CANCELLED') statusClass = 'status-cancelled';

            let isUpcoming = false;
            if (booking.date && typeof booking.date === 'string') {
                const bookingMoment = moment(booking.date, 'ddd, D MMM YYYY');
                isUpcoming = booking.status === 'CONFIRMED' && bookingMoment.isValid() && bookingMoment.isSameOrAfter(today);
            } else if (booking.date && typeof booking.date.toDate === 'function') {
                const bookingMoment = moment(booking.date.toDate());
                isUpcoming = booking.status === 'CONFIRMED' && bookingMoment.isSameOrAfter(today);
            }

            bookingsHtml += `
                 <div class="history-table-row" style="grid-template-columns: 1.5fr 1.5fr 1.2fr 1.2fr 1fr; ${isUpcoming ? 'background-color: #e8f5e9;' : ''}">
                     <div data-label="Learner">${booking.learnerName || 'N/A'}</div>
                     <div data-label="Date">${displayDate}</div>
                     <div data-label="Time">${booking.startTime || 'N/A'}</div>
                     <div data-label="Lesson Type">${booking.lessonType || 'N/A'}</div>
                     <div data-label="Status"><span class="status-badge ${statusClass}">${booking.status || 'PENDING'}</span></div>
                 </div>`;
        });

        modalBody.innerHTML = bookingsHtml;

    } catch (error) {
        console.error(`Error fetching bookings for instructor ${instructorId}:`, error);
        modalBody.innerHTML = '<p style="color: red;">Could not load bookings.</p>';
    }
}

        /**
         * Generic function to render a list of users (instructors or learners).
         */
        /**
         * Generic function to render a list of users (instructors or learners).
         * @param {string} role - 'learner' or 'instructor'
         * @param {string} containerSelector - The CSS selector for the container to fill
         * @param {string} [actionType='toggle'] - 'toggle' (default) or 'viewBookings'
         */
         async function renderUserControlList(role, containerSelector, actionType = 'toggle') {
            const container = document.querySelector(containerSelector);
            container.innerHTML = `<p style="padding: 20px;">Loading ${role}s...</p>`;

            try {
                const snapshot = await db.collection('users').where('role', '==', role).orderBy('firstName').get();
                if (snapshot.empty) {
                    container.innerHTML = `<p style="padding: 20px;">No ${role}s found.</p>`;
                    return;
                }

                let listHtml = `
            <div class="user-control-header">
                <div>Name</div>
                <div>Email</div>
                <div>Status</div>
                <div>Action</div>
            </div>`;

                snapshot.forEach(doc => {
                    const user = doc.data();
                    const uid = doc.id;
                    const status = user.accountStatus || 'active'; // Default to 'active'
                    const isChecked = status === 'active';

                    // --- THIS IS THE CONDITIONAL CHANGE ---
                    let actionCellHtml = '';
                    if (actionType === 'toggle') {
                        // Show the toggle switch for the "Controls" page
                        actionCellHtml = `
                            <label class="switch">
                                <input type="checkbox" class="account-status-toggle" data-uid="${uid}" ${isChecked ? 'checked' : ''}>
                                <span class="slider round"></span>
                            </label>`;
                    } else if (actionType === 'viewBookings') {
                        // Show the "View Bookings" button for the "Past Bookings" page
                        if (role === 'learner') {
                            actionCellHtml = `<button class="btn btn-secondary btn-small view-learner-bookings-btn" data-learner-id="${uid}" data-learner-name="${user.firstName || 'Learner'}">View Bookings</button>`;
                        } else if (role === 'instructor') {
                            actionCellHtml = `<button class="btn btn-secondary btn-small view-instructor-bookings-btn" data-instructor-id="${uid}" data-instructor-name="${user.firstName || 'Instructor'}">View Bookings</button>`;
                        }
                    }
                    // --- END OF CHANGE ---

                    listHtml += `
                <div class="user-control-row">
                    <div><a href="#" class="user-name-link" data-uid="${uid}">${user.firstName || 'N/A'} ${user.surname || ''}</a></div>
                    <div>${user.email}</div>
                    <div><span class="status-indicator ${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span></div>
                    <div>
                        ${actionCellHtml}
                    </div>
                </div>`;
                });
                container.innerHTML = listHtml;

            } catch (error) {
                console.error(`Error fetching ${role}s for controls:`, error);
                container.innerHTML = `<p style="padding: 20px; color: red;">Could not load ${role}s.</p>`;
            }
        }

     // --- Functions for "Controls" Tab ---
     function renderInstructorsControlList() {
        renderUserControlList('instructor', '#instructor-controls-content .card', 'toggle'); // Pass 'toggle'
    }
    function renderLearnersControlList() {
        renderUserControlList('learner', '#learner-controls-content .card', 'toggle'); // Pass 'toggle'
    }

    // --- Functions for "Past Bookings" Tab ---
    /**
     * Main function to render the Admin Bookings view and handle its internal tabs.
     */
    function renderAdminBookingsView() {
        // Load learners list by default
        renderAdminLearnerListForBookings();

        const bookingsView = document.getElementById('super-admin-past-bookings-view');
        const tabs = bookingsView.querySelector('.tabs');

        // Use a flag to prevent adding the listener multiple times
        if (!tabs.dataset.listenerAttached) {
            tabs.addEventListener('click', (e) => {
                const clickedTab = e.target.closest('.tab-link');
                if (!clickedTab) return;

                tabs.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
                clickedTab.classList.add('active');

                bookingsView.querySelectorAll('.tab-pane').forEach(p => {
                    p.style.display = 'none';
                    p.classList.remove('active');
                });
                const targetPane = document.getElementById(clickedTab.dataset.target);
                targetPane.style.display = 'block';
                targetPane.classList.add('active');

                if (clickedTab.dataset.target === 'admin-instructors-booking-tab') {
                    renderAdminInstructorListForBookings();
                } else {
                    renderAdminLearnerListForBookings();
                }
            });
            tabs.dataset.listenerAttached = 'true';
        }
    }
    
    // Helper to render learners in the 'Past Bookings' tab
    function renderAdminLearnerListForBookings() {
        renderUserControlList('learner', '#admin-learners-booking-tab .card', 'viewBookings');
    }
    
    // Helper to render instructors in the 'Past Bookings' tab
    function renderAdminInstructorListForBookings() {
        renderUserControlList('instructor', '#admin-instructors-booking-tab .card', 'viewBookings');
    }

        /**
         * Updates a user's account status in Firestore when a toggle is switched.
         */
        async function updateUserAccountStatus(uid, newStatus) {
            try {
                await db.collection('users').doc(uid).update({ accountStatus: newStatus });
                return true;
            } catch (error) {
                console.error("Error updating user status:", error);
                return false;
            }
        }

        // Delegated event listener for all toggle switches within the controls view
        document.getElementById('super-admin-controls-view')?.addEventListener('change', async (e) => {
            if (e.target.classList.contains('account-status-toggle')) {
                const toggle = e.target;
                const uid = toggle.dataset.uid;
                const newStatus = toggle.checked ? 'active' : 'disabled';
                const statusIndicator = toggle.closest('.user-control-row').querySelector('.status-indicator');

                toggle.disabled = true; // Prevent rapid clicking

                const success = await updateUserAccountStatus(uid, newStatus);

                if (success) {
                    statusIndicator.textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                    statusIndicator.className = `status-indicator ${newStatus}`;
                } else {
                    toggle.checked = !toggle.checked; // Revert switch on failure
                    alert('Failed to update user status. Please try again.');
                }

                toggle.disabled = false; // Re-enable toggle
            }
        });

        // --- END: ADD FOR SUPER ADMIN CONTROLS ---
        // --- START: ADD FOR USER DETAILS MODAL ---

        /**
         * Fetches user data from Firestore and displays it in the details modal.
         * @param {string} uid - The User ID of the user to display.
         */
        // --- START: REPLACE existing showUserDetailsModal function ---
        /**
         * Fetches user data from Firestore and displays it in the details modal, including reviews.
         * @param {string} uid - The User ID of the user to display.
         */
        async function showUserDetailsModal(uid) {
            const modal = document.getElementById('user-details-modal');
            const modalBody = document.getElementById('user-details-modal-body');
            const modalTitle = document.getElementById('user-details-modal-title');
            if (!modal || !modalBody || !modalTitle) return;

            modalBody.innerHTML = '<p>Loading details...</p>';
            modalTitle.textContent = 'User Details';
            modal.classList.add('active');

            try {
                const userDoc = await db.collection('users').doc(uid).get();
                if (!userDoc.exists) {
                    modalBody.innerHTML = '<p style="color: red;">User not found.</p>';
                    return;
                }
                const user = userDoc.data();
                modalTitle.textContent = `Details for ${user.firstName || ''} ${user.surname || ''}`;

                // --- Basic User Details ---
                let detailsHtml = `
                    <div class="detail-item"><strong>Role:</strong> ${user.role}</div>
                    <div class="detail-item"><strong>Email:</strong> ${user.email}</div>
                    <div class="detail-item"><strong>Mobile:</strong> ${user.mobile || 'N/A'}</div>
                    <div class="detail-item"><strong>Gender:</strong> ${user.gender || 'N/A'}</div>
                    <div class="detail-item"><strong>DOB:</strong> ${user.dob || 'N/A'}</div>
                    <div class="detail-item"><strong>Account Status:</strong> <span class="status-indicator ${user.accountStatus || 'active'}">${user.accountStatus || 'Active'}</span></div>
                `;

                // --- Instructor Specific Details ---
                if (user.role === 'instructor') {
                    detailsHtml += '<hr style="margin: 15px 0;"><h4>Instructor Info</h4>';
                    detailsHtml += `<div class="detail-item"><strong>Bio:</strong> ${user.bio || 'N/A'}</div>`;
                    detailsHtml += `<div class="detail-item"><strong>Languages:</strong> ${user.languages || 'N/A'}</div>`;
                    detailsHtml += `<div class="detail-item"><strong>Started Instructing:</strong> ${user.startYear || 'N/A'}</div>`;
                    detailsHtml += `<div class="detail-item"><strong>Transmission:</strong> ${user.transmission || 'N/A'}</div>`;
                    detailsHtml += `<div class="detail-item"><strong>Vehicle:</strong> ${user.vehicleMake || ''} ${user.vehicleModel || ''}</div>`;
                    detailsHtml += `<div class="detail-item"><strong>Verification Status:</strong> ${user.verificationStatus || 'N/A'}</div>`;
                    if (user.instructorPhotoUrl) { detailsHtml += `<div class="detail-item"><strong>Photo:</strong><br><img src="${user.instructorPhotoUrl}" class="user-photo-modal" alt="Instructor Photo"></div>`; }
                    if (user.vehiclePhotoUrl) { detailsHtml += `<div class="detail-item"><strong>Vehicle Photo:</strong><br><img src="${user.vehiclePhotoUrl}" class="user-photo-modal" alt="Vehicle Photo"></div>`; }
                }

                // --- Reviews Section (Common for both roles, but query differs) ---
                detailsHtml += '<hr style="margin: 15px 0;"><h4>Reviews</h4>';
                let reviewQuery;
                if (user.role === 'learner') {
                    // Find reviews WRITTEN BY this learner
                    reviewQuery = db.collection('reviews').where('learnerId', '==', uid).orderBy('createdAt', 'desc').limit(10);
                } else if (user.role === 'instructor') {
                    // Find reviews WRITTEN ABOUT this instructor
                    reviewQuery = db.collection('reviews').where('instructorId', '==', uid).orderBy('createdAt', 'desc').limit(10);
                }

                let reviewsHtml = '';
                if (reviewQuery) {
                    const reviewSnapshot = await reviewQuery.get();
                    if (reviewSnapshot.empty) {
                        reviewsHtml = `<p>No reviews found.</p>`;
                    } else {
                        reviewSnapshot.forEach(doc => {
                            const review = doc.data();
                            const reviewDate = review.createdAt ? moment(review.createdAt.toDate()).format('D MMM YYYY') : '';
                            let starsHtml = '';
                            for (let i = 1; i <= 5; i++) { starsHtml += i <= review.rating ? '★' : '☆'; }

                            reviewsHtml += `
                                <div style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px;">
                                    <div style="display: flex; justify-content: space-between; font-size: 13px; color: #757575;">
                                        <span>${user.role === 'learner' ? `To: ${review.instructorName}` : `From: ${review.learnerName}`}</span>
                                        <span>${reviewDate}</span>
                                    </div>
                                    <div style="color: var(--primary-color); margin: 3px 0;">${starsHtml} (${review.rating}/5)</div>
                                    ${review.feedbackText ? `<p style="font-size: 14px; margin: 5px 0 0 0;">${review.feedbackText}</p>` : ''}
                                </div>
                            `;
                        });
                    }
                } else {
                    reviewsHtml = '<p>Could not load reviews for this user role.</p>';
                }

                modalBody.innerHTML = detailsHtml + reviewsHtml; // Combine basic details + reviews

            } catch (error) {
                console.error("Error fetching user details/reviews for modal:", error);
                modalBody.innerHTML = '<p style="color: red;">Could not load user details or reviews.</p>';
            }
        }
        // --- END: REPLACEMENT for showUserDetailsModal function ---
        // Event listener for closing the user details modal
        document.getElementById('user-details-modal')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-close-btn') || e.target.classList.contains('modal-overlay')) {
                e.currentTarget.classList.remove('active');
            }
        });

        // Delegated event listener for clicking user names in the controls view
        document.getElementById('super-admin-controls-view')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('user-name-link')) {
                e.preventDefault();
                const uid = e.target.dataset.uid;
                if (uid) {
                    showUserDetailsModal(uid);
                }
            }
        });

        // --- START: ADD THIS NEW ACCOUNT SETTINGS SCRIPT ---

        /**
         * Loads current instructor account settings into the new form.
         */
        async function loadAccountSettings() {
            console.log("loadAccountSettings called");
            if (!auth.currentUser) return;
            const uid = auth.currentUser.uid;
            const form = document.getElementById('account-settings-form');
            if (!form) {
                console.error("Account settings form not found!");
                return;
            }

            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log("Loading data:", data);
                    form.querySelector('#as-first-name').value = data.firstName || '';
                    form.querySelector('#as-surname').value = data.surname || '';
                    form.querySelector('#as-email').value = data.email || ''; // Should already be there
                    form.querySelector('#as-mobile').value = data.mobile || '';
                    form.querySelector('#as-dob').value = data.dob || ''; // Assumes YYYY-MM-DD
                    form.querySelector('#as-gender').value = data.gender || '';
                    form.querySelector('#as-pincode').value = data.pincode || ''; // Add pincode if you use it

                    // Clear password fields when loading
                    form.querySelector('#as-new-password').value = '';
                    form.querySelector('#as-confirm-password').value = '';
                    form.querySelector('#as-current-password').value = '';
                }
            } catch (error) {
                console.error("Error loading account settings: ", error);
                alert("Could not load your account settings.");
            }
        }

        /**
         * Handles saving updated profile details and optional password change from the new form.
         * @param {Event} e - The form submission event.
         */
        async function updateAccountSettings(e) {
            e.preventDefault(); // Prevent default form submission
            console.log("--- updateAccountSettings started ---");

            const user = auth.currentUser;
            if (!user) {
                alert("Authentication error. Please log in again.");
                return;
            }
            console.log("Authenticated user:", user.uid);

            const form = document.getElementById('account-settings-form');
            if (!form) {
                console.error("Account settings form not found!");
                return;
            }

            // --- Part 1: Update Profile Details (Firestore) ---
            const updatedProfileData = {
                firstName: form.querySelector('#as-first-name').value.trim(),
                surname: form.querySelector('#as-surname').value.trim(),
                mobile: form.querySelector('#as-mobile').value.trim(),
                dob: form.querySelector('#as-dob').value.trim(), // Storing as YYYY-MM-DD
                gender: form.querySelector('#as-gender').value,
                pincode: form.querySelector('#as-pincode').value.trim() // Add pincode if needed
            };
            console.log("Profile data to save:", updatedProfileData);

            let profileUpdateSuccess = false;
            try {
                console.log("Attempting Firestore update...");
                await db.collection('users').doc(user.uid).update(updatedProfileData);
                console.log("Firestore profile update successful.");
                profileUpdateSuccess = true;
                // Update display name in header immediately
                const userNameElement = document.getElementById('instructor-user-name');
                if (userNameElement) userNameElement.textContent = updatedProfileData.firstName;

            } catch (error) {
                console.error("Firestore update FAILED:", error);
                alert("❌ Could not update your profile details. Check console.");
                // Optional: return;
            }

            // --- Part 2: Handle Password Change (Firebase Auth) ---
            const newPassword = form.querySelector('#as-new-password').value;
            const confirmPassword = form.querySelector('#as-confirm-password').value;
            const currentPassword = form.querySelector('#as-current-password').value;
            console.log(`Password fields - New: ${newPassword ? 'Filled' : 'Empty'}, Confirm: ${confirmPassword ? 'Filled' : 'Empty'}, Current: ${currentPassword ? 'Filled' : 'Empty'}`);

            if (newPassword) {
                console.log("Attempting password change...");
                if (newPassword !== confirmPassword) {
                    alert("❌ New passwords do not match."); return;
                }
                if (newPassword.length < 6) {
                    alert("❌ New password must be at least 6 characters."); return;
                }
                if (!currentPassword) {
                    alert("❌ Please enter your current password to change it."); return;
                }

                try {
                    const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
                    console.log("Attempting re-authentication...");
                    await user.reauthenticateWithCredential(credential);
                    console.log("Re-authentication successful.");

                    console.log("Attempting password update...");
                    await user.updatePassword(newPassword);
                    console.log("Firebase Auth password update successful.");
                    alert("✅ Password updated successfully!");

                    form.querySelector('#as-new-password').value = '';
                    form.querySelector('#as-confirm-password').value = '';
                    form.querySelector('#as-current-password').value = '';

                } catch (error) {
                    console.error("Password change FAILED:", error);
                    let errorMsg = "❌ Could not change password. ";
                    if (error.code === 'auth/wrong-password') errorMsg += "Incorrect current password.";
                    else if (error.code === 'auth/weak-password') errorMsg += "New password is too weak.";
                    else if (error.code === 'auth/requires-recent-login') errorMsg += "Security check failed. Please log out and log back in.";
                    else errorMsg += "Check console.";
                    alert(errorMsg);
                    return;
                }
            } else {
                console.log("No new password entered, skipping password change.");
            }

            // --- Part 3: Final Success Message ---
            if (profileUpdateSuccess && !newPassword) {
                alert("✅ Account settings updated successfully!");
            } else if (profileUpdateSuccess && newPassword) {
                // Password success alert was already shown
                console.log("Profile and password updated successfully.");
            }
            console.log("--- updateAccountSettings finished ---");
        }

        // --- Direct Listener Attachment for the NEW form ---
        document.addEventListener('DOMContentLoaded', () => {
            const accountSettingsForm = document.getElementById('account-settings-form');
            if (accountSettingsForm) {
                console.log("Attaching listener to NEW account settings form.");
                accountSettingsForm.addEventListener('submit', updateAccountSettings);
            } else {
                // This might appear initially if the dashboard isn't the first page shown
                console.log("New account settings form not found yet (might be on inactive page).");
            }

            // Also, ensure data is loaded when the NEW view becomes active
            // We need to slightly modify the main click listener for the instructor dashboard
            // Find the existing listener for `#instructor-dashboard-page a[data-view]`
            // Add this line inside it:
            // if (targetViewId === 'instructor-account-settings-view') {
            //     loadAccountSettings();
            // }
        });


        // --- IMPORTANT: Modify the Instructor Dashboard Click Listener ---
        // Find this block in your existing code:
        /*
        const instructorNavLink = e.target.closest('#instructor-dashboard-page a[data-view]');
        if (instructorNavLink) {
            // ... (existing code for sidebar active state and showing view) ...
        
            // --- ADD THIS 'if' BLOCK ---
            if (targetViewId === 'instructor-account-settings-view') {
                loadAccountSettings(); // Load data when this specific view is shown
            }
            // --- END ADD ---
        
            // ... (rest of the existing code for calendar, learners, etc.) ...
        }
        */
        // Make sure to add the check for 'instructor-account-settings-view' as shown above.

        // --- END: ADD THIS NEW ACCOUNT SETTINGS SCRIPT ---
        async function renderInstructorReviews(instructorId) {
            const reviewsListContainer = document.getElementById('instructor-reviews-list');
            if (!reviewsListContainer) return;

            reviewsListContainer.innerHTML = '<p style="padding: 20px; text-align: center;">Loading reviews...</p>';

            try {
                const snapshot = await db.collection('reviews')
                    .where('instructorId', '==', instructorId)
                    .orderBy('createdAt', 'desc') // Show newest first
                    .get();

                if (snapshot.empty) {
                    reviewsListContainer.innerHTML = '<p style="padding: 20px; text-align: center;">You have not received any reviews yet.</p>';
                    return;
                }

                let reviewsHtml = '';
                snapshot.forEach(doc => {
                    const review = doc.data();
                    const reviewDate = review.createdAt ? moment(review.createdAt.toDate()).format('D MMM YYYY') : 'Date unknown';

                    // Simple star rating display
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        starsHtml += i <= review.rating ? '★' : '☆';
                    }

                    reviewsHtml += `
                        <div class="review-item" style="padding: 15px 20px;">
                            <div class="review-meta">
                                <strong>${review.learnerName || 'Learner'}</strong>
                                <span>${reviewDate}</span>
                            </div>
                            <div class="review-stars" style="color: var(--primary-color); margin-bottom: 8px;">
                                ${starsHtml} (${review.rating}/5)
                            </div>
                            ${review.feedbackText ? `<p class="review-text" style="color: var(--dark-color);">${review.feedbackText}</p>` : '<p class="review-text" style="color: var(--gray-color);"><em>No feedback comment provided.</em></p>'}
                        </div>
                    `;
                });

                reviewsListContainer.innerHTML = reviewsHtml;

            } catch (error) {
                console.error("Error fetching instructor reviews:", error);
                reviewsListContainer.innerHTML = '<p style="padding: 20px; text-align: center; color: red;">Could not load reviews.</p>';
            }
        }

        // --- PASTE THE CODE SNIPPET HERE ---
    // --- START: DELEGATED LISTENER FOR ADMIN VIEW BOOKINGS & MODAL CLOSE ---

    // Listener attached to the body to catch clicks on dynamically added elements
   // --- START: DELEGATED LISTENER FOR ADMIN VIEW BOOKINGS & MODAL CLOSE ---

    // Listener attached to the body to catch clicks on dynamically added elements
    document.body.addEventListener('click', function(e) {

        // Check if "View Bookings" (for LEARNERS) was clicked in the Past Bookings tab
        const viewLearnerBookingsBtn = e.target.closest('#admin-learners-booking-tab .view-learner-bookings-btn');
        if (viewLearnerBookingsBtn) {
            e.preventDefault(); // Prevent any default link behavior
            const learnerId = viewLearnerBookingsBtn.dataset.learnerId;
            const learnerName = viewLearnerBookingsBtn.dataset.learnerName;
            console.log("View Bookings (Learner) clicked for:", learnerName, learnerId);
            if (learnerId && learnerName) {
                showLearnerBookingsModal(learnerId, learnerName);
            } else {
                console.error("Missing learner ID or Name on button:", viewLearnerBookingsBtn);
            }
            return; // Stop processing
        }

        // Check if "View Bookings" (for INSTRUCTORS) was clicked in the Past Bookings tab
        const viewInstructorBookingsBtn = e.target.closest('#admin-instructors-booking-tab .view-instructor-bookings-btn');
        if (viewInstructorBookingsBtn) {
            e.preventDefault();
            const instructorId = viewInstructorBookingsBtn.dataset.instructorId;
            const instructorName = viewInstructorBookingsBtn.dataset.instructorName;
            console.log("View Bookings (Instructor) clicked for:", instructorName, instructorId);
            if (instructorId && instructorName) {
                showInstructorBookingsModal(instructorId, instructorName);
            } else {
                 console.error("Missing instructor ID or Name on button:", viewInstructorBookingsBtn);
            }
            return; // Stop processing
        }
        
        // --- Modal Closing Logic ---

        // Check if a close button OR the overlay background of the LEARNER bookings modal was clicked
        const learnerBookingsModal = document.getElementById('learner-bookings-modal');
        if (learnerBookingsModal && learnerBookingsModal.classList.contains('active') && (e.target.classList.contains('modal-close-btn') || e.target === learnerBookingsModal)) {
            e.preventDefault();
            learnerBookingsModal.classList.remove('active');
            return; 
        }

         // Check if a close button OR the overlay background of the USER DETAILS modal was clicked
         const userDetailsModal = document.getElementById('user-details-modal');
         if (userDetailsModal && userDetailsModal.classList.contains('active') && (e.target.classList.contains('modal-close-btn') || e.target === userDetailsModal)) {
              e.preventDefault();
              userDetailsModal.classList.remove('active');
              return;
         }

         // Check if a close button OR the overlay background of the INSTRUCTOR bookings modal was clicked
         const instructorBookingsModal = document.getElementById('instructor-bookings-modal');
         if (instructorBookingsModal && instructorBookingsModal.classList.contains('active') && (e.target.classList.contains('modal-close-btn') || e.target === instructorBookingsModal)) {
              e.preventDefault();
              instructorBookingsModal.classList.remove('active');
              return;
         }

    }); // End of body click listener

    // --- END: DELEGATED LISTENER ---
    </script>
</body>

</html>
